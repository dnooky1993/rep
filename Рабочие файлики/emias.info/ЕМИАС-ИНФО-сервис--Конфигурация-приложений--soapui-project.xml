<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="01bc8b87-c4ca-4bd1-b14d-bd19ad4895e7" activeEnvironment="Default" name="ЕМИАС.ИНФО сервис &quot;Конфигурация приложений&quot;" resourceRoot="" soapui-version="5.7.2" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="801e0077-0557-407d-bbc4-f2df044bd840" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://emiasinfo-application.test.emias.mos.ru" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://emiasinfo-application.test.emias.mos.ru</con:endpoint></con:endpoints><con:resource name="config" path="/api/v2/config" id="4359eb22-556c-47ec-ba7b-4c3993d1e03f"><con:settings/><con:parameters/><con:method name="getConfig" id="3d313673-9e02-487d-9622-c955c7bc864b" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>204</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:con1="http://emiasinfo-application.test.emias.mos.ru/api/v2/config">con1:Response</con:element></con:representation><con:request name="getConfig" id="09e69317-ac1d-4620-8efb-ea392953d946" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://emiasinfo-application.test.emias.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:testSuite id="4778df57-1cba-4a7c-abba-c2086a4a51e0" name="getConfig"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="3904fd21-456d-4c34-b148-181fc225a243" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Проверка маппинга" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить id для versionId" id="a004c3e2-a83a-4a1d-91b2-050f769b11de"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_version
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для about" id="d40a14f9-58e4-4056-a1a1-502ab0427356"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_about
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для togglers" id="1e05f282-1706-41a1-949c-ba685baed563"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_togglers
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для links" id="a0d53d6e-c8d1-40b1-a56a-93230b78ea14"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_links
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для banners" id="e6084255-3759-4ac4-8e59-8396991788aa"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_banners
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для banner content" id="46bb2917-fde9-4452-9355-243fb8fdbd73"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_banner_content
</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Получить id для variable dict" id="7bbb6c0d-6854-4bcc-bb54-93f7875f2c73"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>select coalesce(max(id)+1,1) as "myid" from f_variable_dict
</con:query><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать id в проперти" id="5775ea86-0a8b-4dd2-95bb-14cde7571432"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>version id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для versionId</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>fversionTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>about</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для about</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>faboutTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>togglers</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для togglers</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>ftogglersTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>links</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для links</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>flinksTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>banners</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для banners</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>fbannersTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>banner content</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для banner content</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>fbanConTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>variable dict</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Получить id для variable dict</con:sourceStep><con:sourcePath>//Results/ResultSet/Row/MYID</con:sourcePath><con:targetType>fVarDictTableId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Сгенерировать данные" id="31196a16-4e0d-454f-a1e7-5caf31ff7703"><con:settings/><con:config><script>import org.apache.commons.lang.RandomStringUtils;

//Version
testRunner.testCase.setPropertyValue('lastVersion', RandomStringUtils.random(3, (('0'..'9')).join().toCharArray()))

//About
testRunner.testCase.setPropertyValue('aboutName', "aN-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))
testRunner.testCase.setPropertyValue('aboutValue', "aV-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

//Togglers
testRunner.testCase.setPropertyValue('togglersName',"tN-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))
if (Math.abs(new Random().nextInt() % 2) == 1)
	{testRunner.testCase.setPropertyValue('togglersState', "true")}
else 
	{testRunner.testCase.setPropertyValue('togglersState', "false")}

 //Links
testRunner.testCase.setPropertyValue('linksName', "lN-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))
testRunner.testCase.setPropertyValue('linksValue', "lV-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

 //banners
testRunner.testCase.setPropertyValue('bannersCode', "bC-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))
testRunner.testCase.setPropertyValue('bannersTitle', "bT-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

 //banner content 1
testRunner.testCase.setPropertyValue('bannerContentText1', "bcT1-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

 //banner content 2
testRunner.testCase.setPropertyValue('bannerContentText2', "bcT2-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

 //variable dict
testRunner.testCase.setPropertyValue('varDictCode', "vdC-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))

/* switch case выглядит более громоздким в данном случае */
def choice = Math.abs(new Random().nextInt() % 6) + 1
if (choice == 1)
	{testRunner.testCase.setPropertyValue('varDictType', "text")}
if (choice == 2)
	{testRunner.testCase.setPropertyValue('varDictType', "link")}
if (choice == 3)
	{testRunner.testCase.setPropertyValue('varDictType', "in-app-link")}
if (choice == 4)
	{testRunner.testCase.setPropertyValue('varDictType', "navigate")}
if (choice == 5)
	{testRunner.testCase.setPropertyValue('varDictType', "replace")}
if (choice == 6)
	{testRunner.testCase.setPropertyValue('varDictType', "push")}

testRunner.testCase.setPropertyValue('varDictValue', "vdV-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))
testRunner.testCase.setPropertyValue('varDictUrl', "vdU-"+RandomStringUtils.random(15, (('a'..'z') + ('A'..'Z') + ('0'..'9')).join().toCharArray()))</script></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись version" id="5ac2b5e1-7067-4d5e-b848-22c01d912820"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_version (id, version)  
VALUES (${#TestCase#fversionTableId}, '${#TestCase#lastVersion}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись about" id="ec107cfc-5a6e-4488-9e0e-78c1dea03f49"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_about (id, version_id, name, value)  
VALUES (${#TestCase#faboutTableId}, ${#TestCase#fversionTableId}, '${#TestCase#aboutName}', '${#TestCase#aboutValue}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись togglers" id="411c6a20-5b09-4742-bcce-e60218254306"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_togglers (id, version_id, name, state)  
VALUES (${#TestCase#ftogglersTableId}, ${#TestCase#fversionTableId}, '${#TestCase#togglersName}', ${#TestCase#togglersState})</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись links" id="d01961cd-9fe9-4898-b817-e99de43f6ffb"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_links (id, version_id, name, value)  
VALUES (${#TestCase#flinksTableId}, ${#TestCase#fversionTableId}, '${#TestCase#linksName}', '${#TestCase#linksValue}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись banners" id="d6ce5f8e-f5c3-4d73-bd29-d2c30a46bd4b"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_banners (id, version_id, code, title)  
VALUES (${#TestCase#fbannersTableId}, ${#TestCase#fversionTableId}, '${#TestCase#bannersCode}', '${#TestCase#bannersTitle}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись banner content 1" id="cb7bda7d-d1ac-4cf4-ba6a-56fc724e82b9"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_banner_content (id, banner_id, text)  
VALUES (${#TestCase#fbanConTableId}, ${#TestCase#fbannersTableId}, '${#TestCase#bannerContentText1}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись banner content 2" id="4e65fdb0-0e9e-46fe-a53b-af317ccd52f3"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_banner_content (id, banner_id, text)  
VALUES (${#TestCase#fbanConTableId}+1, ${#TestCase#fbannersTableId}, '${#TestCase#bannerContentText2}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Добавить запись variable dict" id="674f8782-a86f-4aa4-bb13-10fc3c32f1e9"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>INSERT INTO f_variable_dict (id, banner_content_id, code, type, value, url)  
VALUES (${#TestCase#fVarDictTableId}, ${#TestCase#fbanConTableId}+1, '${#TestCase#varDictCode}', '${#TestCase#varDictType}', '${#TestCase#varDictValue}', '${#TestCase#varDictUrl}')</con:query><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="GetConfig" id="0e176bf5-4ed3-4648-bc19-8a552c1d864d"><con:settings/><con:config service="http://emiasinfo-application.test.emias.mos.ru" resourcePath="/api/v2/config" methodName="getConfig" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetConfig" id="3881f408-c98f-481a-99a4-751a0caa12ad" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request/><con:originalUri>http://emiasinfo-application.test.emias.mos.ru/api/v2/config</con:originalUri><con:assertion type="JsonPath Existence Match" id="661a725f-00a3-47ec-9769-9e103a70a0cb" name="Возвращён configResponse"><con:configuration><path>$.payload.configResponse</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="3a7762f2-e566-4b80-a354-b78d070e3f83" name="Ответ не вернул ошибку"><con:configuration><token>error</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Маппинг" id="94f13970-df27-4cdd-abb6-ff20f726faac"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def restResponse = context.expand( '${GetConfig#Response}' ).toString()
def json =  new JsonSlurper().parseText(restResponse)
def config = json.payload.configResponse

//version
assert config.lastVersion == testRunner.testCase.getPropertyValue('lastVersion')

//about
assert config.about.keySet()[0] ==  testRunner.testCase.getPropertyValue('aboutName')
assert config.about.values()[0] ==  testRunner.testCase.getPropertyValue('aboutValue')

//togglers
assert config.togglers.keySet()[0] ==  testRunner.testCase.getPropertyValue('togglersName')
assert config.togglers.values()[0] ==  testRunner.testCase.getPropertyValue('togglersState').toBoolean()

//links
assert config.links.keySet()[0] ==  testRunner.testCase.getPropertyValue('linksName')
assert config.links.values()[0] ==  testRunner.testCase.getPropertyValue('linksValue')

//banners
assert config.banners.keySet()[0] == testRunner.testCase.getPropertyValue('bannersCode')

def banner =  config.banners.values()[0]
assert banner.values()[1] == testRunner.testCase.getPropertyValue('bannersTitle')

//banner contents
def content = banner.get("content")
assert content[0].values()[0] == testRunner.testCase.getPropertyValue('bannerContentText1')

assert content[1].values()[0] == testRunner.testCase.getPropertyValue('bannerContentText2')

//variable dict
def variableDict = content[1].values()[1]
assert variableDict.keySet()[0] == testRunner.testCase.getPropertyValue('varDictCode')
def varDictValues = variableDict.values()[0]
assert varDictValues.get("type") ==  testRunner.testCase.getPropertyValue('varDictType')
assert varDictValues.get("value") ==  testRunner.testCase.getPropertyValue('varDictValue')
assert varDictValues.get("url") ==  testRunner.testCase.getPropertyValue('varDictUrl')</script></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись about" id="4b0897f4-b55b-451f-b839-86dd1a131bc2"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_about where id = ${#TestCase#faboutTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись togglers" id="36920098-085d-401d-8886-4a9430908b12"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_togglers where  id = ${#TestCase#ftogglersTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись links" id="15b14238-b23c-46ec-8eeb-eb1ac5072a18"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_links where  id = ${#TestCase#flinksTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись variable dict" id="69c67180-ebb3-4154-885d-3cd0d847d0cf"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_variable_dict where  id = ${#TestCase#fVarDictTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись banner content 1" id="4c551104-91ec-4a2c-a023-3c6fa5ed9981"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_banner_content where  id = ${#TestCase#fbanConTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись banner content 2" id="1ff9e574-685a-495b-bd25-a13e24f6bc7d"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_banner_content where  id = ${#TestCase#fbanConTableId}+1</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись banners" id="6af3f64f-c280-4fec-b5e9-221494af6dca"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_banners where  id = ${#TestCase#fbannersTableId}</con:query><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Удалить запись version" id="a5ac65eb-c2a7-4f4f-931c-8a3c9f9cada8"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#emiasInfoDBDriver}</con:driver><con:connectionString>${#Project#emiasInfoFullDbConnection}</con:connectionString><con:query>delete from f_version where  id = ${#TestCase#fversionTableId}</con:query><con:properties/></con:config></con:testStep><con:properties><con:property><con:name>lastVersion</con:name><con:value>274</con:value></con:property><con:property><con:name>fversionTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>aboutName</con:name><con:value>aN-1EkGJOhModzNuJ0</con:value></con:property><con:property><con:name>aboutValue</con:name><con:value>aV-24lJomgnDVqCasE</con:value></con:property><con:property><con:name>faboutTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>togglersName</con:name><con:value>tN-JFXw9N2k2IgES5F</con:value></con:property><con:property><con:name>togglersState</con:name><con:value>false</con:value></con:property><con:property><con:name>ftogglersTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>linksName</con:name><con:value>lN-Km6GyK9n8ZUpn0j</con:value></con:property><con:property><con:name>linksValue</con:name><con:value>lV-g23XvAgfNWQTARv</con:value></con:property><con:property><con:name>flinksTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>bannersCode</con:name><con:value>bC-h7vDjJGmbcblJU8</con:value></con:property><con:property><con:name>bannersTitle</con:name><con:value>bT-I6PE13UaImyV4Ig</con:value></con:property><con:property><con:name>fbannersTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>bannerContentText1</con:name><con:value>bcT1-Vb8R7Ia3RgrQUbZ</con:value></con:property><con:property><con:name>bannerContentText2</con:name><con:value>bcT2-rBOPwsDyGbBN0Az</con:value></con:property><con:property><con:name>fbanConTableId</con:name><con:value>1</con:value></con:property><con:property><con:name>varDictCode</con:name><con:value>vdC-otDg3OZI8aPZb1c</con:value></con:property><con:property><con:name>varDictType</con:name><con:value>navigate</con:value></con:property><con:property><con:name>varDictValue</con:name><con:value>vdV-PgN5yjruF1YBaTC</con:value></con:property><con:property><con:name>varDictUrl</con:name><con:value>vdU-aEch7a9NCPdiqda</con:value></con:property><con:property><con:name>fVarDictTableId</con:name><con:value>1</con:value></con:property></con:properties></con:testCase><con:testCase id="689ea818-467a-4535-b1d6-99a84b07360b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="getConfig" id="5cae4669-1749-4946-83a1-1006bda8b4b9"><con:settings/><con:config service="http://emiasinfo-application.test.emias.mos.ru" resourcePath="/api/v2/config" methodName="getConfig" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getConfig" id="3881f408-c98f-481a-99a4-751a0caa12ad" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request/><con:originalUri>http://emiasinfo-application.test.emias.mos.ru/api/v2/config</con:originalUri><con:assertion type="JsonPath Existence Match" id="661a725f-00a3-47ec-9769-9e103a70a0cb" name="Возвращён configResponse"><con:configuration><path>$.payload.configResponse</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="3a7762f2-e566-4b80-a354-b78d070e3f83" name="Ответ не вернул ошибку"><con:configuration><token>error</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Сравнить ответ с данными в бд" id="a1288d7c-cfd2-486a-9bee-5e2d0aafc621"><con:settings/><con:config><script>import groovy.json.JsonSlurper
import groovy.sql.Sql

connection =testRunner.testCase.testSuite.project.getPropertyValue("emiasInfoFullDbConnection")
driver =testRunner.testCase.testSuite.project.getPropertyValue("emiasInfoDBDriver")

sql = Sql.newInstance(connection, driver)

version=sql.firstRow("select * from f_version").version


about=sql.rows("select * from f_about")

about.name.sort()

log.info about
def restResponse = context.expand( '${getConfig#Response}' ).toString()
def json =  new JsonSlurper().parseText(restResponse)
def config = json.payload.configResponse

//version
assert config.lastVersion == testRunner.testCase.getPropertyValue('lastVersion')

//about
assert config.about.keySet()[0] ==  testRunner.testCase.getPropertyValue('aboutName')
assert config.about.values()[0] ==  testRunner.testCase.getPropertyValue('aboutValue')

//togglers
assert config.togglers.keySet()[0] ==  testRunner.testCase.getPropertyValue('togglersName')
assert config.togglers.values()[0] ==  testRunner.testCase.getPropertyValue('togglersState').toBoolean()

//links
assert config.links.keySet()[0] ==  testRunner.testCase.getPropertyValue('linksName')
assert config.links.values()[0] ==  testRunner.testCase.getPropertyValue('linksValue')

//banners
assert config.banners.keySet()[0] == testRunner.testCase.getPropertyValue('bannersCode')

def banner =  config.banners.values()[0]
assert banner.values()[1] == testRunner.testCase.getPropertyValue('bannersTitle')

//banner contents
def content = banner.get("content")
assert content[0].values()[0] == testRunner.testCase.getPropertyValue('bannerContentText1')

assert content[1].values()[0] == testRunner.testCase.getPropertyValue('bannerContentText2')

//variable dict
def variableDict = content[1].values()[1]
assert variableDict.keySet()[0] == testRunner.testCase.getPropertyValue('varDictCode')
def varDictValues = variableDict.values()[0]
assert varDictValues.get("type") ==  testRunner.testCase.getPropertyValue('varDictType')
assert varDictValues.get("value") ==  testRunner.testCase.getPropertyValue('varDictValue')
assert varDictValues.get("url") ==  testRunner.testCase.getPropertyValue('varDictUrl')</script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>emiasInfoEndpoint</con:name><con:value>http://emiasinfo1.emias.solit-clouds.ru</con:value></con:property><con:property><con:name>emiasInfoDbConnection</con:name><con:value>172.17.5.11:29100/emiasinfo</con:value></con:property><con:property><con:name>emiasInfoDbLogin</con:name><con:value>emiasinfo</con:value></con:property><con:property><con:name>emiasInfoDbPassword</con:name><con:value>emiasinfo</con:value></con:property><con:property><con:name>emiasInfoFullDbConnection</con:name><con:value>jdbc:postgresql://172.17.5.11:29100/emiasinfo?user=emiasinfo&amp;password=emiasinfo</con:value></con:property><con:property><con:name>emiasInfoDBDriver</con:name><con:value>org.postgresql.Driver</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>