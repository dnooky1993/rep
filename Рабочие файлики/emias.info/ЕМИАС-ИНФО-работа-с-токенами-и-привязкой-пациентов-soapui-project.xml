<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="3014fe50-fd3a-4132-ac44-c0b6f684a6a7" activeEnvironment="Default" name="ЕМИАС.ИНФО работа с токенами и привязкой пациентов" resourceRoot="" soapui-version="5.7.2" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:description>для удобства чтоы не переписывать много констант и эндпоинтов, для каждого контура заведен отдельный тест-сьют.
эндпоинты указываются в параметрах сьюта.
полученные токены записываются как в параметры сьюта(для более быстрого доступа),
 так и в глобальные свойства. guid авторизованного пользователя записывается только в сьют</con:description><con:settings/><con:interface xsi:type="con:RestService" id="1a5199a2-6931-4e78-ba67-732a6e97a995" wadlVersion="http://wadl.dev.java.net/2009/02" name="https://login-tech.mos.ru" type="rest" basePath="" definitionUrl="C:\Users\ekomarova\Desktop\Проекты\емиас инфо\_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart="https://login-tech.mos.ru.wadl"><con:part><con:url>https://login-tech.mos.ru.wadl</con:url><con:content><![CDATA[<application xmlns="http://wadl.dev.java.net/2009/02">
  <doc xml:lang="en" title="https://login-tech.mos.ru"/>
  <resources base="https://login-tech.mos.ru">
    <resource path="sps/oauth/register" id="register">
      <doc xml:lang="en" title="register"/>
      <method name="POST" id="Method 1">
        <doc xml:lang="en" title="Method 1"/>
        <request>
          <representation mediaType="application/json"/>
        </request>
        <response status="">
          <representation mediaType="application/json"/>
          <representation mediaType="application/json"/>
          <representation mediaType="application/json"/>
          <representation mediaType="application/json"/>
          <representation mediaType="application/json"/>
        </response>
        <response status="201">
          <representation mediaType="application/json"/>
        </response>
      </method>
    </resource>
    <resource path="sps/oauth/te" id="te">
      <doc xml:lang="en" title="te"/>
      <param name="code" type="xs:string" required="false" default="" style="query" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <param name="redirect_uri" type="xs:string" required="false" default="" style="query" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <param name="grant_type" type="xs:string" required="false" default="" style="query" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <param name="refresh_token" type="xs:string" required="false" default="" style="query" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <param name="Authorization" type="xs:string" required="false" default="" style="header" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <method name="POST" id="Method 1">
        <doc xml:lang="en" title="Method 1"/>
        <request>
          <representation mediaType="application/x-www-form-urlencoded"/>
        </request>
        <response status="">
          <representation mediaType="application/x-www-form-urlencoded"/>
          <representation mediaType="application/x-www-form-urlencoded"/>
          <representation mediaType="application/x-www-form-urlencoded"/>
          <representation mediaType="application/x-www-form-urlencoded"/>
          <representation mediaType="application/x-www-form-urlencoded"/>
        </response>
        <response status="400">
          <representation mediaType="application/json"/>
        </response>
        <response status="200">
          <representation mediaType="application/json"/>
        </response>
      </method>
      <method name="POST" id="Обновить токен">
        <doc xml:lang="en" title="Обновить токен"/>
        <request/>
      </method>
      <method name="GET" id="Обновить токен-1">
        <doc xml:lang="en" title="Обновить токен-1"/>
        <request/>
      </method>
    </resource>
    <resource path="sps/oauth/me" id="me">
      <doc xml:lang="en" title="me"/>
      <param name="Cache-control" type="xs:string" required="false" default="" style="query" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <method name="GET" id="Method 1">
        <doc xml:lang="en" title="Method 1"/>
        <request>
          <param name="Authorization" type="xs:string" required="false" default="" style="header" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
        </request>
        <response status="200">
          <representation mediaType="application/json"/>
        </response>
        <response status="401">
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
          <representation mediaType=""/>
        </response>
      </method>
    </resource>
  </resources>
</application>]]></con:content><con:type>http://wadl.dev.java.net/2009/02</con:type></con:part></con:definitionCache><con:endpoints><con:endpoint>https://login-tech.mos.ru</con:endpoint></con:endpoints><con:resource name="register" path="sps/oauth/register" id="4be7d9a6-6b1b-4392-97d7-ebf43f267b14"><con:settings/><con:parameters/><con:method name="Method 1" id="91bcd9c0-b5bd-4404-bedb-52bc5b569c39" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST" id=""><con:mediaType>application/json</con:mediaType><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status>201</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:request name="Request 1" id="50a84f40-5c5e-4546-9650-66a5829576c5" mediaType="application/json"><con:settings/><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters/></con:request></con:method></con:resource><con:resource name="te" path="/sps/oauth/te" id="6570a393-b0f1-439c-931b-d0875b91d2c4"><con:settings/><con:parameters><con:parameter><con:name>code</con:name><con:value/><con:style>QUERY</con:style><con:default/></con:parameter><con:parameter><con:name>redirect_uri</con:name><con:value/><con:style>QUERY</con:style><con:default/></con:parameter><con:parameter><con:name>grant_type</con:name><con:value/><con:style>QUERY</con:style><con:default/></con:parameter><con:parameter><con:name>refresh_token</con:name><con:value/><con:style>QUERY</con:style><con:default/></con:parameter><con:parameter><con:name>Authorization</con:name><con:value/><con:style>HEADER</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="ab3290f7-4d2f-4e96-a473-2425f6785365" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST" id=""><con:mediaType>application/x-www-form-urlencoded</con:mediaType><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/x-www-form-urlencoded</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/x-www-form-urlencoded</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/x-www-form-urlencoded</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/x-www-form-urlencoded</con:mediaType><con:status/><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType>application/json</con:mediaType><con:status>400</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:request name="Request 1" id="d28418de-04aa-4f09-a1ac-d7426c8a5374" mediaType="application/x-www-form-urlencoded" postQueryString="false"><con:settings/><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="refresh_token" value=""/>
  <con:entry key="grant_type" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:request></con:method><con:method name="Обновить токен" id="b7a37ed6-f68c-4400-9d6c-85ea283c3904" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="f2f57a0a-99a3-4d31-869e-cd98ec71cc26" mediaType="application/json" postQueryString="false"><con:settings/><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value=""/>
  <con:entry key="refresh_token" value=""/>
  <con:entry key="grant_type" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:request></con:method><con:method name="Обновить токен-1" id="a9123727-a9fe-4f9b-8b22-7df43f7c570f" method="GET"><con:settings/><con:parameters/><con:request name="Request 1" id="a26ec0de-5723-4515-8613-c8b74de6c70d" mediaType="application/json"><con:settings/><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="me" path="/sps/oauth/me" id="8c0d1fe6-3c55-4156-aad0-bd1953ba2517"><con:settings/><con:parameters><con:parameter><con:name>Cache-control</con:name><con:value/><con:style>QUERY</con:style><con:default/></con:parameter></con:parameters><con:method name="Method 1" id="bf3eaa44-56c4-40ee-a1b3-a2d49c95eb07" method="GET"><con:settings/><con:parameters><con:parameter><con:name>Authorization</con:name><con:value/><con:style>HEADER</con:style><con:default/></con:parameter></con:parameters><con:representation type="RESPONSE" id=""><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:representation type="FAULT" id=""><con:mediaType/><con:status>401</con:status><con:params/><con:element xsi:nil="true"/><con:description xsi:nil="true"/></con:representation><con:request name="Request 1" id="67f02080-e38b-40e1-ac24-8db727100d57" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Bearer 3uDUUaebZWFpZ3_pa1CAMewiMJyoDUJrUBsjllQnMaM"/>
  <con:entry key="Cache-control" value="no-cache"/>
</con:parameters></con:request><con:request name="Copy of Request 1" id="67f02080-e38b-40e1-ac24-8db727100d57" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Bearer ${#Global#sudirToken}"/>
  <con:entry key="Cache-control" value="no-cache"/>
</con:parameters></con:request><con:request name="Copy of Copy of Request 1" id="67f02080-e38b-40e1-ac24-8db727100d57" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://login-tech.mos.ru</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Bearer d1hMJnwZWdm3q_azFo5youFW65IxcH8H1D-cycqxTuc"/>
  <con:entry key="Cache-control" value="no-cache"/>
</con:parameters></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="34559190-81e0-4fdc-8889-53e93f479511" wadlVersion="http://wadl.dev.java.net/2009/02" name="https://lkservice.test.emias.mos.ru" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint></con:endpoints><con:resource name="login" path="/api/auth/1/login" id="67bd17f7-f329-4e04-b5a0-f270ab568fa2"><con:settings/><con:parameters/><con:method name="Method 1" id="61e0a0e8-29d6-4d5e-8968-f547a9024ab1" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:log="https://lkservice.test.emias.mos.ru/api/auth/1/login">log:Response</con:element></con:representation><con:request name="Request 1" id="7e69f643-2254-4439-ad76-c5bc6ea00fee" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="confirm" path="/api/auth/1/confirm" id="966e54e8-4866-47d2-9ebe-83c6a03b3d7a"><con:settings/><con:parameters/><con:method name="Method 1" id="2eb4fd04-7c7f-4997-9029-e619ed67851e" method="POST"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:con1="https://lkservice.test.emias.mos.ru/api/auth/1/confirm">con1:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>400</con:status><con:params/><con:element xmlns:con1="https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance">con1:Fault</con:element></con:representation><con:request name="Request 1" id="e5a27700-f1f8-4e89-ae8a-d6b87e5100b2" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
    "otp_code": "19674",
    "attempt_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpZCI6IjJlOGFmN2Q5LWQ2MDYtNDg0Yi04MGNhLWIzNGI0YTA4NTFlZCIsImlzcyI6InVzZXJfYXV0aCIsImV4cCI6MTY2OTE5MTcyNSwic3ViIjoiYmI1ZWI4NTgtZWY3Ni00Mjk1LTk4NTktYzlkNmEyNTFiMzUwIiwiaGNuIjo1LCJhdWQiOiJQQVRJRU5UIiwic3NvX2lkIjoiWllNSnRkdmVQbUVxUlViYUkyYko0dW5TWURHMU13aGNXYUVhNlNjUnIyNlBQTE1lMmovbUtpZitEZHR6TVkvV1BCaGZHUjJGT3NEeklUSVJ6bHZJcllzYnpwT3RQOGl4S2hPa3FDVGduRForenZUSk1MZHhjRjk5bUtubjBaTFNCNmNZSVNtWkM3cmZ6ZzBBWjNJZ2lDRFpGTTMrbGU4cm5QUUF4d1ZwcjRVL1h2Rml5SWx2ZThoVUZEb3JQQnliMnc5eDFVRnZwQjE3MElvQklLZkgyL0RXSkpiWElyMk9UYkZyRHhpR2NYbnNQMm1TSkhrbTNMWCtYNWhmRk0yT1QwMWlOdFBGUHJrVlVrU0hhTUxCV0Jyd3FaNDZpQ0VkaEtlNFRMMmp1dTdzbDFuZkEvOHhyTnVZTkZ6V0hJQzQ5UWJ6V2Rjajh4WXMzMlovcjZVZUZRPT0ifQ.ou49QvDA-tc6M7MhUND0-5nVMnxKqs4eoKrFSmRa9_RlQxdQOnDpyqybo-jjeC4NpUR-wgHF0UDDIz0ss_51DTMoNqpr6oLWOqv4cIUCzmXCDyAuENPhqxKDKw9JzNMiL3mDjDgi7W1M6cuuvHaXCyGMu3r6nSJ_ZeBJWvnJlZ_EpTqzQp7CzQ-My6fvF6CpJ839e1lgC3GwEbsc5Vqr-_ywkjDPx62NJOM6iY_CthFroKkZrXlc6oTV5gJ2a1IDtB6JQ9YWCIsPc4-Dg2jihC4tdC7YgRlAivWpGrLd-mpNc70AdJjS8HF0rjPrMwbtfsuWGnwUy2Ung0HdgPEHwX0JD17GYPJy4V7p5TtGHiFsjvMzEQH-rNuGlLEyPL1be1V5MarnvJlAeCqSF26r0q3uTbPtWGqHD0miv4rt5G85jt41eZFS3YEN3zpfbh9PiH5Xf4zGqp3BLVad9WuyIoFnrezZ5cTKPWtUOmIZej1Uni0uRZNpps54O-XNDBziTrqh3-6H_slfoWAqmWDiHxwxslF-rOtujGJ5bTofRs0QoUYLEDMVZP8JLDfMKSsdrm_v87RJDEvvyx9sOn6b09VJm_g3IMaewol_r4m0yWASLMg210spfaI-AMiqqAqRpiNPLBf3AU_vTD6QLFVuocTCwNgMdy02VdBHCA7J-QM"
}</con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="instance" path="/api/2/mobile/auth/instance" id="bd04d0b7-bb25-41a8-ae4a-d38f8abd1ee4"><con:settings/><con:parameters/><con:method name="Method 1" id="597e9318-6967-4fd0-8277-cd18aed20254" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>520 400 500</con:status><con:params/><con:element xmlns:ins="https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance">ins:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ins="https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance">ins:Response</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>401</con:status><con:params/><con:element xmlns:ins="https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance">ins:Fault</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>404</con:status><con:params/><con:element xmlns:ins="https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance">ins:Fault</con:element></con:representation><con:request name="Request 1" id="a22ddd9c-0f24-4179-94a7-b3f327674454" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint><con:request>{
  "instanceToken": "${#TestCase#client_id}",
  "sudirToken": "${#Project#sudirToken}"
}</con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="confirm-instance" path="/api/2/mobile/auth/confirm-instance" id="a73447eb-c5ba-476f-aefc-a24f7cf06778"><con:settings/><con:parameters/><con:method name="Method 1" id="78ed3510-7323-4471-902e-64c818d51419" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>520</con:status><con:params/><con:element xmlns:con1="https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance">con1:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:con1="https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance">con1:Response</con:element></con:representation><con:request name="Request 1" id="427e5d5f-ce8d-439b-9392-7117d71b894d" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint><con:request>{
    "otpCode": "${#TestCase#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="profile" path="/api/2/profile" id="a77f7440-2fe8-4bf8-b039-6d0141a81fd0"><con:settings/><con:parameters><con:parameter><con:name>ehrId</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>X-Access-JWT</con:name><con:value/><con:style>HEADER</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="9bfddfee-cbe1-47b6-8baa-25c13b0b106e" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:emc="https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions">emc:Response</con:element></con:representation><con:request name="Request 1" id="8cf08ed0-90bc-476e-bc2f-8cf4a03a471b" mediaType="application/json"><con:settings/><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="emc-permissions" path="/api/internal/3/emc-permissions" id="1278781f-2793-46d6-8f2e-7ae144f2b3c4"><con:settings/><con:parameters><con:parameter><con:name>ssoId</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="3bffb0e5-8768-4265-a8a8-035f57275ccc" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:emc="https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions">emc:Response</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element xmlns:emc="https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions">emc:Fault</con:element></con:representation><con:request name="Request 1" id="e3a32931-93a2-40c4-8f6a-0907425e89bd" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="b4ba0ec3-3e9e-4597-a0b7-2729be1e8859" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="grant-permission" path="/api/internal/1/user/grant-permission" id="a3f85bad-729b-4d5f-a5fe-791a2d279c80"><con:settings/><con:parameters/><con:method name="Method 1" id="d6e9d6db-d45e-4635-a680-ddeaf2f66f2e" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>520 400</con:status><con:params/><con:element xmlns:gran="https://lkservice.test.emias.mos.ru/api/internal/1/user/grant-permission">gran:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:gran="https://lkservice.test.emias.ru/api/internal/1/user/grant-permission">gran:Response</con:element></con:representation><con:request name="Request 1" id="18d36fce-b8df-40ec-83b7-711c13ddee45" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://lkservice.test.emias.ru</con:endpoint><con:request>{
  "documentId": "hiuhiruehgoerhgouhreoghe11",
  "createDate": "2024-03-11",
  "patientInfo": {
    "birthday": "2018-07-12",
    "patientName": "Ольга Евгеньевна К.",
    "emiasId": 4362304728036,
    "policyNum": "7792189787001617"
  },
  "permissionType": "CHILD",
  "id": "11111111122324",
  "userInfo": {
    "userName": "Яна Михайловна В.",
    "phoneNum": "79265209207",
    "ssoId": "af3e4ac5-96dd-4167-afb3-244eb7187aba"
  }
}</con:request><con:originalUri>https://lkservice.test.emias.ru/api/internal/1/user/grant-permission</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="refresh" path="/api/2/mobile/auth/refresh" id="31066f35-91a4-4297-b80c-a6cbcae902c0"><con:settings/><con:parameters><con:parameter><con:name>refreshToken</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="02bc9654-3ae0-408e-bb07-d55ae68b66e3" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>400 403</con:status><con:params/><con:element xmlns:ref="https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh">ref:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ref="https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh">ref:Response</con:element></con:representation><con:request name="Request 1" id="017cd03a-7363-4dc6-b944-d52f9b5abf71" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://lkservice.test.emias.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:WsdlInterface" id="480d6239-01e8-47c5-a7b1-f93c359d6edb" wsaVersion="NONE" name="ticketServiceBinding" type="wsdl" bindingName="{http://emias.mos.ru/eboard/ticketService/v1/}ticketServiceBinding" soapVersion="1_2" anonymous="optional" definition="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?wsdl"><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?wsdl</con:url><con:content><![CDATA[<wsdl:definitions name="ticketService" targetNamespace="http://emias.mos.ru/eboard/ticketService/v1/" xmlns:http="http://schemas.xmlsoap.org/wsdl/http/" xmlns:ns="http://emias.mos.ru/eboard/core/v1/" xmlns:ns1="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:nsf="http://emias.mos.ru/system/v1/faults/" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap12/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://emias.mos.ru/eboard/ticketService/v1/" xmlns:uctx="http://emias.mos.ru/system/v1/userContext/" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <wsdl:types>
    <xs:schema>
      <xs:import namespace="http://emias.mos.ru/system/v1/userContext/" schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.iq.uIXEH3XAiT6Ckts.EimMGKA.CECZfWi4P_fQw3s-"/>
      <xs:import namespace="http://emias.mos.ru/system/v1/faults/" schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.jmsqJvzAzXMnyJWs9Y4oy65L42LiIQw5CnV"/>
      <xs:import namespace="http://emias.mos.ru/eboard/ticketService/v1/types/" schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPZ.F7cFsZZpNUsAtZ2OLG_sXAgU.in884P.AH7Hwj6F2JXZ2vV_YS9U6xPEliYdc7Q-"/>
    </xs:schema>
  </wsdl:types>
  <wsdl:message name="getTicketListOutput">
    <wsdl:part element="ns1:getTicketListResponse" name="body"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="userContext">
    <wsdl:documentation>Контекст пользователя</wsdl:documentation>
    <wsdl:part element="uctx:userContext" name="userContext"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="getTicketListInput">
    <wsdl:part element="ns1:getTicketListRequest" name="body"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="getTicketByAppointmentIdOutput">
    <wsdl:part element="ns1:getTicketByAppointmentIdResponse" name="body"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="fault">
    <wsdl:documentation>Ошибка</wsdl:documentation>
    <wsdl:part element="nsf:fault" name="body"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="getTicketByAppointmentIdInput">
    <wsdl:part element="ns1:getTicketByAppointmentIdRequest" name="body"></wsdl:part>
  </wsdl:message>
  <wsdl:message name="NewMessage"></wsdl:message>
  <wsdl:portType name="ticketServicePortType">
    <wsdl:operation name="getTicketByAppointmentId">
      <wsdl:documentation>Метод для получения номера талона записи</wsdl:documentation>
      <wsdl:input message="tns:getTicketByAppointmentIdInput"></wsdl:input>
      <wsdl:output message="tns:getTicketByAppointmentIdOutput"></wsdl:output>
      <wsdl:fault message="tns:fault" name="fault"></wsdl:fault>
    </wsdl:operation>
    <wsdl:operation name="getTicketList">
      <wsdl:documentation>Метод для получения списка номеров талонов записей</wsdl:documentation>
      <wsdl:input message="tns:getTicketListInput"></wsdl:input>
      <wsdl:output message="tns:getTicketListOutput"></wsdl:output>
      <wsdl:fault message="tns:fault" name="fault"></wsdl:fault>
    </wsdl:operation>
  </wsdl:portType>
  <wsdl:binding name="ticketServiceBinding" type="tns:ticketServicePortType">
    <soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
    <wsdl:operation name="getTicketByAppointmentId">
      <soap:operation soapAction="getTicketByAppointmentId" soapActionRequired="true"/>
      <wsdl:input>
        <soap:header message="tns:userContext" part="userContext" use="literal"></soap:header>
        <soap:body use="literal"/>
      </wsdl:input>
      <wsdl:output>
        <soap:body use="literal"/>
      </wsdl:output>
      <wsdl:fault name="fault">
        <soap:fault name="fault" use="literal"/>
      </wsdl:fault>
    </wsdl:operation>
    <wsdl:operation name="getTicketList">
      <soap:operation soapAction="getTicketList" soapActionRequired="true"/>
      <wsdl:input>
        <soap:body use="literal"/>
        <soap:header message="tns:userContext" part="userContext" use="literal"></soap:header>
      </wsdl:input>
      <wsdl:output>
        <soap:body use="literal"/>
      </wsdl:output>
      <wsdl:fault name="fault">
        <soap:fault name="fault" use="literal"/>
      </wsdl:fault>
    </wsdl:operation>
  </wsdl:binding>
  <wsdl:service name="ticketService">
    <wsdl:documentation>Сервис для получения номера талона записи</wsdl:documentation>
    <wsdl:port binding="tns:ticketServiceBinding" name="ticketServicePortType">
      <soap:address location="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService"/>
    </wsdl:port>
  </wsdl:service>
</wsdl:definitions>]]></con:content><con:type>http://schemas.xmlsoap.org/wsdl/</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.iq.uIXEH3XAiT6Ckts.EimMGKA.CECZfWi4P_fQw3s-</con:url><con:content><![CDATA[<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" targetNamespace="http://emias.mos.ru/system/v1/userContext/" version="1.0" xmlns="http://emias.mos.ru/system/v1/userContext/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:include schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFs4avLDPsBEUJpzt6KK2zMBAGj3_azKzfqT7P"/>
  <xs:element name="userContext" type="UserContext">
    <xs:annotation>
      <xs:documentation>Контекст пользователя</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType name="UserContext">
    <xs:annotation>
      <xs:documentation>Контекст пользователя</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="systemName" type="xs:string">
        <xs:annotation>
          <xs:documentation>Шифр системы-потребителя</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element name="userName" type="xs:string">
        <xs:annotation>
          <xs:documentation>Имя пользователя (логин)</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element name="userRoleId" type="ID">
        <xs:annotation>
          <xs:documentation>Код Роли</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="isUserRoleSystemWide" type="xs:boolean">
        <xs:annotation>
          <xs:documentation>Признак "Общесистемная Роль"</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element name="userRights">
        <xs:annotation>
          <xs:documentation>Коллекция Полномочий пользователя</xs:documentation>
        </xs:annotation>
        <xs:complexType>
          <xs:sequence>
            <xs:element maxOccurs="unbounded" minOccurs="0" name="userRightId" type="ID">
              <xs:annotation>
                <xs:documentation>Код Полномочия</xs:documentation>
              </xs:annotation>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
      <xs:element name="jobExecutionId" type="ID"/>
      <xs:element minOccurs="0" name="hostIp" type="xs:string">
        <xs:annotation>
          <xs:documentation>IP адрес хоста</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="hostName" type="xs:string">
        <xs:annotation>
          <xs:documentation>Имя хоста</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="options" type="Options">
        <xs:annotation>
          <xs:documentation>Набор именованных значений</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFs4avLDPsBEUJpzt6KK2zMBAGj3_azKzfqT7P</con:url><con:content><![CDATA[<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" version="1.2" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:include schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.ie.uTGdftg54Sn8n18hza4y8E0-"/>
  <!--references-->
  <xs:element name="mail" type="Mail">
    <xs:annotation>
      <xs:documentation>Адрес электронной почты</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:element name="medicalOrganizationId" type="ID">
    <xs:annotation>
      <xs:documentation>Идентификатор Медицинской организации</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:element name="medicalFacilityId" type="ID">
    <xs:annotation>
      <xs:documentation>Идентификатор Медицинского учреждения</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:element name="compositionId" type="GUID">
    <xs:annotation>
      <xs:documentation>Идентификатор
Композиции Think!EHR
ЕМИАС.СИМИ</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:element name="simiDocumentId" type="GUID">
    <xs:annotation>
      <xs:documentation>Идентификатор
Документа СИМИ
ЕМИАС.СИМИ</xs:documentation>
    </xs:annotation>
  </xs:element>
  <!--abstract types-->
  <xs:complexType abstract="true" name="Base">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания
компонентов сущностей,
владельцеми которых является
текущий продукт ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:attribute name="id" type="ID" use="required">
      <xs:annotation>
        <xs:documentation>Идентификатор
сущности/записи
на уровне всего ЕМИАС</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <xs:complexType abstract="true" name="EntityBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания сущностей,
владельцем которых является
текущий продукт ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="Base">
        <xs:attribute name="archived" type="xs:boolean" use="required">
          <xs:annotation>
            <xs:documentation>Признак "Архивная сущность"</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="ForeignBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания
компонентов сущностей,
владельцами которых являются
другие продукты ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="Base"/>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="ForeignEntityBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания сущностей,
владельцами которых являются
другие продукты ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="EntityBase"/>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="NsiBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания типов,
реализующих справочники ЕМИАС.НСИ.2</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="ForeignEntityBase">
        <xs:sequence>
          <xs:element name="title" type="xs:string">
            <xs:annotation>
              <xs:documentation>Наименование элемента справочника</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="NsiWithCodeBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания типов,
реализующих справочники ЕМИАС.НСИ.2, в которых имеется бизнес-код</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="NsiBase">
        <xs:attribute name="code" type="xs:string" use="required">
          <xs:annotation>
            <xs:documentation>Бизнес-код</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="SIMIDocumentBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип,
используемый для описания cведений о документе СИМИ</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element ref="simiDocumentId"/>
      <xs:element minOccurs="0" ref="compositionId"/>
    </xs:sequence>
  </xs:complexType>
  <!--async operation status-->
  <xs:element name="operationId" type="ID">
    <xs:annotation>
      <xs:documentation>Идентификатор операции</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType name="OperationExecutionStatus">
    <xs:annotation>
      <xs:documentation>Статус выполнения операции</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="isCompleted" type="xs:boolean">
        <xs:annotation>
          <xs:documentation>Признак окончания выполнения операции</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element name="completenessProgress" type="OperationCompletenessBase">
        <xs:annotation>
          <xs:documentation>Сведения о текущем статусе выполнения операции</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="hasSucceded" type="xs:boolean">
        <xs:annotation>
          <xs:documentation>Признак успешности выполнения операции</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="messages" type="ErrorMessageCollection">
        <xs:annotation>
          <xs:documentation>Коллекция сообщений, порожденных в ходе выполнения операции</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
    <xs:attribute name="id" type="ID" use="required">
      <xs:annotation>
        <xs:documentation>Идентификатор операции</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <xs:complexType abstract="false" name="OperationCompletenessPercentage">
    <xs:annotation>
      <xs:documentation>Описание текущего статуса выполнения операции в процентах (0%-100%)</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="OperationCompletenessBase">
        <xs:sequence>
          <xs:element name="completenessStatus">
            <xs:annotation>
              <xs:documentation>Статус (0%-100%)</xs:documentation>
            </xs:annotation>
            <xs:simpleType>
              <xs:restriction base="xs:unsignedByte">
                <xs:minInclusive value="0"/>
                <xs:maxInclusive value="100"/>
              </xs:restriction>
            </xs:simpleType>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="OperationCompletenessBase">
    <xs:annotation>
      <xs:documentation>Базовый абстрактный тип для описания текущего статуса выполнения операции</xs:documentation>
    </xs:annotation>
    <xs:sequence/>
  </xs:complexType>
  <!--calling methods' options-->
  <xs:element name="options" type="Options">
    <xs:annotation>
      <xs:documentation>Параметры вызова метода</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType name="Options">
    <xs:annotation>
      <xs:documentation>Набор именованных значений</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element maxOccurs="unbounded" minOccurs="0" name="entry" type="KeyValuePair">
        <xs:annotation>
          <xs:documentation>Именованное значение</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <!--pagination-->
  <xs:element name="pagingOptions" type="PagingOptions">
    <xs:annotation>
      <xs:documentation>Параметры пагинации</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType abstract="true" name="PagingResults">
    <xs:annotation>
      <xs:documentation>Список с пагинацией</xs:documentation>
    </xs:annotation>
    <xs:attribute name="pageNumber" type="xs:int" use="required">
      <xs:annotation>
        <xs:documentation>Номер страницы (zero-based)</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute name="pageTotal" type="xs:int" use="required">
      <xs:annotation>
        <xs:documentation>Общее количество страниц</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute name="pageSize" type="xs:int" use="required">
      <xs:annotation>
        <xs:documentation>Размер страницы</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute name="morePagesAvailable" type="xs:boolean" use="required">
      <xs:annotation>
        <xs:documentation>Флаг доступности других страниц с результатами для "постраничного листания" (true - если доступны еще страницы; false - иначе)</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute name="totalItemsCount" type="xs:long" use="required">
      <xs:annotation>
        <xs:documentation>Общее количество элементов (на всех страницах)</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <xs:complexType name="PagingOptions">
    <xs:annotation>
      <xs:documentation>Параметры пагинации</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element minOccurs="0" ref="sortingOptions"/>
    </xs:sequence>
    <xs:attribute name="pageNumber" type="xs:int" use="required">
      <xs:annotation>
        <xs:documentation>Номер страницы (zero-based)</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute name="pageSize" type="xs:int" use="required">
      <xs:annotation>
        <xs:documentation>Размер страницы</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <!--sorting-->
  <xs:element name="sortingOptions" type="SortingOptions">
    <xs:annotation>
      <xs:documentation>Параметры сортировки</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType name="SortingOptions">
    <xs:annotation>
      <xs:documentation>Условия сортировки</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element maxOccurs="3" name="sortOrder" type="SortOrder">
        <xs:annotation>
          <xs:documentation>Условия сортировки
(используются в соответствии с
переданной последовательностью)</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="SortOrder">
    <xs:annotation>
      <xs:documentation>Сортировка</xs:documentation>
    </xs:annotation>
    <xs:attribute name="attributeName" type="xs:string" use="required">
      <xs:annotation>
        <xs:documentation>Наименование поля, по которому должна быть произведена сортировка</xs:documentation>
      </xs:annotation>
    </xs:attribute>
    <xs:attribute default="false" name="desceding" type="xs:boolean">
      <xs:annotation>
        <xs:documentation>Направление сортировки</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <!--void response-->
  <xs:element fixed="true" name="result">
    <xs:annotation>
      <xs:documentation>Элемент для использования в методах, не предполагающих возврат какого-либо значения</xs:documentation>
    </xs:annotation>
    <xs:complexType>
      <xs:simpleContent>
        <xs:extension base="xs:boolean"/>
      </xs:simpleContent>
    </xs:complexType>
  </xs:element>
  <!--base types-->
  <xs:complexType name="TimeInterval">
    <xs:annotation>
      <xs:documentation>Временной период (время)</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element minOccurs="0" name="start" type="xs:time">
        <xs:annotation>
          <xs:documentation>Время начала интервала</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="end" type="xs:time">
        <xs:annotation>
          <xs:documentation>Время окончания интервала</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="DatePeriod">
    <xs:annotation>
      <xs:documentation>Временной период (дата)</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element minOccurs="0" name="start" type="xs:date">
        <xs:annotation>
          <xs:documentation>Дата начала периода</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="end" type="xs:date">
        <xs:annotation>
          <xs:documentation>Дата окончания периода</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <!--keys-->
  <xs:complexType name="EntityId">
    <xs:annotation>
      <xs:documentation>Идентфикатор сущности,
непосредственно принадлежащей
текущему продукту ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="Base"/>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="ForeignEntityId">
    <xs:annotation>
      <xs:documentation>Идентфикатор
сущности ЕМИАС,
внешней по отношнению
к текущему продукту ЕМИАС</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="ForeignBase"/>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="NsiGlobalId">
    <xs:annotation>
      <xs:documentation>Глобальный идентфикатор
ЕМИАС.НСИ</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="ForeignBase"/>
    </xs:complexContent>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.ie.uTGdftg54Sn8n18hza4y8E0-</con:url><con:content><![CDATA[<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" version="1.1" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <!--error message description-->
  <xs:complexType name="ErrorMessageCollection">
    <xs:annotation>
      <xs:documentation>Коллекция сообщений об ошибках</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element maxOccurs="unbounded" name="message" type="ErrorMessage">
        <xs:annotation>
          <xs:documentation>Сообщение об ошибке</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="ErrorMessage">
    <xs:annotation>
      <xs:documentation>Сообщение об ошибке</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="Message">
        <xs:sequence>
          <xs:element minOccurs="0" name="parameters">
            <xs:annotation>
              <xs:documentation>Коллекция параметров сообщения</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="unbounded" name="parameter" type="KeyValuePair">
                  <xs:annotation>
                    <xs:documentation>Параметр сообщения</xs:documentation>
                  </xs:annotation>
                </xs:element>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
          <xs:element minOccurs="0" name="messages" type="ErrorMessageCollection">
            <xs:annotation>
              <xs:documentation>Сопутствующие сообщения об ошибках</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
        <xs:attribute name="type" type="ErrorMessageTypes" use="required">
          <xs:annotation>
            <xs:documentation>Тип сообщения</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:simpleType name="ErrorMessageTypes">
    <xs:annotation>
      <xs:documentation>Тип сообщения об ошибке</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
      <xs:enumeration value="ERROR">
        <xs:annotation>
          <xs:documentation>Ошибка</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="WARNING">
        <xs:annotation>
          <xs:documentation>Предупреждение (не блокирующая ошибка)</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="INFO">
        <xs:annotation>
          <xs:documentation>Информационное сообщение</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="ID">
    <xs:annotation>
      <xs:documentation>Идентификатор</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:long"/>
  </xs:simpleType>
  <xs:simpleType name="GUID">
    <xs:annotation>
      <xs:documentation>Глобальный 128-битный идентификатор (Globally Unique Identifier)</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
      <xs:pattern value="[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:complexType name="KeyValuePair">
    <xs:annotation>
      <xs:documentation>Представляет тип "ключ/значение"</xs:documentation>
    </xs:annotation>
    <xs:simpleContent>
      <xs:extension base="xs:string">
        <xs:attribute name="key" type="xs:string" use="required">
          <xs:annotation>
            <xs:documentation>Ключ</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:simpleContent>
  </xs:complexType>
  <xs:simpleType name="Mail">
    <xs:annotation>
      <xs:documentation>Адрес электронной почты</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
      <xs:maxLength value="320"/>
      <xs:pattern value=".+@.+\..+"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:complexType name="Message">
    <xs:annotation>
      <xs:documentation>Сообщение</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="code" type="xs:string">
        <xs:annotation>
          <xs:documentation>Код сообщения</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element name="message" type="xs:string">
        <xs:annotation>
          <xs:documentation>Текст сообщения</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.jmsqJvzAzXMnyJWs9Y4oy65L42LiIQw5CnV</con:url><con:content><![CDATA[<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" targetNamespace="http://emias.mos.ru/system/v1/faults/" version="1.0" xmlns="http://emias.mos.ru/system/v1/faults/" xmlns:uctx="http://emias.mos.ru/system/v1/userContext/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:include schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.ie.uTGdftg54Sn8n18hza4y8E0-"/>
  <xs:import namespace="http://emias.mos.ru/system/v1/userContext/" schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFo5CuPXj3Gx1A.iq.uIXEH3XAiT6Ckts.EimMGKA.CECZfWi4P_fQw3s-"/>
  <!--faults-->
  <xs:element name="fault" type="BaseFault">
    <xs:annotation>
      <xs:documentation>Базовый тип ошибки</xs:documentation>
    </xs:annotation>
  </xs:element>
  <xs:complexType name="SecurityFault">
    <xs:annotation>
      <xs:documentation>Ошибка безопасности</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="BaseFault">
        <xs:sequence>
          <xs:element ref="uctx:userContext"/>
          <xs:choice>
            <xs:element name="unauthorizedRequestSecurityException" type="UnauthorizedRequestSecurityException">
              <xs:annotation>
                <xs:documentation>Исключение безопасности типа UNAUTHORIZED_REQUEST_EXCEPTION</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="otherSecurityException" type="OtherSecurityException">
              <xs:annotation>
                <xs:documentation>Исключение безопасности типа OTHER_SECURITY_EXCEPTION</xs:documentation>
              </xs:annotation>
            </xs:element>
          </xs:choice>
        </xs:sequence>
        <xs:attribute fixed="SECURITY" name="type" type="FaultTypes" use="required">
          <xs:annotation>
            <xs:documentation>Тип ошибки</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="BusinessFault">
    <xs:annotation>
      <xs:documentation>Бизнес ошибка</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="BaseFault">
        <xs:sequence>
          <xs:element name="messages" type="ErrorMessageCollection">
            <xs:annotation>
              <xs:documentation>Коллекция Сообщений об ошибках</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="hasErrors" type="xs:boolean">
            <xs:annotation>
              <xs:documentation>Признак наличия ошибок в списке сообщений</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
        <xs:attribute fixed="BUSINESS" name="type" type="FaultTypes" use="required">
          <xs:annotation>
            <xs:documentation>Тип ошибки</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="UnexpectedFault">
    <xs:annotation>
      <xs:documentation>Непредвиденная ошибка</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="BaseFault">
        <xs:sequence>
          <xs:element name="version" type="xs:string">
            <xs:annotation>
              <xs:documentation>Версия продукта-сервиса</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="stackTrace">
            <xs:annotation>
              <xs:documentation>Стек вызова (последние 10  записей)</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="10" name="stackTraceRecord">
                  <xs:annotation>
                    <xs:documentation>Запись StackTrace</xs:documentation>
                  </xs:annotation>
                  <xs:complexType>
                    <xs:sequence>
                      <xs:element name="declaringClass" type="xs:string">
                        <xs:annotation>
                          <xs:documentation>Наименование класса, содержащего метод</xs:documentation>
                        </xs:annotation>
                      </xs:element>
                      <xs:element minOccurs="0" name="methodName" type="xs:string">
                        <xs:annotation>
                          <xs:documentation>Наименование метода</xs:documentation>
                        </xs:annotation>
                      </xs:element>
                      <xs:element minOccurs="0" name="fileName" type="xs:string">
                        <xs:annotation>
                          <xs:documentation>Наименование файла</xs:documentation>
                        </xs:annotation>
                      </xs:element>
                      <xs:element minOccurs="0" name="lineNumber" type="xs:int">
                        <xs:annotation>
                          <xs:documentation>Номер строки кода</xs:documentation>
                        </xs:annotation>
                      </xs:element>
                    </xs:sequence>
                  </xs:complexType>
                </xs:element>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
        <xs:attribute fixed="UNEXPECTED" name="type" type="FaultTypes" use="required">
          <xs:annotation>
            <xs:documentation>Тип ошибки</xs:documentation>
          </xs:annotation>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType abstract="true" name="BaseFault">
    <xs:annotation>
      <xs:documentation>Описание базового типа описания ошибки</xs:documentation>
    </xs:annotation>
    <xs:sequence/>
  </xs:complexType>
  <!--security exceptions-->
  <xs:complexType name="UnauthorizedRequestSecurityException">
    <xs:annotation>
      <xs:documentation>Исключение безопасности типа UNAUTHORIZED_REQUEST_EXCEPTION</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="requiredRights">
        <xs:annotation>
          <xs:documentation>Перечень идентификаторов недостающих Полномочий пользователя</xs:documentation>
        </xs:annotation>
        <xs:complexType>
          <xs:sequence>
            <xs:element maxOccurs="unbounded" name="userRightId" type="ID">
              <xs:annotation>
                <xs:documentation>Идентификатор Полномочия пользователя</xs:documentation>
              </xs:annotation>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
    <xs:attribute fixed="UNAUTHORIZED_REQUEST_EXCEPTION" name="type" type="SecurityExceptionTypes" use="required">
      <xs:annotation>
        <xs:documentation>Тип исключения безопасности</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <xs:complexType name="OtherSecurityException">
    <xs:annotation>
      <xs:documentation>Исключение безопасности типа OTHER_SECURITY_EXCEPTION</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="message" type="Message">
        <xs:annotation>
          <xs:documentation>Сообщение</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
    <xs:attribute fixed="OTHER_SECURITY_EXCEPTION" name="type" type="SecurityExceptionTypes" use="required">
      <xs:annotation>
        <xs:documentation>Тип исключения безопасности</xs:documentation>
      </xs:annotation>
    </xs:attribute>
  </xs:complexType>
  <xs:simpleType name="SecurityExceptionTypes">
    <xs:annotation>
      <xs:documentation>Типы исключений безопасности</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
      <xs:enumeration value="UNAUTHORIZED_REQUEST_EXCEPTION"/>
      <xs:enumeration value="OTHER_SECURITY_EXCEPTION"/>
    </xs:restriction>
  </xs:simpleType>
  <!--components-->
  <xs:simpleType name="FaultTypes">
    <xs:annotation>
      <xs:documentation>Тип ошибки</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
      <xs:enumeration value="SECURITY">
        <xs:annotation>
          <xs:documentation>Непредвиденная ошибка приложения</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="BUSINESS">
        <xs:annotation>
          <xs:documentation>Бизнес ошибка</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
      <xs:enumeration value="UNEXPECTED">
        <xs:annotation>
          <xs:documentation>Ошибка безопасности</xs:documentation>
        </xs:annotation>
      </xs:enumeration>
    </xs:restriction>
  </xs:simpleType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPZ.F7cFsZZpNUsAtZ2OLG_sXAgU.in884P.AH7Hwj6F2JXZ2vV_YS9U6xPEliYdc7Q-</con:url><con:content><![CDATA[<!--edited with XMLSpy v2018 rel. 2 sp1 (x64) (http://www.altova.com) by max (maxim)-->
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" targetNamespace="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:core="http://emias.mos.ru/eboard/core/v1/" xmlns:tns="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:import namespace="http://emias.mos.ru/eboard/core/v1/" schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPZ.F7cFsZZ.M1oO_p_sZ2XpUeMuZkbfWeAHQp.PNHzEB3I-"/>
  <xs:complexType name="AppointmentWithTicket">
    <xs:annotation>
      <xs:documentation>Описание сущности "Запись" c номером талона</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element name="appointmentId">
            <xs:annotation>
              <xs:documentation>Идентификатор Записи, владелец которого другой продукт ЕМИАС</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element ref="core:ticket"/>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="TicketListResultPage">
    <xs:annotation>
      <xs:documentation>Результирующая выборка</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:PagingResults">
        <xs:sequence>
          <xs:element maxOccurs="unbounded" minOccurs="0" name="appointmentWithTicket" type="tns:AppointmentWithTicket"/>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <!--request & response-->
  <!--метод getTicketByAppointmentId-->
  <xs:element name="getTicketByAppointmentIdRequest">
    <xs:annotation>
      <xs:documentation>Входные параметры для метода getTicket</xs:documentation>
    </xs:annotation>
    <xs:complexType>
      <xs:sequence>
        <xs:element name="appointmentId" type="core:ID">
          <xs:annotation>
            <xs:documentation>Идентификатор</xs:documentation>
          </xs:annotation>
        </xs:element>
        <xs:element minOccurs="0" ref="core:options"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <xs:element name="getTicketByAppointmentIdResponse">
    <xs:annotation>
      <xs:documentation>Выходные параметры для метода getTicket</xs:documentation>
    </xs:annotation>
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="core:ticket"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <!--метод getTicketList-->
  <xs:element name="getTicketListRequest">
    <xs:annotation>
      <xs:documentation>Входные параметры для метода getTicketList</xs:documentation>
    </xs:annotation>
    <xs:complexType>
      <xs:sequence>
        <xs:element maxOccurs="unbounded" name="appointmentId" type="core:ID">
          <xs:annotation>
            <xs:documentation>Идентификатор сущности "Запись"</xs:documentation>
          </xs:annotation>
        </xs:element>
        <xs:element ref="core:pagingOptions"/>
        <xs:element minOccurs="0" ref="core:options"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <xs:element name="getTicketListResponse">
    <xs:annotation>
      <xs:documentation>Выходные параметры для метода getTicketList</xs:documentation>
    </xs:annotation>
    <xs:complexType>
      <xs:sequence>
        <xs:element name="result" type="tns:TicketListResultPage"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part><con:part><con:url>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPZ.F7cFsZZ.M1oO_p_sZ2XpUeMuZkbfWeAHQp.PNHzEB3I-</con:url><con:content><![CDATA[<!--edited with XMLSpy v2018 rel. 2 sp1 (x64) (http://www.altova.com) by MESMERiZE (MSM)-->
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" targetNamespace="http://emias.mos.ru/eboard/core/v1/" xmlns:core="http://emias.mos.ru/eboard/core/v1/" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:include schemaLocation="http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService?xsd=AAAADHAjUCM4P2cuZURELmWtRgEBZs.Ve17_KuG_yBn51EvfnP3qRG7eMmmScOWBDGzmdJ1yeBeDP9zAj5i9R_HDapghRX2Re8.vddbsUiS_cedxL_njM.mxBsLTNbQyP0_NFWG49uvlYxwbFPBzCrNYsNV0PVtFs4avLDPsBEUJpzt6KK2zMBAGj3_azKzfqT7P"/>
  <xs:element name="ticket" type="xs:string">
    <xs:annotation>
      <xs:documentation>Номер талона записи</xs:documentation>
    </xs:annotation>
  </xs:element>
  <!--entities(short)-->
  <xs:complexType name="BoardShort">
    <xs:annotation>
      <xs:documentation>Сущность "Электронное табло"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:EntityBase">
        <xs:sequence>
          <xs:element name="status">
            <xs:simpleType>
              <xs:restriction base="xs:string">
                <xs:enumeration value="ACTIVE"/>
                <xs:enumeration value="ARHIVE"/>
              </xs:restriction>
            </xs:simpleType>
          </xs:element>
          <xs:element minOccurs="0" name="archiveDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата архивации</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="createDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата создания табло</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="BoardInfoShort">
    <xs:annotation>
      <xs:documentation>Сущность "Информация о табло" / Изменения в табло</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:EntityBase">
        <xs:sequence>
          <xs:element name="activationDate" type="xs:date">
            <xs:annotation>
              <xs:documentation>Дата активация информации о табло</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="addressPointId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор объекта БТИ(ИД здания)</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="name" type="xs:string">
            <xs:annotation>
              <xs:documentation>Наименование Электронного табло</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="muId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор медицинского учреждения</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="deviceName" type="xs:string">
            <xs:annotation>
              <xs:documentation>Наименование устройства</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="archiveDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата архивации записи</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="textForPatients" type="xs:string">
            <xs:annotation>
              <xs:documentation>Текст сообщения для пациентов, неявившихся на прием</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="RoomShort">
    <xs:annotation>
      <xs:documentation>Сущность "Кабинет"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element minOccurs="0" name="rirRoomId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор кабинета владельцем владельцем которого является другой
                                продукт ЕМИАС(РИР.2)</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="svmrLocationId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор кабинета владельцем владельцем которого является другой
                                продукт ЕМИАС(СВМР.2)</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="number" type="xs:string">
            <xs:annotation>
              <xs:documentation>Номер кабинета</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="RoomShortWithRelevanceAttribute">
    <xs:annotation>
      <xs:documentation>Сущность "Кабинет"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:RoomShort">
        <xs:sequence>
          <xs:element name="isAdded" type="xs:boolean">
            <xs:annotation>
              <xs:documentation>Признак добавления кабинета</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="isDeleted" type="xs:boolean">
            <xs:annotation>
              <xs:documentation>Признак удаления кабинета</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="AppointmentShort">
    <xs:annotation>
      <xs:documentation>Сущность "Запись"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element name="appointmentId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор Записи, владелец которого другой продукт ЕМИАС</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="muId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор МУ</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="startTime" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата начала записи</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="endTime" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата окончания записи</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="status">
            <xs:annotation>
              <xs:documentation>Статус</xs:documentation>
            </xs:annotation>
            <xs:simpleType>
              <xs:restriction base="xs:string">
                <xs:enumeration value="CREATE"/>
                <xs:enumeration value="PATIENT_INVITED"/>
                <xs:enumeration value="CANCELED"/>
                <xs:enumeration value="RECEPTION"/>
                <xs:enumeration value="SKIPPED"/>
                <xs:enumeration value="FINISH"/>
              </xs:restriction>
            </xs:simpleType>
          </xs:element>
          <xs:element name="patientId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор пациента ЕМИАС</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="type">
            <xs:annotation>
              <xs:documentation>Тип события</xs:documentation>
            </xs:annotation>
            <xs:simpleType>
              <xs:restriction base="xs:string">
                <xs:enumeration value="BM"/>
                <xs:enumeration value="DOCTOR"/>
                <xs:enumeration value="LDP"/>
              </xs:restriction>
            </xs:simpleType>
          </xs:element>
          <xs:element name="createDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата создания</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="ResourceShort">
    <xs:annotation>
      <xs:documentation>Cущность "Ресурс"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element name="availableName" type="xs:string">
            <xs:annotation>
              <xs:documentation>Наименование доступного ресурса</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="availableResourceId" type="xs:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор доступного ресурса</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="rirRoomId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор кабинета владельцем владельцем которого является другой
                                продукт ЕМИАС (РИР.2)</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="svmrLocationId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор кабинета владельцем владельцем которого является другой
                                продукт ЕМИАС(СВМР.2)</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="complexResourceId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор ресурса</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="AppointmentStatusHistoryShort">
    <xs:annotation>
      <xs:documentation>Сущность "История статусов записи"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element name="createDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата создания статуса</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="status" type="xs:string">
            <xs:annotation>
              <xs:documentation>Статус</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="EmployeeShort">
    <xs:annotation>
      <xs:documentation>Сущность "Врач"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:Base">
        <xs:sequence>
          <xs:element name="specialityId" type="core:ID">
            <xs:annotation>
              <xs:documentation>Идентификатор специальности</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="specialityTitle" type="xs:string">
            <xs:annotation>
              <xs:documentation>Наименование специальности</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="lastName" type="xs:string">
            <xs:annotation>
              <xs:documentation>Фамилия врача</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="firstName" type="xs:string">
            <xs:annotation>
              <xs:documentation>Имя врача</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element minOccurs="0" name="middleName" type="xs:string">
            <xs:annotation>
              <xs:documentation>Отчество врача</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <!--entities(extension)-->
  <xs:complexType name="RoomExtension">
    <xs:annotation>
      <xs:documentation>Расширенные сведения о Кабинете</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:RoomShort">
        <xs:sequence minOccurs="0">
          <xs:element minOccurs="0" name="appointments">
            <xs:annotation>
              <xs:documentation>Коллекция "Запись"</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="1" name="appointment" type="core:AppointmentExtension"/>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="AppointmentExtension">
    <xs:annotation>
      <xs:documentation>Расширенные сведения о Записи</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:AppointmentShort">
        <xs:sequence>
          <xs:element name="resource" type="core:ResourceExtension">
            <xs:annotation>
              <xs:documentation>Ресурс</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="statusHistory">
            <xs:annotation>
              <xs:documentation>Коллекция "История статусов"</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="unbounded" name="status" type="core:AppointmentStatusHistoryShort"/>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
          <xs:element ref="core:ticket"/>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="ResourceExtension">
    <xs:annotation>
      <xs:documentation>Расширенные сведения о Ресурсе</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:ResourceShort">
        <xs:sequence>
          <xs:element minOccurs="0" name="employee" type="core:EmployeeShort">
            <xs:annotation>
              <xs:documentation>Врач</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="BoardExtension">
    <xs:annotation>
      <xs:documentation>Расширенные сведения об Электронном табло</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:BoardShort">
        <xs:sequence>
          <xs:element name="boardInfo" type="core:BoardInfoExtension">
            <xs:annotation>
              <xs:documentation>информация о табло</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="AppointmentWithRoomShort">
    <xs:annotation>
      <xs:documentation>Сведения о Записи пациента и Кабинете</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:AppointmentShort">
        <xs:sequence minOccurs="0">
          <xs:element name="room" type="core:RoomShort"/>
          <xs:element minOccurs="0" name="statusCreateDate" type="xs:dateTime">
            <xs:annotation>
              <xs:documentation>Дата создания статуса</xs:documentation>
            </xs:annotation>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="BoardInfoExtension">
    <xs:annotation>
      <xs:documentation>Расширенные сведения о "Табло"</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:BoardInfoShort">
        <xs:sequence>
          <xs:element minOccurs="0" name="rooms">
            <xs:annotation>
              <xs:documentation>Коллекция "Кабинет"</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="unbounded" name="room" type="core:RoomShort"/>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="AppointmentFullInfo">
    <xs:annotation>
      <xs:documentation>Расширенные сведения о Записи</xs:documentation>
    </xs:annotation>
    <xs:complexContent>
      <xs:extension base="core:AppointmentShort">
        <xs:annotation>
          <xs:documentation>Идентификатор табло</xs:documentation>
          <xs:documentation>Наименование табло</xs:documentation>
        </xs:annotation>
        <xs:sequence>
          <xs:element name="resource" type="core:ResourceExtension">
            <xs:annotation>
              <xs:documentation>Ресурс</xs:documentation>
            </xs:annotation>
          </xs:element>
          <xs:element name="statusHistory">
            <xs:annotation>
              <xs:documentation>Коллекция "История статусов"</xs:documentation>
            </xs:annotation>
            <xs:complexType>
              <xs:sequence>
                <xs:element maxOccurs="unbounded" name="status" type="core:AppointmentStatusHistoryShort"/>
              </xs:sequence>
            </xs:complexType>
          </xs:element>
          <xs:element name="room" type="core:RoomShort"/>
        </xs:sequence>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
  <xs:complexType name="DateTimePeriod">
    <xs:annotation>
      <xs:documentation>Временной период (дата)</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element minOccurs="0" name="start" type="xs:dateTime">
        <xs:annotation>
          <xs:documentation>Дата и время начала периода</xs:documentation>
        </xs:annotation>
      </xs:element>
      <xs:element minOccurs="0" name="end" type="xs:dateTime">
        <xs:annotation>
          <xs:documentation>Дата и время окончания периода</xs:documentation>
        </xs:annotation>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part></con:definitionCache><con:endpoints><con:endpoint>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService</con:endpoint></con:endpoints><con:operation id="26499c5e-34c6-40cd-a451-733792ff5989" isOneWay="false" action="getTicketByAppointmentId" name="getTicketByAppointmentId" bindingOperationName="getTicketByAppointmentId" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="b9f1001b-4169-4bc4-8679-43d5eff875ae" name="Request 1"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">\r
   <soap:Header>\r
      <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">\r
         <wsse:UsernameToken wsu:Id="UsernameToken-dde29318-7f58-41b5-b846-033fd8698b25">\r
            <wsse:Username>EIM/EIM</wsse:Username>\r
         </wsse:UsernameToken>\r
      </wsse:Security>\r
      <ns3:userContext xmlns="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:ns2="http://emias.mos.ru/eboard/core/v1/" xmlns:ns3="http://emias.mos.ru/system/v1/userContext/" xmlns:ns4="http://emias.mos.ru/system/v1/faults/">\r
         <ns3:systemName>EIM</ns3:systemName>\r
         <ns3:userName>EIM</ns3:userName>\r
         <ns3:userRoleId>7187</ns3:userRoleId>\r
         <ns3:isUserRoleSystemWide>true</ns3:isUserRoleSystemWide>\r
         <ns3:userRights>\r
            <ns3:userRightId>505401</ns3:userRightId>\r
         </ns3:userRights>\r
         <ns3:jobExecutionId>0</ns3:jobExecutionId>\r
      </ns3:userContext>\r
   </soap:Header>\r
   <soap:Body>\r
      <getTicketByAppointmentIdRequest xmlns="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:ns2="http://emias.mos.ru/eboard/core/v1/" xmlns:ns3="http://emias.mos.ru/system/v1/userContext/" xmlns:ns4="http://emias.mos.ru/system/v1/faults/">\r
         <appointmentId>391922498373</appointmentId>\r
      </getTicketByAppointmentIdRequest>\r
   </soap:Body>\r
</soap:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://emias.mos.ru/eboard/ticketService/v1/ticketServicePortType/getTicketByAppointmentIdRequest"/><con:wsrmConfig version="1.2"/></con:call></con:operation><con:operation id="147db653-c5e0-4a4a-af56-ff35efe08386" isOneWay="false" action="getTicketList" name="getTicketList" bindingOperationName="getTicketList" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="831569e3-8b69-4333-b783-0f242f621402" name="Request 1"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://esbcamelvv.test.emias.mos.ru/proxy/eboard/ticketService/v1S/ProxyService</con:endpoint><con:request><![CDATA[<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:user="http://emias.mos.ru/system/v1/userContext/" xmlns:typ="http://emias.mos.ru/eboard/ticketService/v1/types/" xmlns:v1="http://emias.mos.ru/eboard/core/v1/">\r
   <soap:Header>\r
      <user:userContext>\r
         <user:systemName>?</user:systemName>\r
         <user:userName>?</user:userName>\r
         <user:userRoleId>?</user:userRoleId>\r
         <!--Optional:-->\r
         <user:isUserRoleSystemWide>?</user:isUserRoleSystemWide>\r
         <user:userRights>\r
            <!--Zero or more repetitions:-->\r
            <user:userRightId>?</user:userRightId>\r
         </user:userRights>\r
         <user:jobExecutionId>?</user:jobExecutionId>\r
         <!--Optional:-->\r
         <user:hostIp>?</user:hostIp>\r
         <!--Optional:-->\r
         <user:hostName>?</user:hostName>\r
         <!--Optional:-->\r
         <user:options>\r
            <!--Zero or more repetitions:-->\r
            <user:entry key="?">?</user:entry>\r
         </user:options>\r
      </user:userContext>\r
   </soap:Header>\r
   <soap:Body>\r
      <typ:getTicketListRequest>\r
         <!--1 or more repetitions:-->\r
         <typ:appointmentId>?</typ:appointmentId>\r
         <v1:pagingOptions pageNumber="?" pageSize="?">\r
            <!--Optional:-->\r
            <v1:sortingOptions>\r
               <!--1 to 3 repetitions:-->\r
               <v1:sortOrder attributeName="?" desceding="false"/>\r
            </v1:sortingOptions>\r
         </v1:pagingOptions>\r
         <!--Optional:-->\r
         <v1:options>\r
            <!--Zero or more repetitions:-->\r
            <v1:entry key="?">?</v1:entry>\r
         </v1:options>\r
      </typ:getTicketListRequest>\r
   </soap:Body>\r
</soap:Envelope>]]></con:request><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://emias.mos.ru/eboard/ticketService/v1/ticketServicePortType/getTicketListRequest"/></con:call></con:operation></con:interface><con:interface xsi:type="con:RestService" id="549713aa-800b-4cff-a8d1-527019b0fa9e" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://ehr-index-elasticsearch.svc-emias-registry.test.emias.mos.ru" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache/><con:endpoints><con:endpoint>http://ehr-index-elasticsearch.svc-emias-registry.test.emias.mos.ru</con:endpoint></con:endpoints><con:resource name="_search" path="/default_registry/_search" id="d4a9130d-2040-4c83-acb5-04e21a0fa12e"><con:settings/><con:parameters/><con:method name="_search 1" id="cc670906-83e6-43a4-b15f-c81b407b6ee3" method="GET"><con:settings/><con:parameters/><con:request name="Request 1" id="d484eb6b-213f-4a1f-8473-ff5731663202" mediaType="application/json"><con:settings/><con:endpoint>http://ehr-index-elasticsearch.svc-emias-registry.test.emias.mos.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:testSuite id="3bb400a9-390e-4367-85f3-41c306cd0b4a" name="Получение и обновление токенов СУДИР и ЛК(контуры Солит и Тест) Яна"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="cc72486c-4ac9-4dbf-882e-baf0d943abee" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получение токена СУДИР и токена ЛК" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Получение client_Id client_secret (шаг 1)" id="e1ff245b-5306-4a1b-a62b-32332c5bc739"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/register" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение client_Id client_secret (шаг 1)" id="1acba04c-b558-4b14-94b3-193346516e38" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer jIeAUJjALkvjRcU_wAcASnNNc9ovLxhApSnJfqt2JLcRw_jCyugGxXfMdPVBayeiPj0pmufDqQxmE9ofd8Rnww" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request>{
"software_id": "CSI",
 "device_type": "android_phone",
 "software_statement": "${#TestSuite#softwareStatement}"
}</con:request><con:originalUri>https://login-tech.mos.ru/sps/oauth/register</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2013d0e-b347-454d-bc12-f33e5b820ccc" name="Valid HTTP Status Codes"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись client_id client_secret" id="10655cd5-677c-4a5b-b5ba-af861e2407b9"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_id</con:sourcePath><con:targetType>clientId</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_secret</con:sourcePath><con:targetType>clientSecret</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Кодирование в base64 + составление запроса" id="4e1e14cb-bca8-41c5-92de-61ffbe381cb4"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
//testRunner.testCase.testSuite.project.setPropertyValue("base64",auth)

////////////Составление запроса. Ссылка для авторизации///////////

link = sudirUrl+"/sps/oauth/ae?client_id=$client_id&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile"
testRunner.testCase.setPropertyValue("link",link)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)
login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)</script></con:config></con:testStep><con:testStep type="manualTestStep" name="Действия со ссылкой" id="e449892e-6a47-420e-ad47-910faedf10fb"><con:description>1. Скопировать ссылку из проперти кейса (link)
2. Открыть консоль разработчика в браузере (F12)
3. Вставить скопированную ссылку
4. Ввести логин/пароль и капчу (
ЯНА: логин: med_test_2022@bk.ru, пароль:OOYY2t2hooy#3
Аккаунт для БВТ: логин:e@rdf.ru пароль: Mm123456
 )
5. Нажать войти
</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="delay" name="Delay" id="788c5440-660a-413a-95e4-fff644eb9b9b" disabled="true"><con:settings/><con:config><delay>50000</delay></con:config></con:testStep><con:testStep type="manualTestStep" name="Подтверждение и копирование кода" id="2445c33b-ad68-49e6-ae17-7e1fa7229420" disabled="true"><con:description>1. Нажать кнопку "Подтвердить"
После получения данного кода есть минута, чтобы отправить следующий запрос
2.Скопировать код из консоли разработчика
3. Вставить код в проперти кейса (code)</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="restrequest" name="Получение токена СУДИР" id="d37bc401-8f7a-44d9-87df-5430dac50f96"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение токена СУДИР" id="26f90063-1811-4565-b889-d93e4d165864" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="fd19a4af-366b-4fed-8e55-939a693dbce6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="code" value="${#TestCase#code}"/>
  <con:entry key="grant_type" value="authorization_code"/>
  <con:entry key="redirect_uri" value="https://emias.info/sudir-mobile"/>
</con:parameters><con:parameterOrder><con:entry>grant_type</con:entry><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Записать токен СУДИР и refresh" id="f23d97c1-b6d2-4ab4-a29e-9fb9a570748f"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получение токена СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)

log.info sudir_token.access_token

testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Получение данных о пользователе" id="1afbaadd-33fb-4104-8188-73e5f03a6174"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/me" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение данных о пользователе" id="e34c85f0-463c-454a-bb0f-a0f8070e9b0a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2a895841-cf20-40c7-a34a-86a7e5719b50" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="Bearer ${#TestSuite#sudirToken}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись guid" id="784c37f4-2fc4-4d02-adef-acbb9de93d8e"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid2</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#Global#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Зарегистрировать инстант" id="1d9a9456-0ad7-4d84-9719-47d90d65f4a0"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Зарегистрировать инстант" id="60261039-b4ea-4d59-9649-f46e0fc1f793" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "instanceToken": "${#TestSuite#clientId}",
  "sudirToken": "${#TestSuite#sudirToken}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance</con:originalUri><con:assertion type="Simple Contains" id="ca95a9e3-62a6-424f-a200-baaf7d074f58" name="Contains"><con:configuration><token>attemptToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК2" id="ac85b7dc-5d57-4b94-aacf-f95730d8b1b5" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК2" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение attemp-access" id="6c94c500-84c4-4f4e-9ba0-fc946943d659"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Зарегистрировать инстант"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Зарегистрировать инстант#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attemptToken)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="dd446436-3613-4016-8bc9-b533fc0e76c0"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/confirm-instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="33cd7c74-7696-4e79-b652-2c604d7a36bb" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
    "otpCode": "${#TestCase#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:originalUri>https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance</con:originalUri><con:assertion type="Simple Contains" id="3d630dca-8dc0-493c-ba56-a3d039abaa84" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение X-Access-JWT" id="0860fa72-2d3e-458e-9796-e9bcfaf065c8"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Подтвердить токен#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
base64 = testRunner.testCase.testSuite.getPropertyValue("base64")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("base64", base64)
guid = testRunner.testCase.testSuite.getPropertyValue("guid")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="transfer" name="Записать токены ЛК" id="ab7f0c86-4909-464b-b8e1-ae0f39c3a501" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.accessToken</con:sourcePath><con:targetType xsi:nil="true"/><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>refresh_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.refreshToken</con:sourcePath><con:targetType>refresh-X-Access-JWT</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК" id="d6c7f64b-5281-4537-953e-658eaeba3515" disabled="true"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Acces-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="Authorization" value=""/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="4cdd03a8-2779-4ac1-bf89-dd5b643a8921" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#TestSuite#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="получить все emiasid из ответа" id="380c8ae9-8701-4f59-ad7c-d8ede0f3a0f2" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper
import groovy.xml.XmlSlurper

response = context.expand('${Посмотреть привязанных пользователей#Response}')
parsedResponse = new JsonSlurper().parseText(response)

ids=parsedResponse.permissions.emiasId
log.info ids.toString().replace("[","(").replace("]",")")

id=10133820
for(int i=0; i&lt;parsedResponse.permissions.size(); i++){

	if(parsedResponse.permissions[i].emiasId == id){ log.info parsedResponse.permissions[i].policyNum; break}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=dyn~emias.info~a01f6559-9049-41ae-b420-98b3058a19a4&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property><con:property><con:name>code</con:name><con:value>bCOnyXOZz7GS7OSPKNbq8Purb2-n0Om9KpdOLyfUUf99jMjQlNgvyUdVL-Xdct6_ZKFQGlBzFNqkFDQpvpaqMkwsxjGf-y7k0t9U5v_UTIc</con:value></con:property><con:property><con:name>client_id</con:name><con:value>dyn~emias.info~6107c753-e239-4ca3-b24b-88beed8482be</con:value></con:property><con:property><con:name>client_secret</con:name><con:value>qjyNvLRWSl80GgU</con:value></con:property><con:property><con:name>access_token</con:name><con:value>Q-F5iygkgbwX82WAwlrw9VZtIRJo23IeTI8M_38uh19jZWJhYThlZC0yNThhLTQ2ZWYtYTZiZC1lZjEzZDdiZWM1MjI</con:value></con:property><con:property><con:name>guid</con:name><con:value>af3e4ac5-96dd-4167-afb3-244eb7187aba</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiJlNTQzNzAxNS1lODQwLTRlMTAtYTBiNi05MDU2MjYzYWFhYzEiLCJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTcwNzUyODAsInN1YiI6Ijc1ODM1Y2I3LTllMjctNGFjYi1hOTVkLWE5ZGIzNGU5NjQxZSIsImhjbiI6NjE5MCwiYXVkIjoiUEFUSUVOVCIsInNzb19pZCI6IjEwZDU5MDgwLTczYTItNDU4Ny05OTMxLWMxOGZiOTA4MzFiMiIsImFtciI6W10sInBheWxvYWQiOnsiaW5zdGFuY2VfdG9rZW4iOiJkeW5-ZW1pYXMuaW5mb35hMDFmNjU1OS05MDQ5LTQxYWUtYjQyMC05OGIzMDU4YTE5YTQifX0.XVpCujUepm8voa4IaxYovHeCVbWmZpI6yozwzi-J24xAFUsblC0sEh4sXXWX73JWwkCmkIjPrXsrIrydZJMfPo6PKOD6sGhWWvgVbDxEIJ5904yzsXog7vT32jK50wq44Mj-s7E-bO9D5YeDLP7AQYxZV06xYd0et3hPdZsBJndJyVAe_UyDXQlClmyBbDEA4lqDOb8b1Dw-3EsncP9U7Fw8jQ2xIdaGyYfPKDVQPXzVKvYlsKzRZiIWppYcCyVWMMa3dS9oGHsrQ_dfFYRg77A6XGscvNrUxOoCeYKnuWq91RuB0ABb3KduBKxw6gapA3mjNP3_btDJ4eMbq_9d1VR2QSEKNaat_Vw-__qoYtADcI7iXNBtgzi7xA9qIAzTLPxWzK6Drl2PmRm4Cea9hI-P53OfUjaN12yGnYTfi3mvpGYlih_iS4Qph7lV6pNg9EN-Ub2udwaikksRu4gQXXjI0DkDIhGCz8CpjUpJjHACwk2pYa7FpSwq-GjY0JltMLBHL_KQ0W82VHbvGfewIytxYcXtJASIVEPrTSgq-Hi_gUeWHLlreDNA8uzErcDhavqmfrc7dfTQAiEFvo5wdZdqodQijsZ4o0lHppuvCO6AxkRf7F5uq3N1znQtLF4OS4gG0yBBS4Q7zNA7FUfA_57J0IFltnwaEK4LktBTH_U</con:value></con:property></con:properties></con:testCase><con:testCase id="c4dc3d8e-7db8-4b9b-8a5a-5d8bc797b57c" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента и добавить в медкарту" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="2547c544-8b9d-4941-adc0-933bf7f63120"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="70f3211c-7e80-4bc6-af17-d8cbd8abdcac"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства второго пациента" id="8a258820-e38c-4fe0-915c-f743fa3d525b"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="Найти пациента в базе СУПП по patient_id" id="59293b01-802f-4210-a8ca-2cb0e629e636"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, 
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE PATIENT_ID=${#TestCase#patientId} </con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Найти рандомного пациента в СУПП" id="6e5b7178-6882-496f-a219-61c3c226d57f"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER,OMS_NEW_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE ((OMS_ASSURANCE_SERIES is not null and OMS_ASSURANCE_NUMBER is not null) or OMS_NEW_ASSURANCE_NUMBER is not null )
AND ROWNUM&lt;50
ORDER BY DBMS_RANDOM.VALUE</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="Добавить пациента в медкарту" id="e84b6df4-1531-4ff8-8221-580ba3b1e353" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Добавить пациента в медкарту" id="a5f68023-dec0-442a-9721-e4a177894c76" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "documentId": "string",
 "id": "string",
 "permissionType": "CHILD",
 "userInfo": {
  "userName": "Яна Михайловна В.",
  "phoneNum": "79265209207",
  "ssoId": "af3e4ac5-96dd-4167-afb3-244eb7187aba"
  },
  "createDate": "2023-04-18",
  "patientInfo": {
    "patientName": "${#TestCase#name} ${#TestCase#middleName} ${#TestCase#lastName}",
    "birthday": "${#TestCase#birthDay}",
    "emiasId": ${#TestCase#patientId},
    "policyNum": "${#TestCase#series} ${#TestCase#omsNumber}"
  }
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/1/user/grant-permission</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="f30d0dd7-89eb-41cc-b7ae-8e3a80e283a0" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Получить токен" id="87ace4a1-c37b-4faf-b395-4920eca5aa74" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/login" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить токен" id="3b40c73f-e9cf-4762-8875-d5f43b1bb979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "code": "med_test_2022@bk.ru"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/login</con:originalUri><con:assertion type="Simple NotContains" id="2b30274b-96a2-4696-981c-a6342eba3ef7" name="Not Contains error"><con:configuration><token>error</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="5812c462-9482-4e8d-b95f-4ad1d19e6230" name="Valid HTTP Status Code 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить attemp-access" id="e5ff0b27-6a3f-480b-bf65-5b8b3de415d0" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Получить токен"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Получить токен#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attempt_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="d1b32213-4845-4467-9253-1dd83bff9d2d" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/confirm" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="3827440b-59d7-4e3f-82f2-7e31523ea53c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "otp_code": "${#TestCase#x-otp}",
  "refresh_token_ttl_seconds": 0,
  "access_token_ttl_seconds": 0,
  "attempt_token": "${#TestCase#attempt_token}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/confirm</con:originalUri><con:assertion type="Simple Contains" id="aef0c267-6bdb-4264-9f13-e58bac6df0a6" name="Contains"><con:configuration><token>access_token</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен в свойства" id="617876a6-1c58-4948-9549-558bfe3121df" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.access_token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Получить список прикрепленных" id="e5f10d0c-9153-409b-b7e5-7bd238043182"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/profile" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить список прикрепленных" id="31babd50-0726-4247-bc7a-7409f01fa367" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/profile</con:originalUri><con:assertion type="Simple Contains" id="ab8aa89d-e818-47d9-b829-7850fe93c133" name="Contains"><con:configuration><token>relatives</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="X-Access-JWT" value="${#TestSuite#X-Access-JWT}"/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить ehrId пациента" id="db6ccf8a-71a5-4027-9737-17f70bcee859"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получить список прикрепленных#Response}')
d = new JsonSlurper().parseText(ResponseJson)
birthDay = testRunner.testCase.getPropertyValue("birthDay")
oms = testRunner.testCase.getPropertyValue("oms")
lastName = testRunner.testCase.getPropertyValue("lastName")
name = testRunner.testCase.getPropertyValue("name")
middleName = testRunner.testCase.getPropertyValue("middleName")

fullName=name+" "+middleName+" "+lastName[0]+"."

for(def elem : d.relatives){
	if(elem.birthDate ==birthDay &amp;&amp; oms==elem.policyNum &amp;&amp; elem.firstName==fullName){
		log.info elem.profileId
		testRunner.testCase.setPropertyValue("ehrId", elem.profileId)
		break
	}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>7066630284</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>patientId</con:name><con:value>31110819</con:value></con:property><con:property><con:name>oms</con:name><con:value>7791889720000557</con:value></con:property><con:property><con:name>lastName</con:name><con:value>Сафрошкин</con:value></con:property><con:property><con:name>name</con:name><con:value>Олег</con:value></con:property><con:property><con:name>middleName</con:name><con:value>Юрьевич</con:value></con:property><con:property><con:name>birthDay</con:name><con:value>1984-02-13</con:value></con:property><con:property><con:name>token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2Nzk0OTk1NjgsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJiYjVlYjg1OC1lZjc2LTQyOTUtOTg1OS1jOWQ2YTI1MWIzNTAiLCJzaWQiOiJmMjBlMWJmNC0yZWNjLTRlYTMtOTRjZi1iMTliMzc3ZDYyY2QiLCJwaG9uZSI6Ijc5MTU5Njc5MjMwIiwic3NvX2lkIjoidzlzMGZSVEFXVE9VRWQ5VisremF0c3NsdFVXZnI5UFBIUEhoR1hzYzU3U05QL0ZwcGlOZWo2RzlhaVdXRmdielhHdVcyai9mdk5CalY3WkhlTDRjbGVPVTVEODRjT0RjSk5FNjhKSzBFNnJyT3o0bG8rZnM4cVZIc09rM3hyS1FaZmJUM3NweGgvUUdaaUMvU2JhMjQ3T1MvdVN1VnVYTVVySjUyM1RwSlJNd3RLRnliNXljQXU4b3h5dlYwTXVDVHhZSElOKy9OTU9ubnhvckRFMnIycW05YmwvTjV1QWE4c1B3Lyt6TXJYT1FXdm1PVXZWaUVvbHJXeXkwaS95Z215bjk3TWNtQVRnQ1JLQlE1MmJpTG5PbE41VVRiRi9lc1JCY3Mzb1FVVjc5YTlXTkMxTC9RakxtajdoVUJaY0tkbXJLL2JKaXhMQmp0bW0vL2ZFV1hBPT0iLCJlbWFpbCI6Inlhci5wcm9tby56YXBvdi5hQGdtYWlsLmNvbSIsImZpcnN0X25hbWUiOiJcdTA0MjFcdTA0MzVcdTA0NDBcdTA0MzNcdTA0MzVcdTA0MzkiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMi4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxMlx1MDQ0Zlx1MDQ0N1x1MDQzNVx1MDQ0MVx1MDQzYlx1MDQzMFx1MDQzMlx1MDQzZVx1MDQzMlx1MDQzOFx1MDQ0NyIsImJpcnRoX2RhdGUiOiIxOTc4LTAzLTIyIn0.U56ljjFNsiTlPAubVFSPnALoKcdCCkugqFUNKowxR1CAPe32wlLylF-iTmNF1NqjUm2iVwdV1gIOAZQPl5wKGKYNlAESK59wVfgNDlvuNaHhSLvkZbUtVXHDoSN_HROBiNcGpgrTYvK3X4yXJpXjnif_mehsnuQpn9PLR5hcCg-SXiZ4pbH_ovdhd1YI-d5lNM-IBG6WURBwCU7St7SjjxojxcR8Dtq6HmvsfGtgYBkwu13keryRjRUuWkuWizK5aNHmyxlhsN77IXTVLF-TbfbOZ-BeYFNZXqoMVeImGWVoMUsK3sKc0QpYy1ma81lZvjYBLBYMiCOK8NoY84ZOFd0-xRQ7XdXauDy0-HsQfPxab6pxigvKkx8mgbRkucLhWS_xM0dEVmY5CG7rSB0kNVgmyA4HZufTHHysr1En_a7HE_flx4odcnyQyO1nMKm_dYqzAOFFyYuYHhOJjE_x-FBsfybDSLxKeBiGXbRUTnhGPlmUus_Gs0dVYL0ZyD9aBl8Yh0uiWBMe_yz2KEdTZ__h6bX-RbgAi0lWs3OTQF19XXa5PRZ2w2ftvoJD5JhVvYl-Uf6Lagzox9i8_loWD4GxczbPCU8-dktpmWe-N_fb5O41G6zWcnOvIdOQB8k2u4K89dLr8hNHzcxYlmNNqMm9Em1mYQbzqDHXOxhFFSE</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpZCI6IjdlMjVhYjIzLWUwYTMtNGUxOC05MDNlLWI3MmMwNjYzNjQyNCIsImlzcyI6InVzZXJfYXV0aCIsImV4cCI6MTY3OTQxNjQ1Miwic3ViIjoiYmI1ZWI4NTgtZWY3Ni00Mjk1LTk4NTktYzlkNmEyNTFiMzUwIiwiaGNuIjo1LCJhdWQiOiJQQVRJRU5UIiwic3NvX2lkIjoiQ3Bwb3hwbE56b3M0L2h6RmEycm91S0lORXRQWnpiYkpTNmxlYmRJTDBTbHNNdDgyOEJDYXNMbGRWZHJ1TmZ2S0t2T0J4Ujd1V09RNjdCenpWSkM5aXpNaFd1akVTWnlrczhyb2FqL2VxNEZESnhTakR5aHdNYlo5UFNVam1xdCtyRUJjUHBGV3RRYVdWQk1UQlN1VldoN01xSzc4MHBlL283MGpIZUcxYUpveWlIZU5XaCtsUUhoUy94RHUzUXFKbEFhMEU5S3A3TTk3KzdLR1FoWFVEWVJ5eE1GMm5nZC91MXdCbXdhWkZjeXZkY003TWFRNTBRdUhmeUVORnQwZjRpS0lWL1pIQ0F0QS9qRTdwODRkMFFobXJudmc1TzgrZHZSS1hRb3htdzFWS3RkUVBPckJDMVltd2xtNTNWUU1ac0tRbFZJY2FCSkJEcTFpK2RycnlnPT0ifQ.hZxYie4xivThXf9tN1KLaYunCHqYJIq5XtQ6w24ku2JlVIV75hK54L0ZTtOsMyfOZe-epPyWsOQJBoDM7Z1-l55-Il-AEzjDtM-GBa_uiTiGkB3uvLhHoevWfFil5rwl7-ZEAxldIh5KkL8DzoXQ5K5XLACGgLQpEWPIdGiaWtlD_J3ZX9mfnFKgtPrDbKA-RGIWR9gsk9Kyxm8M_r5zeD-WCAVUNp-veEsGfOrzk2s6u-wOy72nzS97utiaulPEDNvsU7E-zsrBqn3YdRSXgnd4fR3NpwiXTTcSQ8K-D9e1JfNUVbNXpTf6OqiR24sFVH4gaJgsdmfuGT-4byfiygv9RZVhPbint3llTk2Rn15wNoAZJqe3hWgO--gJ7GPKfb_RFhUjquZliI3SI42jcySQRbSVXioJfObmo4LVrJwioyV8IBgsrJKDJ66RFeHPCABek_ktAh_GwAB17FlnXU3dDJ3WSv_jUq3R0-eyx5nAVhlxFqWqdTN5ladfGbOrMebF5IiIGFtxzUNxe1rQGe_1_2f8jumEDDsgkBlaIHQa8O52M1KwVMDDeW-OaL4jnG9OYDcX-1R1iG9jvXpiJh9fsx9Ng5eiYP8OYJsNojczD9vzizyjSxBh6qwze03fXDy5G9rqytp0CpwpcxvNYpi6msgjbF7JoDLuM6SBUuU</con:value></con:property><con:property><con:name>ehrId</con:name><con:value>95706443-b316-4442-894c-748da1962c80</con:value></con:property><con:property><con:name>sixMonthsAgo</con:name><con:value>2022-09-24</con:value></con:property><con:property><con:name>lastNameFirstLetter</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="76e8cac5-6535-4a98-aa14-5d64111b1530" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента по омс" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="9851919f-ed77-441a-ac9f-8c2e4a634fa6"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="67234809-cab1-42c6-b0e6-e2d493a00601"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDate</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>id</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>710271440</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>id</con:name><con:value/></con:property><con:property><con:name>oms</con:name><con:value>770000710271440</con:value></con:property><con:property><con:name>lastName</con:name><con:value/></con:property><con:property><con:name>name</con:name><con:value/></con:property><con:property><con:name>middleName</con:name><con:value/></con:property><con:property><con:name>birthDate</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="a122720e-dcb8-4baf-8d40-afadf1169469" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР" searchProperties="true"><con:settings/><con:testStep type="groovy" name="обновить base64" id="f0286275-d09f-44b5-b781-1b9395971913"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить токен СУДИР" id="7384787f-363f-4c26-b0dd-c3cbd916c0c0"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="обновить параметры для сервиса tokens" id="cc4d7dc4-928c-45eb-ab5e-40fa3ece0100"><con:settings/><con:config><script>login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
guid = testRunner.testCase.testSuite.getPropertyValue("guid")

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="49396a54-7728-4919-831e-20da39de1d88"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)
log.info "EI-Token "+sudir_token.access_token</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="2f81d2f3-077f-47ec-8876-6937b0b7a49f"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="843e0090-6f80-48c7-b57c-4b5a5c73ff7f"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)

log.info "X-Access-JWT  "+access_token.accessToken</script></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=null&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property></con:properties></con:testCase><con:testCase id="45203384-d5e1-4401-8692-19e44555083b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти актуальную др пациента" searchProperties="true"><con:settings/><con:properties/></con:testCase><con:testCase id="d681a353-0098-4a77-93a6-513389d5b305" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Привязать пациента к пользователю" searchProperties="true"><con:settings/><con:properties/></con:testCase><con:properties><con:property><con:name>sudirToken</con:name><con:value>FTRVzJHbx6COKRRpWuoWvx1f3X0_n1NVKDYCMofytm8wZWMzMDUxMC1hODNmLTRmYTEtYWFkNy1jM2MxZjhhN2JmYTU</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTcwNzUyODEsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiI3NTgzNWNiNy05ZTI3LTRhY2ItYTk1ZC1hOWRiMzRlOTY0MWUiLCJzaWQiOiJmZGJkODIzZS02MTdjLTRkNzUtYjM1ZC1jZjkyNmU0Nzc1NDEiLCJwaG9uZSI6Ijc5MTUwMDQ5NzY2Iiwic3NvX2lkIjoiZVoyc1g3MUxwekZjZ3BrZG5pUXVLejNKOWhWK21zZFNsWDBPdVBtZWExZllwTWFpWi9sWVljSDU0amt0cXB6RDJ6dEVlait1Z1BpbVFrUVNhQStZRXVmN1dtV05YV0I4QlZkSFBtYU9BNWhNeGsrRWlzS0pvNXZGMUJWeXFGNU1qYXRzNFNaT0lFRVhaemwvdkorSFVQenJIOEpnQ1RXVk9XdHc3KzQzWnc4VDNReDA0Y3hEUXRNZ0VydGdkdVlRVkk4ZldRbE5OWGVkN1V1aXlLNytyRkprZFlqQ0xaTkV0blZ5RFcvZFRvS1RoWTMzUGFIb0hFanNNUlRScnNxZW4xQVlpOGNjR01xWFppc29iRjhNek52cTVhTUw4MVRqRzh0emEwOTlaMk5FNU10c3FRK2JQRTlFUnVrTUxwMVJqNnpIOXQ1SnE3MkFZTlBVVUd4dktBPT0iLCJlbWFpbCI6Imdvb2R3aW5sYXVyYUBleGFtcGxlLmNvbSIsImZpcnN0X25hbWUiOiJcdTA0MjVcdTA0MzBcdTA0M2RcdTA0NDNcdTA0M2MiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMC4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxN1x1MDQzOFx1MDQ0MFx1MDQzMFx1MDQzY1x1MDQ0M1x1MDQ0Mlx1MDQzNFx1MDQzOFx1MDQzZFx1MDQzZVx1MDQzMlx1MDQzZFx1MDQzMCIsImJpcnRoX2RhdGUiOiIyMDAxLTA2LTA2IiwiYW1yIjpbXX0.JWxeNGlyMMozhEeKQzmEjw-9HG8BCdQKVGeL5f3Sxw4JXiylcZPwCWl2JVqCjxvVdNNwPZus2ZnQ-cudzAADIfy-ONLoxe8Ors_zsMEvGL9xzqfdNCoCKOmWhGgj_kZB-1qHhRkyEuFf6ep9ALH7V3hnmKB0dkc0H8LXf0wD6v7kisdWM2-g4xNnwV4qaiQeeMcUMzWmq7aSONgKjK5MMTD7pEj72J_CgK5LJly5zRJeINrgWBXHi60CbAwjjWQvjWOSda0F3_gFYmb5i7a6p1Wke0hv67zL3xS6sGB9_txNkf3fb5uaHVdvk3MKyOpAai82vheR5SgEcVXTgtaNoVWi3QIof1DkAEZHoIV_veGxh-cj2hPybWEkbBATq5gfk7rw21bLUCWL9iCxcMyDqdrMUwI9CY3iWCf_DJownfeB_1jAzSl6_fhg2rw7XNumTaOxOaztNz9PLQ9QM3BwCOQtucjlTGsUFlFhZ1X3pc5R3-cZBRmTxvbojdBk9OvLrLQbjBR1lX7LYIwW4pc8zAzDh3J4YwSipUlgINlq9SNH4qisYTkP-Qs4h1XZF5Dqq4j4lvpMGXMlqC4wfw5j1LcpFJJPL4nEbzodyCjibu2au4ZtHdWLvwPVfgWjfdNz7MJ-o65UTie0A0_C5FefeB_R01a8nV14K3Xnj4WCV_I</con:value></con:property><con:property><con:name>softwareStatement</con:name><con:value>eyJ0eXAiOiJKV1QiLCJibGl0ejpraW5kIjoiU09GVF9TVE0iLCJhbGciOiJSUzI1NiJ9.eyJncmFudF90eXBlcyI6WyJhdXRob3JpemF0aW9uX2NvZGUiLCJjbGllbnRfY3JlZGVudGlhbHMiLCJyZWZyZXNoX3Rva2VuIl0sInNjb3BlIjoib3BlbmlkIGNvbnRhY3RzIHByb2ZpbGUiLCJqdGkiOiJmYjg2NDcwMS1mZGNkLTRjZjctODg1Mi01ZTVmNDY3N2ZjZTYiLCJzb2Z0d2FyZV9pZCI6ImVtaWFzLmluZm8iLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMSIsInJlc3BvbnNlX3R5cGVzIjpbImNvZGUiXSwiaWF0IjoxNjM1MTczODIyLCJpc3MiOiJodHRwczovL2xvZ2luLXRlY2gubW9zLnJ1IiwicmVkaXJlY3RfdXJpcyI6WyJodHRwczovL2VtaWFzLmluZm8vc3VkaXItbW9iaWxlIl0sImF1ZCI6WyJlbWlhcy5pbmZvIl19.glfjJb7PXa7l3O3CMIOrbw_N0Cd5y-kyn5lklyVGLXDAFv8MqC85MfgqEE86buaTAsOwEAqqoTwLpOXodN9ds_q7zcDyLQoDcILHhgg9G3-DoLu9XxpPbaRNFBjzpgZrjKZCGJCSqdjnQJzNv2-oySD_xTKHfXFjy62SITRnUjJCyxhmbrtckjJX6RckCqv3Y3WFgr8nmMcjh-OFgquklokVlo3cfRl4R1JwEe5kiya7ZfqsNhwhx_iaG4SHYICtzYboToAfiLYbJsJ-H89I7FspusOhidkrt23BteNUnjzT3Jx3_OuWauK4aLkaBXQzFVksaoDiuRHmHn6uOzFihQ</con:value></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login-tech.mos.ru</con:value></con:property><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+YTAxZjY1NTktOTA0OS00MWFlLWI0MjAtOThiMzA1OGExOWE0OkV3alBNNmluUTBjQXJ4cw==</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>Hf6JUBJDGFQnEaGiCMV2XUJhwwJlnBsoJmSRbxH10A1KqjdPBxDe04SDiZd8LTf1bpUjq63OcL9SbrEUDSq0Tw</con:value></con:property><con:property><con:name>guid</con:name><con:value>10d59080-73a2-4587-9931-c18fb90831b2</con:value></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lkservice.test.emias.ru</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiI0MGZkM2IwYy04NWQ5LTQ2MTMtODNkZC05N2MwNmU5Yjc2ZTgiLCJzaWQiOiJmZGJkODIzZS02MTdjLTRkNzUtYjM1ZC1jZjkyNmU0Nzc1NDEiLCJleHAiOjE3MTc2NzY0ODEsInN1YiI6Ijc1ODM1Y2I3LTllMjctNGFjYi1hOTVkLWE5ZGIzNGU5NjQxZSIsInNzb19pZCI6Ilp6ZmhpUWNRVldTUk5naDdFMmYrbGVkZUtvdmVRTzVpQUtKZnh3ZWZMdXlYaHFuN0pEUklKemJwVmtUWWJGVXVReGhhMVZKZjJBZlBmblI3R21xekl0eC84ZXpiVWgrYldmUzBSOXNER2pIZXRXQ25RUENlT0FOYzJRNk1NdkJvWlFaRnE0aHdLOG5ybXc4blN0N1VlQUZOYUN0TjN1VjRyTVpOWllKN2NMN0k1ZjVBckxHcU1vcDBNbm8yL1M4YWRrUVNJM3B0ZkM1ZXh5NnFzU3pTVWt1ZldqSXMrYldON1FBMEdaZlF1V1RGcUs2QU4rNG5veVo4eFNCRlRmKzZsdjk2a1FHMlh6dU01RkpndSs5SzRNeUVZZnBPVERBb0JmZHFPV0N0YlNodllRL2VDbmdnOFUvMkN4c0NYaUE0UkhGTllocm5URXhhU3JpZHhJbnNXdz09In0.SNZjSpaHbjiGuMWw1ncIZLlshmL5x7WPtpNrqrx1MG4VVo3B2TV-V3Flnme5_aoqEebR2q84VcQteoLQtOC2T5ASUXZ_8nwco024-a06poUZjjsNBpG4jD7JsebogocuiHeFwvZYtXBa8pNTeNLAKiCLeReINZu_RfV_zUjBAQ6rUUXBkcDoeBX8adfl2Tc45B8MzjW8fsi8r0ElRpqYDgv0zDMc60yCH6DG2ymocasnc52gfuxzApKsW3FEGFrwvjfQzBjZ5kttRFpNFeTdwLI3T41g_Hy7KS3fB2RHTx1cYMEKON18StcmNkMEVBp8cveQn59by4ctF8cTop4TshRBRNdf1jRO6lJhqXgNwD4zfTrdmvmzKEMzpEMEapFpqRi-Zd0vqiCKV2_Kw6wO0AUy2ib4C-WVroL555tXVCUIeL_2717Ate1cG1IUTz4HDRqTE1tuY6UNKyrFZv5cAkMqqNTx7lqSX2vjtWb0QNpn2ARTRqeLVoirSp9vtw1Oj0y64RByJ2Cl81ddrePBFoaUyvzOYTtuf71819cllTGxyQdGQecAkuI3zWoDHdiICz_Po5G89xIJIAe3bwEStzWEv4OVTa_TQ5d9SdnWshBKqwUE_rdBd2Kpqn5Y5k7KqjloNBQknZTVEvE1TS1V6UMOmXRxEQPP46_bKStLcwI</con:value></con:property><con:property><con:name>login</con:name><con:value>med_test_2022@bk.ru</con:value></con:property><con:property><con:name>password</con:name><con:value>OOYY2t2hooy#3</con:value></con:property><con:property><con:name>clientId</con:name><con:value>dyn~emias.info~a01f6559-9049-41ae-b420-98b3058a19a4</con:value></con:property><con:property><con:name>clientSecret</con:name><con:value>EwjPM6inQ0cArxs</con:value></con:property></con:properties></con:testSuite><con:testSuite id="554009e6-51bb-4a5f-b68e-69356f7ec599" name="Получение и обновление токенов СУДИР и ЛК(контуры Солит и Тест) e@rdf.ru"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="afe40fa2-da14-42d8-a429-85c396a65e19" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получение токена СУДИР и токена ЛК" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Получение client_Id client_secret (шаг 1)" id="a135f04c-5f30-4566-9284-ae882401900b"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/register" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение client_Id client_secret (шаг 1)" id="1acba04c-b558-4b14-94b3-193346516e38" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer jIeAUJjALkvjRcU_wAcASnNNc9ovLxhApSnJfqt2JLcRw_jCyugGxXfMdPVBayeiPj0pmufDqQxmE9ofd8Rnww" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request>{
"software_id": "CSI",
 "device_type": "android_phone",
 "software_statement": "${#TestSuite#softwareStatement}"
}</con:request><con:originalUri>https://login-tech.mos.ru/sps/oauth/register</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2013d0e-b347-454d-bc12-f33e5b820ccc" name="Valid HTTP Status Codes"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись client_id client_secret" id="2b9fa56a-9361-487a-8559-61b088641076"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_id</con:sourcePath><con:targetType>clientId</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_secret</con:sourcePath><con:targetType>clientSecret</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Кодирование в base64 + составление запроса" id="6a5b2385-3c08-4eb5-a8e9-807e53e02eaf"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
//testRunner.testCase.testSuite.project.setPropertyValue("base64",auth)

////////////Составление запроса. Ссылка для авторизации///////////

link = sudirUrl+"/sps/oauth/ae?client_id=$client_id&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile"
testRunner.testCase.setPropertyValue("link",link)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)
login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)</script></con:config></con:testStep><con:testStep type="manualTestStep" name="Действия со ссылкой" id="b27874e3-37b3-4a88-953d-2944f78866f5"><con:description>1. Скопировать ссылку из проперти кейса (link)
2. Открыть консоль разработчика в браузере (F12)
3. Вставить скопированную ссылку
4. Ввести логин/пароль и капчу (
ЯНА: логин: med_test_2022@bk.ru, пароль:OOYY2t2hooy#3
Аккаунт для БВТ: логин:e@rdf.ru пароль: Mm123456
 )
5. Нажать войти
</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="delay" name="Delay" id="a1b2eff7-15ef-4fbe-adee-1fff0cc83e7c" disabled="true"><con:settings/><con:config><delay>50000</delay></con:config></con:testStep><con:testStep type="manualTestStep" name="Подтверждение и копирование кода" id="5c0f41b9-ad4c-4617-9128-9a9f8c3549ea" disabled="true"><con:description>1. Нажать кнопку "Подтвердить"
После получения данного кода есть минута, чтобы отправить следующий запрос
2.Скопировать код из консоли разработчика
3. Вставить код в проперти кейса (code)</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="restrequest" name="Получение токена СУДИР" id="a918e272-c75f-4241-b18c-02c8f64367fa"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение токена СУДИР" id="26f90063-1811-4565-b889-d93e4d165864" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="fd19a4af-366b-4fed-8e55-939a693dbce6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="code" value="${#TestCase#code}"/>
  <con:entry key="grant_type" value="authorization_code"/>
  <con:entry key="redirect_uri" value="https://emias.info/sudir-mobile"/>
</con:parameters><con:parameterOrder><con:entry>grant_type</con:entry><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Записать токен СУДИР и refresh" id="9e56de1c-d409-41e3-8b99-1744c6ca96aa"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получение токена СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)

log.info sudir_token.access_token

testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

//com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
//com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Получение данных о пользователе" id="770c501b-06e0-4bea-9ae7-aea4a7b4e0dd"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/me" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение данных о пользователе" id="e34c85f0-463c-454a-bb0f-a0f8070e9b0a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2a895841-cf20-40c7-a34a-86a7e5719b50" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="Bearer ${#TestSuite#sudirToken}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись guid" id="fce797a7-1af8-40cc-b4ca-b0d99a63b2c6"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>guid2</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#Global#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Зарегистрировать инстант" id="988a1b22-2cbf-4f03-9af3-80a1d013717f"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Зарегистрировать инстант" id="60261039-b4ea-4d59-9649-f46e0fc1f793" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "instanceToken": "${#TestSuite#clientId}",
  "sudirToken": "${#TestSuite#sudirToken}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance</con:originalUri><con:assertion type="Simple Contains" id="ca95a9e3-62a6-424f-a200-baaf7d074f58" name="Contains"><con:configuration><token>attemptToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК2" id="cedfc0c2-9088-4bc9-b019-d35a8ab5ef32" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК2" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение attemp-access" id="77158dd7-72db-478f-9a1d-17bec8fd110a"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Зарегистрировать инстант"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Зарегистрировать инстант#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attemptToken)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="86dc8cbe-d948-4ab5-9997-8c5e3b3ce78f"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/confirm-instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="33cd7c74-7696-4e79-b652-2c604d7a36bb" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
    "otpCode": "${#TestCase#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:originalUri>https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance</con:originalUri><con:assertion type="Simple Contains" id="3d630dca-8dc0-493c-ba56-a3d039abaa84" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение X-Access-JWT" id="4c8f26bd-5761-47a8-8611-5a2c978bf3f6"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Подтвердить токен#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
base64 = testRunner.testCase.testSuite.getPropertyValue("base64")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("base64", base64)
guid = testRunner.testCase.testSuite.getPropertyValue("guid")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="transfer" name="Записать токены ЛК" id="6ab450e3-aef8-430c-b797-44721da6af69" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.accessToken</con:sourcePath><con:targetType xsi:nil="true"/><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>refresh_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.refreshToken</con:sourcePath><con:targetType>refresh-X-Access-JWT</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК" id="c6d3826d-9c5a-44f5-9d85-e144f0c85bc0" disabled="true"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Acces-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="Authorization" value=""/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="7f5cfadc-0784-42c1-ac53-73a7e69c0095" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#TestSuite#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="получить все emiasid из ответа" id="b2cd7ab0-42f7-4b9f-ac32-282940a02552" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper
import groovy.xml.XmlSlurper

response = context.expand('${Посмотреть привязанных пользователей#Response}')
parsedResponse = new JsonSlurper().parseText(response)

ids=parsedResponse.permissions.emiasId
log.info ids.toString().replace("[","(").replace("]",")")

id=10133820
for(int i=0; i&lt;parsedResponse.permissions.size(); i++){

	if(parsedResponse.permissions[i].emiasId == id){ log.info parsedResponse.permissions[i].policyNum; break}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=dyn~emias.info~7351c477-a653-44be-9e1e-29bdc9490e68&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property><con:property><con:name>code</con:name><con:value>GMJhb9zGTOQyPxJheQzDZYjcnqjjRKTpIZEKcbtzHh0pb_w1x3DvMGsTOWJUP5mczApJIdcQ34ch71cZ0uP_dmprndgIIx6lmOFxDfuIa9s</con:value></con:property><con:property><con:name>client_id</con:name><con:value>dyn~emias.info~67eb9119-9138-4985-ac57-18705665e4e8</con:value></con:property><con:property><con:name>client_secret</con:name><con:value>nBlK2TCLgM7Wm3l</con:value></con:property><con:property><con:name>access_token</con:name><con:value>Q-F5iygkgbwX82WAwlrw9VZtIRJo23IeTI8M_38uh19jZWJhYThlZC0yNThhLTQ2ZWYtYTZiZC1lZjEzZDdiZWM1MjI</con:value></con:property><con:property><con:name>guid</con:name><con:value>af3e4ac5-96dd-4167-afb3-244eb7187aba</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiI4OWZlZGM4Mi1hZTZjLTRlNGYtYjUxNC02ZjNiMjE1OWI2NzciLCJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MDkyODIyODQsInN1YiI6Ijc1ODM1Y2I3LTllMjctNGFjYi1hOTVkLWE5ZGIzNGU5NjQxZSIsImhjbiI6MjQxOSwiYXVkIjoiUEFUSUVOVCIsInNzb19pZCI6IjEwZDU5MDgwLTczYTItNDU4Ny05OTMxLWMxOGZiOTA4MzFiMiIsImFtciI6W10sInBheWxvYWQiOnsiaW5zdGFuY2VfdG9rZW4iOiJkeW5-ZW1pYXMuaW5mb35iZmI2YzI1Ny0zMmE5LTRhZTYtYWQyZC1kNmMyZWJkOTUyZGYifX0.KohnJBAT_OtXvSyC802GxYWjyrRV545yA-SKQwc1c6EljopbL62wuE53OOQimSGBWpGxdRpvmaKXsylLBcLulmlSrQvWrI5-eh4iiWhmdStPfNrzWF6GOaXbVC6a0xn8c5SjMfchv0JvwIihO7Uf-6d7y5xFgsMZzhkKmgRWCQbZLJQxEtNDFQYz5PFPsnri5qRUBgCwLwdJ1UVQnYUZpxbs1ppcNxuz_EW2gMUPqN7u_Sw8SypflA3mG2O5ZjGnaEo20XK9c_esj7P7a3A9yJTidW4WouVjKOxmSfYXWkdMsOk4zXD8aAjcoKxb-ytXBi8jQvgu8C-VoVeRtCoq9e_sRLFyDGAeu2IsMtpbkJoYj1zuG0JNIosFWxVHgeM2c-nMVdAMUJTWEhDK7rjzog6dNrPmJqA3iIgut6qTTrh2m4Le9NJEPU8cVSyz_ekqJv1BV65rCk15DXPaK0XXMhkVs34wUurNOKzfRTZ8uoVElhbRq7nXGHinm3S_kS8tmNNkGFMyZnLs77zcXWjaYLT_lXNJEPTgFIggFlxBT92csJNva9VolyrZPePI0PxtLzv23tIXsUQohVyNYaBrxblXYbQYFHTzWrJq6jNKhmxrYP9jGbZauKJc30z8wAx_I-Du8nX39VhNEAYNeZypOnVWE5GMjjp6F4wnzWlPMgU</con:value></con:property></con:properties></con:testCase><con:testCase id="bf1b42df-176e-4d20-b11b-6b407f6b3490" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента и добавить в медкарту" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="165560fe-47d0-486f-8019-f3e253c9a07f"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="365b6674-7534-4586-8760-c654fee64ea7"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства второго пациента" id="12739f06-9f04-494f-9a9f-cf955c29095f"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="Найти пациента в базе СУПП по patient_id" id="7e817d10-ebb4-4b02-bbda-db4e1ccebf04"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, 
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE PATIENT_ID=${#TestCase#patientId} </con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Найти рандомного пациента в СУПП" id="db47826f-e8c8-4f99-b916-e7eae8040340"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER,OMS_NEW_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE ((OMS_ASSURANCE_SERIES is not null and OMS_ASSURANCE_NUMBER is not null) or OMS_NEW_ASSURANCE_NUMBER is not null )
AND ROWNUM&lt;50
ORDER BY DBMS_RANDOM.VALUE</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="Добавить пациента в медкарту" id="8120ba2f-9381-40e2-90fb-33fb139de393" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Добавить пациента в медкарту" id="a5f68023-dec0-442a-9721-e4a177894c76" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "documentId": "string",
 "id": "string",
 "permissionType": "CHILD",
 "userInfo": {
  "userName": "Яна Михайловна В.",
  "phoneNum": "79265209207",
  "ssoId": "af3e4ac5-96dd-4167-afb3-244eb7187aba"
  },
  "createDate": "2023-04-18",
  "patientInfo": {
    "patientName": "${#TestCase#name} ${#TestCase#middleName} ${#TestCase#lastName}",
    "birthday": "${#TestCase#birthDay}",
    "emiasId": ${#TestCase#patientId},
    "policyNum": "${#TestCase#series} ${#TestCase#omsNumber}"
  }
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/1/user/grant-permission</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="f30d0dd7-89eb-41cc-b7ae-8e3a80e283a0" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Получить токен" id="6e0ae42e-a619-4a5a-aae1-9446d161c32c" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/login" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить токен" id="3b40c73f-e9cf-4762-8875-d5f43b1bb979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "code": "med_test_2022@bk.ru"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/login</con:originalUri><con:assertion type="Simple NotContains" id="2b30274b-96a2-4696-981c-a6342eba3ef7" name="Not Contains error"><con:configuration><token>error</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="5812c462-9482-4e8d-b95f-4ad1d19e6230" name="Valid HTTP Status Code 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить attemp-access" id="7115fa41-d0d8-4702-9e33-726e6b8d4ce8" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Получить токен"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Получить токен#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attempt_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="31190848-73dd-425d-aa66-c86c8a24dcc4" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/confirm" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="3827440b-59d7-4e3f-82f2-7e31523ea53c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "otp_code": "${#TestCase#x-otp}",
  "refresh_token_ttl_seconds": 0,
  "access_token_ttl_seconds": 0,
  "attempt_token": "${#TestCase#attempt_token}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/confirm</con:originalUri><con:assertion type="Simple Contains" id="aef0c267-6bdb-4264-9f13-e58bac6df0a6" name="Contains"><con:configuration><token>access_token</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен в свойства" id="96d1573a-1198-443e-a183-4b9ca16771ba" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.access_token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Получить список прикрепленных" id="350a9202-e0c1-4bc3-b464-89a93860cf7b"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/profile" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить список прикрепленных" id="31babd50-0726-4247-bc7a-7409f01fa367" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/profile</con:originalUri><con:assertion type="Simple Contains" id="ab8aa89d-e818-47d9-b829-7850fe93c133" name="Contains"><con:configuration><token>relatives</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="X-Access-JWT" value="${#TestSuite#X-Access-JWT}"/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить ehrId пациента" id="2bc72f6a-431f-4e97-baab-6ad4abcbb2d9"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получить список прикрепленных#Response}')
d = new JsonSlurper().parseText(ResponseJson)
birthDay = testRunner.testCase.getPropertyValue("birthDay")
oms = testRunner.testCase.getPropertyValue("oms")
lastName = testRunner.testCase.getPropertyValue("lastName")
name = testRunner.testCase.getPropertyValue("name")
middleName = testRunner.testCase.getPropertyValue("middleName")

fullName=name+" "+middleName+" "+lastName[0]+"."

for(def elem : d.relatives){
	if(elem.birthDate ==birthDay &amp;&amp; oms==elem.policyNum &amp;&amp; elem.firstName==fullName){
		log.info elem.profileId
		testRunner.testCase.setPropertyValue("ehrId", elem.profileId)
		break
	}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>7066630284</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>patientId</con:name><con:value>31110819</con:value></con:property><con:property><con:name>oms</con:name><con:value>7791889720000557</con:value></con:property><con:property><con:name>lastName</con:name><con:value>Сафрошкин</con:value></con:property><con:property><con:name>name</con:name><con:value>Олег</con:value></con:property><con:property><con:name>middleName</con:name><con:value>Юрьевич</con:value></con:property><con:property><con:name>birthDay</con:name><con:value>1984-02-13</con:value></con:property><con:property><con:name>token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2Nzk0OTk1NjgsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJiYjVlYjg1OC1lZjc2LTQyOTUtOTg1OS1jOWQ2YTI1MWIzNTAiLCJzaWQiOiJmMjBlMWJmNC0yZWNjLTRlYTMtOTRjZi1iMTliMzc3ZDYyY2QiLCJwaG9uZSI6Ijc5MTU5Njc5MjMwIiwic3NvX2lkIjoidzlzMGZSVEFXVE9VRWQ5VisremF0c3NsdFVXZnI5UFBIUEhoR1hzYzU3U05QL0ZwcGlOZWo2RzlhaVdXRmdielhHdVcyai9mdk5CalY3WkhlTDRjbGVPVTVEODRjT0RjSk5FNjhKSzBFNnJyT3o0bG8rZnM4cVZIc09rM3hyS1FaZmJUM3NweGgvUUdaaUMvU2JhMjQ3T1MvdVN1VnVYTVVySjUyM1RwSlJNd3RLRnliNXljQXU4b3h5dlYwTXVDVHhZSElOKy9OTU9ubnhvckRFMnIycW05YmwvTjV1QWE4c1B3Lyt6TXJYT1FXdm1PVXZWaUVvbHJXeXkwaS95Z215bjk3TWNtQVRnQ1JLQlE1MmJpTG5PbE41VVRiRi9lc1JCY3Mzb1FVVjc5YTlXTkMxTC9RakxtajdoVUJaY0tkbXJLL2JKaXhMQmp0bW0vL2ZFV1hBPT0iLCJlbWFpbCI6Inlhci5wcm9tby56YXBvdi5hQGdtYWlsLmNvbSIsImZpcnN0X25hbWUiOiJcdTA0MjFcdTA0MzVcdTA0NDBcdTA0MzNcdTA0MzVcdTA0MzkiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMi4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxMlx1MDQ0Zlx1MDQ0N1x1MDQzNVx1MDQ0MVx1MDQzYlx1MDQzMFx1MDQzMlx1MDQzZVx1MDQzMlx1MDQzOFx1MDQ0NyIsImJpcnRoX2RhdGUiOiIxOTc4LTAzLTIyIn0.U56ljjFNsiTlPAubVFSPnALoKcdCCkugqFUNKowxR1CAPe32wlLylF-iTmNF1NqjUm2iVwdV1gIOAZQPl5wKGKYNlAESK59wVfgNDlvuNaHhSLvkZbUtVXHDoSN_HROBiNcGpgrTYvK3X4yXJpXjnif_mehsnuQpn9PLR5hcCg-SXiZ4pbH_ovdhd1YI-d5lNM-IBG6WURBwCU7St7SjjxojxcR8Dtq6HmvsfGtgYBkwu13keryRjRUuWkuWizK5aNHmyxlhsN77IXTVLF-TbfbOZ-BeYFNZXqoMVeImGWVoMUsK3sKc0QpYy1ma81lZvjYBLBYMiCOK8NoY84ZOFd0-xRQ7XdXauDy0-HsQfPxab6pxigvKkx8mgbRkucLhWS_xM0dEVmY5CG7rSB0kNVgmyA4HZufTHHysr1En_a7HE_flx4odcnyQyO1nMKm_dYqzAOFFyYuYHhOJjE_x-FBsfybDSLxKeBiGXbRUTnhGPlmUus_Gs0dVYL0ZyD9aBl8Yh0uiWBMe_yz2KEdTZ__h6bX-RbgAi0lWs3OTQF19XXa5PRZ2w2ftvoJD5JhVvYl-Uf6Lagzox9i8_loWD4GxczbPCU8-dktpmWe-N_fb5O41G6zWcnOvIdOQB8k2u4K89dLr8hNHzcxYlmNNqMm9Em1mYQbzqDHXOxhFFSE</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpZCI6IjdlMjVhYjIzLWUwYTMtNGUxOC05MDNlLWI3MmMwNjYzNjQyNCIsImlzcyI6InVzZXJfYXV0aCIsImV4cCI6MTY3OTQxNjQ1Miwic3ViIjoiYmI1ZWI4NTgtZWY3Ni00Mjk1LTk4NTktYzlkNmEyNTFiMzUwIiwiaGNuIjo1LCJhdWQiOiJQQVRJRU5UIiwic3NvX2lkIjoiQ3Bwb3hwbE56b3M0L2h6RmEycm91S0lORXRQWnpiYkpTNmxlYmRJTDBTbHNNdDgyOEJDYXNMbGRWZHJ1TmZ2S0t2T0J4Ujd1V09RNjdCenpWSkM5aXpNaFd1akVTWnlrczhyb2FqL2VxNEZESnhTakR5aHdNYlo5UFNVam1xdCtyRUJjUHBGV3RRYVdWQk1UQlN1VldoN01xSzc4MHBlL283MGpIZUcxYUpveWlIZU5XaCtsUUhoUy94RHUzUXFKbEFhMEU5S3A3TTk3KzdLR1FoWFVEWVJ5eE1GMm5nZC91MXdCbXdhWkZjeXZkY003TWFRNTBRdUhmeUVORnQwZjRpS0lWL1pIQ0F0QS9qRTdwODRkMFFobXJudmc1TzgrZHZSS1hRb3htdzFWS3RkUVBPckJDMVltd2xtNTNWUU1ac0tRbFZJY2FCSkJEcTFpK2RycnlnPT0ifQ.hZxYie4xivThXf9tN1KLaYunCHqYJIq5XtQ6w24ku2JlVIV75hK54L0ZTtOsMyfOZe-epPyWsOQJBoDM7Z1-l55-Il-AEzjDtM-GBa_uiTiGkB3uvLhHoevWfFil5rwl7-ZEAxldIh5KkL8DzoXQ5K5XLACGgLQpEWPIdGiaWtlD_J3ZX9mfnFKgtPrDbKA-RGIWR9gsk9Kyxm8M_r5zeD-WCAVUNp-veEsGfOrzk2s6u-wOy72nzS97utiaulPEDNvsU7E-zsrBqn3YdRSXgnd4fR3NpwiXTTcSQ8K-D9e1JfNUVbNXpTf6OqiR24sFVH4gaJgsdmfuGT-4byfiygv9RZVhPbint3llTk2Rn15wNoAZJqe3hWgO--gJ7GPKfb_RFhUjquZliI3SI42jcySQRbSVXioJfObmo4LVrJwioyV8IBgsrJKDJ66RFeHPCABek_ktAh_GwAB17FlnXU3dDJ3WSv_jUq3R0-eyx5nAVhlxFqWqdTN5ladfGbOrMebF5IiIGFtxzUNxe1rQGe_1_2f8jumEDDsgkBlaIHQa8O52M1KwVMDDeW-OaL4jnG9OYDcX-1R1iG9jvXpiJh9fsx9Ng5eiYP8OYJsNojczD9vzizyjSxBh6qwze03fXDy5G9rqytp0CpwpcxvNYpi6msgjbF7JoDLuM6SBUuU</con:value></con:property><con:property><con:name>ehrId</con:name><con:value>95706443-b316-4442-894c-748da1962c80</con:value></con:property><con:property><con:name>sixMonthsAgo</con:name><con:value>2022-09-24</con:value></con:property><con:property><con:name>lastNameFirstLetter</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="17caa140-9d47-43cb-9e68-ca3dc1180d65" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента по омс" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="0064659e-7b50-4732-b757-b702b428fe11"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="44ea34d0-fd69-4d77-b229-0e1193b27f0a"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDate</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>id</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>710271440</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>id</con:name><con:value/></con:property><con:property><con:name>oms</con:name><con:value>770000710271440</con:value></con:property><con:property><con:name>lastName</con:name><con:value/></con:property><con:property><con:name>name</con:name><con:value/></con:property><con:property><con:name>middleName</con:name><con:value/></con:property><con:property><con:name>birthDate</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="8b528c7a-4a9f-4fcb-aba5-4c3001c2aff9" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР old" searchProperties="true" disabled="true"><con:settings/><con:testStep type="restrequest" name="Обновить токен СУДИР" id="dd6b21fe-5f8b-4400-8294-a685f9d8160c"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="fb5afe6d-b8d4-486a-817f-4e44b2a48dfc"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="7cd9edbd-d07d-4a7a-a78c-bdbf477f4c04"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="7b1b535f-d063-4b3e-b8ac-4692b670a528"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="6ecc03e6-714c-4ae9-b94c-fcebb38e22bb" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти актуальную др пациента" searchProperties="true" disabled="true"><con:settings/><con:properties/></con:testCase><con:testCase id="068b4cb9-3042-481d-9595-9f91285b9934" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР" searchProperties="true"><con:settings/><con:testStep type="groovy" name="обновить base64" id="01bb4572-1151-4826-b071-ebf7a8d6fae9"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить токен СУДИР" id="250d08a0-9619-4e28-a6d7-bc36e06cc05d"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="обновить параметры для сервиса tokens" id="af4f2a2e-3396-4e3a-9e8f-a24a074077f5"><con:settings/><con:config><script>login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
guid = testRunner.testCase.testSuite.getPropertyValue("guid")

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="a828e1ad-a217-45dc-9924-60c4ec23460b"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)
log.info "EI-Token "+sudir_token.access_token</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="95f55408-9d6d-4fe1-b5d7-180ddd5e7e32"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="ebc4632c-a8ed-4811-8949-16c51c97e308"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)

log.info "X-Access-JWT  "+access_token.accessToken</script></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=null&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property></con:properties></con:testCase><con:properties><con:property><con:name>sudirToken</con:name><con:value>6qnWPuXk3OK1HMKDYKbI8zJrszgjuKHFyE2W46K4uXozZDMxMDE2OS03OWUwLTQxYzItODRkMy03ZWUyM2YwZDFkZTY</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MDkyODIyODQsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiI3NTgzNWNiNy05ZTI3LTRhY2ItYTk1ZC1hOWRiMzRlOTY0MWUiLCJzaWQiOiI2ZWExYzFkYy1mN2FlLTQ1YzAtYmU0ZS1hZTlkYWJkNjU2MjYiLCJwaG9uZSI6Ijc5MTUwMDQ5NzY2Iiwic3NvX2lkIjoiV1lDVThNVm5DNnVJcys4a05XR3dTdlMyVUxTNytXNm1lS1FpQXpGeFM2OGlCc1d3NEx5ZCtJOStZRUZNK1BmT1BoQklrSkFVaDE0VXNyM3E5cTk0ZmxEd0pDVkQxRUtqWi9peG1FdC9qSEw0dEhFTjBvV2ZOcWF6L0dEcmQwWXJwRVJiaVBibWVKSS9aaEo2MzJxS2NLTGZyUlVNM09oc1oyTUp1Y1R6RkF1QUxUb3dIR2xYS1d3TkNPWC9WcmM5eitrUWhIUDdWdmVWMG5Hd0dIb1ZWdDZQTnNWSStFN01OSFdMYlROcTVaSHZkVHA5L0ZiVHg2WkJZVUpROXdqNXF2d3Y2WnlpNU1ETkUwQ0FHeXhsVzVReHZBRk1lbkxNNHlDZjBiam1jSW15S3UzcDh6amhnbW05Nk5oQTdaaDhkVWJxWCtMK0VaRmMrRlh3TDY1SzJRPT0iLCJlbWFpbCI6IiIsImZpcnN0X25hbWUiOiJcdTA0MjVcdTA0MzBcdTA0M2RcdTA0NDNcdTA0M2MiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMC4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxN1x1MDQzOFx1MDQ0MFx1MDQzMFx1MDQzY1x1MDQ0M1x1MDQ0Mlx1MDQzNFx1MDQzOFx1MDQzZFx1MDQzZVx1MDQzMlx1MDQzZFx1MDQzMCIsImJpcnRoX2RhdGUiOiIyMDAxLTA2LTA2IiwiYW1yIjpbXX0.m-CjqkPh_LBkvE5eyF9GLPc6PdJglgS7yg1khgEgFXOMhqqYmqLAO2215qlrmaCZSKH4g7tfBJ5SIhSZfH5nEv6dCjzHAnhzWy2ujadF03uWmYljssG_HH34zJ8sLcTiTFUcIug9DTJqbhJFPKlPmz8kW3v_5s9fzCEm8tTPZwXzr2TrUgWiD5dsD9N-A8r2JxiuwalqdvxZNfEk2FmFqQnNy622ozzaciMUq0CEZMifJZm0L0TpyDsGv19zlj5a5J1Rh_WmCRBH4s7d8WGdIhRqjAPvpx2NFZJAiYIzf08xyh6gmuNLkVliZJ5lFXGMrRGHlSalmFLHZ7RMDIXf826dRIVGegQUZxKJRnZUF_40ri6qm5BUwWd9pLV_GqbKAm82D4gYDNpbQEUBuU2f1tLItIEUlsVGspU_lNV8t1QCM9fL5MRlbnHPsF4_4PWhFEZwk-dsaEvziI-7o2aNIxxjvh_fsRUmCgDVHJjnAoMmZ02CRd0F5z_sWwr0ypVSyAj1uqS7dS9VE_e44U100N7iw2kyxX_6qHJZ1tslZ8zTGVUgtsGuqbkNyRTFtJ2_mIEOpzC1skXBP_y7EDV6nShhn-m2WOKM3WF-JF_c4YWYpjOJ7BJn1dWAF6d86-zym8b_31L2gcOGAIJVdpZV34VKeLpSdKZgm3T0FxLQkok</con:value></con:property><con:property><con:name>softwareStatement</con:name><con:value>eyJ0eXAiOiJKV1QiLCJibGl0ejpraW5kIjoiU09GVF9TVE0iLCJhbGciOiJSUzI1NiJ9.eyJncmFudF90eXBlcyI6WyJhdXRob3JpemF0aW9uX2NvZGUiLCJjbGllbnRfY3JlZGVudGlhbHMiLCJyZWZyZXNoX3Rva2VuIl0sInNjb3BlIjoib3BlbmlkIGNvbnRhY3RzIHByb2ZpbGUiLCJqdGkiOiJmYjg2NDcwMS1mZGNkLTRjZjctODg1Mi01ZTVmNDY3N2ZjZTYiLCJzb2Z0d2FyZV9pZCI6ImVtaWFzLmluZm8iLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMSIsInJlc3BvbnNlX3R5cGVzIjpbImNvZGUiXSwiaWF0IjoxNjM1MTczODIyLCJpc3MiOiJodHRwczovL2xvZ2luLXRlY2gubW9zLnJ1IiwicmVkaXJlY3RfdXJpcyI6WyJodHRwczovL2VtaWFzLmluZm8vc3VkaXItbW9iaWxlIl0sImF1ZCI6WyJlbWlhcy5pbmZvIl19.glfjJb7PXa7l3O3CMIOrbw_N0Cd5y-kyn5lklyVGLXDAFv8MqC85MfgqEE86buaTAsOwEAqqoTwLpOXodN9ds_q7zcDyLQoDcILHhgg9G3-DoLu9XxpPbaRNFBjzpgZrjKZCGJCSqdjnQJzNv2-oySD_xTKHfXFjy62SITRnUjJCyxhmbrtckjJX6RckCqv3Y3WFgr8nmMcjh-OFgquklokVlo3cfRl4R1JwEe5kiya7ZfqsNhwhx_iaG4SHYICtzYboToAfiLYbJsJ-H89I7FspusOhidkrt23BteNUnjzT3Jx3_OuWauK4aLkaBXQzFVksaoDiuRHmHn6uOzFihQ</con:value></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login-tech.mos.ru</con:value></con:property><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+NzM1MWM0NzctYTY1My00NGJlLTllMWUtMjliZGM5NDkwZTY4OmRWMlVqS3JFM3ZneVVBSw==</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>RuQIWkpPaNdr45mHTIeCA1raSMlnjxww8QF1YoSWwJRr8T5VAmGqJzP_KWGr4SF-LVKSgi42iouQk3Bdoa4nbw</con:value></con:property><con:property><con:name>guid</con:name><con:value>2149c2d2-e0b3-4fe9-a810-4435708242ce</con:value></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lkservice.test.emias.ru</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiI1M2EwZDA4Zi1iZTIyLTRhMmEtYTkyYi0wYzlhMWUwZWNlYzkiLCJzaWQiOiI2ZWExYzFkYy1mN2FlLTQ1YzAtYmU0ZS1hZTlkYWJkNjU2MjYiLCJleHAiOjE3MDk4ODM0ODQsInN1YiI6Ijc1ODM1Y2I3LTllMjctNGFjYi1hOTVkLWE5ZGIzNGU5NjQxZSIsInNzb19pZCI6IlNSeUxtR040bUltWWwxQ2lGQk5mb2psY0JtbnNYNm12NHl6ZzNvOWx5dnluTWRvUjR0aXlhZjh2aWV2WDN2cnlid0ppbW85TmtVT2NDMTVDNndNaTdhdzNqN28rTDB2QnFWckZGY3NZa0xiMDdYK1A4UU56TlFtbnYrUThEUFhQRlJweUV2dUhwa3FmQlhDZHJNS3dpM056bXlwRWJGVkMvNzJTS1BzUzJDSFViUE9aazJCQ3dONkRyMzdpVFg0NXFDM29RaW0ySHNjZlBkSkg0eW9FRG8rRUw5RytyN2pTOC81VzI4THNSbHlCczhLS29ZRFRJZWpqNGtsdDB0dkxHSEZ2SFZmbElISWJIZWdNdHNBQzBnY2lUd2lzRkhxcWJXayswQVNJN1FZYUdaVnQ2WEdXNmEveHI4aWZreURRYjczNGtZNGVlSkxrTHgyd3Vuc3pxUT09In0.g7HVp6GUj9yyJdP5vskauXUFYDnhtrTRs87NOJYZRHgV-0-_LS831I_WHHtY8GEUJVi6hDGGvpQn61nFYsNBeiLU2GppFfXFdHwTDKPZ5HGEUS0vTQ_xD3_uJ-QX7G4ofMkE4ETD9LT0Qpzbcg0V2KbxgUK0iOg-PERhgw_CapbNDmLvkZM6nt7gZ94ZgkSGzDd5Fppsmo2aUl2UfEyyDbBf7c59PDvNqFtlaqolUPkDIQsrwjDNWn4ExpaQwZu-FD74hLTJ-DRPq6Yk5fpvWOXqBrKNiUhYy7jMw3JrExhJBIN96nfqzad3RSpYnydxQ32r9YWgV2R9SPnTUklOYaHYM6tMLQfzxBFhN_lx6eFoSFvJjd5JHFeDpYfPwYflxD6USnMamScZAQIH46W3lKUoVIoYeMJ093f6uVARidOiEJcWJulWK4lngEtqtk8MZo1mj2XeL8nmy1aDrNG-3YF6ewuxEiZkBdUFSa32FxbcE2Ym8roBgN7elvfGsxplOsSJBX5n6-FFs1MfBi8L3UEx5xZEoVg6n6PtqAz_OREmw8TExpFGlIX28ZIewUBdAeRMXFgylszGbJNSOc_0gYP3rA0zewebI0rbgj7S9p4AcrFcEZYNtrYd2NYP9BUDdsFM4BjUuEysv_JHV6sMNXj4LPNXZk2CC7MSe0DTA4k</con:value></con:property><con:property><con:name>login</con:name><con:value/></con:property><con:property><con:name>password</con:name><con:value/></con:property><con:property><con:name>clientId</con:name><con:value>dyn~emias.info~7351c477-a653-44be-9e1e-29bdc9490e68</con:value></con:property><con:property><con:name>clientSecret</con:name><con:value>dV2UjKrE3vgyUAK</con:value></con:property></con:properties></con:testSuite><con:testSuite id="43b61468-f39b-4b43-b647-2d5a7e8a26cb" name="Получение и обновление токенов СУДИР и ЛК(контуры Солит и Тест) mtkb92@rambler.ru"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="e19be318-53de-4a1d-aec0-52b57447b9e0" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получение токена СУДИР и токена ЛК" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Получение client_Id client_secret (шаг 1)" id="95789f23-d3b4-449e-be84-282f660c7c3b"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/register" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение client_Id client_secret (шаг 1)" id="1acba04c-b558-4b14-94b3-193346516e38" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer jIeAUJjALkvjRcU_wAcASnNNc9ovLxhApSnJfqt2JLcRw_jCyugGxXfMdPVBayeiPj0pmufDqQxmE9ofd8Rnww" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request>{
"software_id": "CSI",
 "device_type": "android_phone",
 "software_statement": "${#TestSuite#softwareStatement}"
}</con:request><con:originalUri>https://login-tech.mos.ru/sps/oauth/register</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2013d0e-b347-454d-bc12-f33e5b820ccc" name="Valid HTTP Status Codes"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись client_id client_secret" id="29e197eb-b5d3-474b-a690-d1bece793aec"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_id</con:sourcePath><con:targetType>clientId</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_secret</con:sourcePath><con:targetType>clientSecret</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Кодирование в base64 + составление запроса" id="ec855b27-9c1c-4385-adc2-45896df43cd9"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
//testRunner.testCase.testSuite.project.setPropertyValue("base64",auth)

////////////Составление запроса. Ссылка для авторизации///////////

link = sudirUrl+"/sps/oauth/ae?client_id=$client_id&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile"
testRunner.testCase.setPropertyValue("link",link)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)
login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)</script></con:config></con:testStep><con:testStep type="manualTestStep" name="Действия со ссылкой" id="551fca7f-2f64-42e6-9c2a-bee489c8d8ea"><con:description>1. Скопировать ссылку из проперти кейса (link)
2. Открыть консоль разработчика в браузере (F12)
3. Вставить скопированную ссылку
4. Ввести логин/пароль и капчу (
логин: mtkb92@rambler.ru, пароль:web1yx2hQ7
 )
5. Нажать войти
</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="delay" name="Delay" id="78a0f787-c6a9-4c4e-9ba6-a43e25ed9e79" disabled="true"><con:settings/><con:config><delay>50000</delay></con:config></con:testStep><con:testStep type="manualTestStep" name="Подтверждение и копирование кода" id="f95b70e6-70b0-4c6b-bde1-05f867c776d2" disabled="true"><con:description>1. Нажать кнопку "Подтвердить"
После получения данного кода есть минута, чтобы отправить следующий запрос
2.Скопировать код из консоли разработчика
3. Вставить код в проперти кейса (code)</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="restrequest" name="Получение токена СУДИР" id="9d899276-1451-41f3-aef8-fd3fee976fd0"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение токена СУДИР" id="26f90063-1811-4565-b889-d93e4d165864" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="fd19a4af-366b-4fed-8e55-939a693dbce6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="code" value="${#TestCase#code}"/>
  <con:entry key="grant_type" value="authorization_code"/>
  <con:entry key="redirect_uri" value="https://emias.info/sudir-mobile"/>
</con:parameters><con:parameterOrder><con:entry>grant_type</con:entry><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Записать токен СУДИР и refresh" id="c2291ac5-1644-4685-9689-cadb659193ef"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получение токена СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)

log.info sudir_token.access_token

testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

//com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
//com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Получение данных о пользователе" id="ce55f8c5-c1d9-48e7-96e5-e1a15183e575"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/me" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение данных о пользователе" id="e34c85f0-463c-454a-bb0f-a0f8070e9b0a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2a895841-cf20-40c7-a34a-86a7e5719b50" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="Bearer ${#TestSuite#sudirToken}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись guid" id="6771581d-87b0-461f-8b64-1e4b8c2b1d83"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>guid2</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#Global#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Зарегистрировать инстант" id="1b03ca8d-f736-4ea2-8fa5-72137ac4cb16"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Зарегистрировать инстант" id="60261039-b4ea-4d59-9649-f46e0fc1f793" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "instanceToken": "${#TestSuite#clientId}",
  "sudirToken": "${#TestSuite#sudirToken}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance</con:originalUri><con:assertion type="Simple Contains" id="ca95a9e3-62a6-424f-a200-baaf7d074f58" name="Contains"><con:configuration><token>attemptToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК2" id="e099aa29-d3ea-4f0e-b15f-e308b094876f" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК2" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение attemp-access" id="4f2ae72b-f1f1-42ec-bff1-cf6c68d2ffa3"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Зарегистрировать инстант"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Зарегистрировать инстант#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attemptToken)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="ab4dba50-06e4-4573-b26b-de355998a7a9"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/confirm-instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="33cd7c74-7696-4e79-b652-2c604d7a36bb" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
    "otpCode": "${#TestCase#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:originalUri>https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance</con:originalUri><con:assertion type="Simple Contains" id="3d630dca-8dc0-493c-ba56-a3d039abaa84" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение X-Access-JWT" id="df44513c-a264-4361-b10d-2cd9fc7ced49"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Подтвердить токен#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
base64 = testRunner.testCase.testSuite.getPropertyValue("base64")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("base64", base64)
guid = testRunner.testCase.testSuite.getPropertyValue("guid")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="transfer" name="Записать токены ЛК" id="0739d5a5-8a93-4b47-bd57-88060217d6a3" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.accessToken</con:sourcePath><con:targetType xsi:nil="true"/><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>refresh_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.refreshToken</con:sourcePath><con:targetType>refresh-X-Access-JWT</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК" id="7f4e79f5-8890-47ea-9898-4dac145a3c6c" disabled="true"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Acces-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="Authorization" value=""/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="6ed9a18f-1f9b-47a1-925a-3a2fa47cc803" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#TestSuite#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="получить все emiasid из ответа" id="e57dec70-259e-4453-bd91-39642eb46c8b" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper
import groovy.xml.XmlSlurper

response = context.expand('${Посмотреть привязанных пользователей#Response}')
parsedResponse = new JsonSlurper().parseText(response)

ids=parsedResponse.permissions.emiasId
log.info ids.toString().replace("[","(").replace("]",")")

id=10133820
for(int i=0; i&lt;parsedResponse.permissions.size(); i++){

	if(parsedResponse.permissions[i].emiasId == id){ log.info parsedResponse.permissions[i].policyNum; break}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=dyn~emias.info~aea50b20-ccf4-4f96-80ba-44f9610ea5f6&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property><con:property><con:name>code</con:name><con:value>YreYXte4H3qPvA_Qlp8s4v7SMRugxUzGVUql6X4DITztoXK8GwG7fYgwk30o1iBzN2sHDC9fqC-uG0ITrrfkoIZWi80Ko91bYN-iYZzRtMo</con:value></con:property><con:property><con:name>client_id</con:name><con:value>dyn~emias.info~fb5fdc92-6df3-4faa-ad02-3107c95acd76</con:value></con:property><con:property><con:name>client_secret</con:name><con:value>oumRVEchBxS00xy</con:value></con:property><con:property><con:name>access_token</con:name><con:value>Q-F5iygkgbwX82WAwlrw9VZtIRJo23IeTI8M_38uh19jZWJhYThlZC0yNThhLTQ2ZWYtYTZiZC1lZjEzZDdiZWM1MjI</con:value></con:property><con:property><con:name>guid</con:name><con:value>af3e4ac5-96dd-4167-afb3-244eb7187aba</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>55020</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiIzOWRkMGYxOS0xNDI4LTQ3ODAtYTUwMy1lZWE1MGU3ODc5M2EiLCJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MDk4MTc0NjUsInN1YiI6IjkxZDhlYzM0LTcyMzUtNGU2ZC1iOWRlLWVjNmJhZWIzMDQxZCIsImhjbiI6NjE5MiwiYXVkIjoiUEFUSUVOVCIsInNzb19pZCI6IjIyYTlmMDgwLTE5ZDgtNDUwMy04YWY3LTdjNjIzZDE3MTE1NCIsImFtciI6W10sInBheWxvYWQiOnsiaW5zdGFuY2VfdG9rZW4iOiJkeW5-ZW1pYXMuaW5mb35mYjVmZGM5Mi02ZGYzLTRmYWEtYWQwMi0zMTA3Yzk1YWNkNzYifX0.lU2OgTOvWezR0664da6fCZcCVI1ojj6YoV7t7j86kmE6lITeQgZbzR1WSX_iVcFDBjcG_q6jN11TcJkuwwZJSy5lbWUq7qQeMbpeR8TD49io4bRkw76DmofqTrxIVuvbY_mjaf7tZUtqze7QknR10Sc97dTBGhqMUGqbMsLoOSch6ghx_iyoUUbI3oLXJoh96TSyG0xp9gHm0Kta5AsykzuN1-npSapt8zzuLli8B6f-_q2LfQbQK8W8zv6GXCXcI6Isv2tRNknIg4Mp86o0gVe_Xzbad06L8Ub-VGThmAk_NG1CNjlVKQ8sjnyxKqjvB0ms0AfevjJR6_1vmm9k2--1uiKYnaQ90M0OYK003I7crko8WFJa25_z0DPAQgQ-y5JKFcP_40nA6PZ_F1zAgOuifF3Ku9RrTbkIDPTLwGXxJ3yQtEP9Y32a_8DKz47P9Ae2jiQElSjly_gkRm93H7gbvu_7TolisWzvCHbG0h7U1BG7KQhauQ_-Zez66cJsCWvzxRg6PVp9HK9SVjZzhUDsPM5aqcQ_vjOVcB7Xmh4DX39Ao_v7hdlXz8QAfqlJC5w7McFEGn4mL63y1KIF0HPcVx1h6HIbCaVEZ_hwGjahja7UAtwLAf4FEga0UgZpIQKNHUWbeDp3St3xZNpZyV1oJzsOtb398iaixwOYJeQ</con:value></con:property></con:properties></con:testCase><con:testCase id="fd624985-74a2-487e-9266-99e19a36f559" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента и добавить в медкарту" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="c8daa417-5da1-4cd2-96fa-2fa321f21d34"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="5e41bbae-f530-491d-b949-8a4e1545a287"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства второго пациента" id="d74ff5a9-6a2d-43c2-908f-be6360291825"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/BIRTH_DATE</con:sourcePath><con:targetType>birthDay</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/PATIENT_ID</con:sourcePath><con:targetType>patientId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[2]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="Найти пациента в базе СУПП по patient_id" id="415c6a05-744f-4634-9ae5-e4de772e5156"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, 
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE PATIENT_ID=${#TestCase#patientId} </con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="Найти рандомного пациента в СУПП" id="f64e3e0d-6f87-4d90-b8e4-93b6948ae8ea"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER,OMS_NEW_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE ((OMS_ASSURANCE_SERIES is not null and OMS_ASSURANCE_NUMBER is not null) or OMS_NEW_ASSURANCE_NUMBER is not null )
AND ROWNUM&lt;50
ORDER BY DBMS_RANDOM.VALUE</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="Добавить пациента в медкарту" id="f1b4721e-95e8-426c-9924-de0defd06303" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Добавить пациента в медкарту" id="a5f68023-dec0-442a-9721-e4a177894c76" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "documentId": "string",
 "id": "string",
 "permissionType": "CHILD",
 "userInfo": {
  "userName": "Яна Михайловна В.",
  "phoneNum": "79265209207",
  "ssoId": "af3e4ac5-96dd-4167-afb3-244eb7187aba"
  },
  "createDate": "2023-04-18",
  "patientInfo": {
    "patientName": "${#TestCase#name} ${#TestCase#middleName} ${#TestCase#lastName}",
    "birthday": "${#TestCase#birthDay}",
    "emiasId": ${#TestCase#patientId},
    "policyNum": "${#TestCase#series} ${#TestCase#omsNumber}"
  }
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/1/user/grant-permission</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="f30d0dd7-89eb-41cc-b7ae-8e3a80e283a0" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Получить токен" id="70fff049-d91d-4152-829b-a98152e4747b" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/login" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить токен" id="3b40c73f-e9cf-4762-8875-d5f43b1bb979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "code": "med_test_2022@bk.ru"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/login</con:originalUri><con:assertion type="Simple NotContains" id="2b30274b-96a2-4696-981c-a6342eba3ef7" name="Not Contains error"><con:configuration><token>error</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="5812c462-9482-4e8d-b95f-4ad1d19e6230" name="Valid HTTP Status Code 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить attemp-access" id="fe63f6d2-ac0b-432e-ba53-2acdc21a6346" disabled="true"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Получить токен"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Получить токен#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attempt_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="7e64ddde-bb52-47ba-9dd5-bb7d892a231b" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/auth/1/confirm" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="3827440b-59d7-4e3f-82f2-7e31523ea53c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request>{
  "otp_code": "${#TestCase#x-otp}",
  "refresh_token_ttl_seconds": 0,
  "access_token_ttl_seconds": 0,
  "attempt_token": "${#TestCase#attempt_token}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/auth/1/confirm</con:originalUri><con:assertion type="Simple Contains" id="aef0c267-6bdb-4264-9f13-e58bac6df0a6" name="Contains"><con:configuration><token>access_token</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен в свойства" id="a56537e8-8dd2-4159-85c3-03e66fc7c6b2" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.access_token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Получить список прикрепленных" id="43a006c7-f935-4aa1-a53c-250db6151f49"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/profile" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получить список прикрепленных" id="31babd50-0726-4247-bc7a-7409f01fa367" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/profile</con:originalUri><con:assertion type="Simple Contains" id="ab8aa89d-e818-47d9-b829-7850fe93c133" name="Contains"><con:configuration><token>relatives</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="X-Access-JWT" value="${#TestSuite#X-Access-JWT}"/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получить ehrId пациента" id="8df97748-a8ed-4400-8b35-d1316557ace8"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получить список прикрепленных#Response}')
d = new JsonSlurper().parseText(ResponseJson)
birthDay = testRunner.testCase.getPropertyValue("birthDay")
oms = testRunner.testCase.getPropertyValue("oms")
lastName = testRunner.testCase.getPropertyValue("lastName")
name = testRunner.testCase.getPropertyValue("name")
middleName = testRunner.testCase.getPropertyValue("middleName")

fullName=name+" "+middleName+" "+lastName[0]+"."

for(def elem : d.relatives){
	if(elem.birthDate ==birthDay &amp;&amp; oms==elem.policyNum &amp;&amp; elem.firstName==fullName){
		log.info elem.profileId
		testRunner.testCase.setPropertyValue("ehrId", elem.profileId)
		break
	}
}
</script></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>7066630284</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>patientId</con:name><con:value>31110819</con:value></con:property><con:property><con:name>oms</con:name><con:value>7791889720000557</con:value></con:property><con:property><con:name>lastName</con:name><con:value>Сафрошкин</con:value></con:property><con:property><con:name>name</con:name><con:value>Олег</con:value></con:property><con:property><con:name>middleName</con:name><con:value>Юрьевич</con:value></con:property><con:property><con:name>birthDay</con:name><con:value>1984-02-13</con:value></con:property><con:property><con:name>token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2Nzk0OTk1NjgsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJiYjVlYjg1OC1lZjc2LTQyOTUtOTg1OS1jOWQ2YTI1MWIzNTAiLCJzaWQiOiJmMjBlMWJmNC0yZWNjLTRlYTMtOTRjZi1iMTliMzc3ZDYyY2QiLCJwaG9uZSI6Ijc5MTU5Njc5MjMwIiwic3NvX2lkIjoidzlzMGZSVEFXVE9VRWQ5VisremF0c3NsdFVXZnI5UFBIUEhoR1hzYzU3U05QL0ZwcGlOZWo2RzlhaVdXRmdielhHdVcyai9mdk5CalY3WkhlTDRjbGVPVTVEODRjT0RjSk5FNjhKSzBFNnJyT3o0bG8rZnM4cVZIc09rM3hyS1FaZmJUM3NweGgvUUdaaUMvU2JhMjQ3T1MvdVN1VnVYTVVySjUyM1RwSlJNd3RLRnliNXljQXU4b3h5dlYwTXVDVHhZSElOKy9OTU9ubnhvckRFMnIycW05YmwvTjV1QWE4c1B3Lyt6TXJYT1FXdm1PVXZWaUVvbHJXeXkwaS95Z215bjk3TWNtQVRnQ1JLQlE1MmJpTG5PbE41VVRiRi9lc1JCY3Mzb1FVVjc5YTlXTkMxTC9RakxtajdoVUJaY0tkbXJLL2JKaXhMQmp0bW0vL2ZFV1hBPT0iLCJlbWFpbCI6Inlhci5wcm9tby56YXBvdi5hQGdtYWlsLmNvbSIsImZpcnN0X25hbWUiOiJcdTA0MjFcdTA0MzVcdTA0NDBcdTA0MzNcdTA0MzVcdTA0MzkiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMi4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxMlx1MDQ0Zlx1MDQ0N1x1MDQzNVx1MDQ0MVx1MDQzYlx1MDQzMFx1MDQzMlx1MDQzZVx1MDQzMlx1MDQzOFx1MDQ0NyIsImJpcnRoX2RhdGUiOiIxOTc4LTAzLTIyIn0.U56ljjFNsiTlPAubVFSPnALoKcdCCkugqFUNKowxR1CAPe32wlLylF-iTmNF1NqjUm2iVwdV1gIOAZQPl5wKGKYNlAESK59wVfgNDlvuNaHhSLvkZbUtVXHDoSN_HROBiNcGpgrTYvK3X4yXJpXjnif_mehsnuQpn9PLR5hcCg-SXiZ4pbH_ovdhd1YI-d5lNM-IBG6WURBwCU7St7SjjxojxcR8Dtq6HmvsfGtgYBkwu13keryRjRUuWkuWizK5aNHmyxlhsN77IXTVLF-TbfbOZ-BeYFNZXqoMVeImGWVoMUsK3sKc0QpYy1ma81lZvjYBLBYMiCOK8NoY84ZOFd0-xRQ7XdXauDy0-HsQfPxab6pxigvKkx8mgbRkucLhWS_xM0dEVmY5CG7rSB0kNVgmyA4HZufTHHysr1En_a7HE_flx4odcnyQyO1nMKm_dYqzAOFFyYuYHhOJjE_x-FBsfybDSLxKeBiGXbRUTnhGPlmUus_Gs0dVYL0ZyD9aBl8Yh0uiWBMe_yz2KEdTZ__h6bX-RbgAi0lWs3OTQF19XXa5PRZ2w2ftvoJD5JhVvYl-Uf6Lagzox9i8_loWD4GxczbPCU8-dktpmWe-N_fb5O41G6zWcnOvIdOQB8k2u4K89dLr8hNHzcxYlmNNqMm9Em1mYQbzqDHXOxhFFSE</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpZCI6IjdlMjVhYjIzLWUwYTMtNGUxOC05MDNlLWI3MmMwNjYzNjQyNCIsImlzcyI6InVzZXJfYXV0aCIsImV4cCI6MTY3OTQxNjQ1Miwic3ViIjoiYmI1ZWI4NTgtZWY3Ni00Mjk1LTk4NTktYzlkNmEyNTFiMzUwIiwiaGNuIjo1LCJhdWQiOiJQQVRJRU5UIiwic3NvX2lkIjoiQ3Bwb3hwbE56b3M0L2h6RmEycm91S0lORXRQWnpiYkpTNmxlYmRJTDBTbHNNdDgyOEJDYXNMbGRWZHJ1TmZ2S0t2T0J4Ujd1V09RNjdCenpWSkM5aXpNaFd1akVTWnlrczhyb2FqL2VxNEZESnhTakR5aHdNYlo5UFNVam1xdCtyRUJjUHBGV3RRYVdWQk1UQlN1VldoN01xSzc4MHBlL283MGpIZUcxYUpveWlIZU5XaCtsUUhoUy94RHUzUXFKbEFhMEU5S3A3TTk3KzdLR1FoWFVEWVJ5eE1GMm5nZC91MXdCbXdhWkZjeXZkY003TWFRNTBRdUhmeUVORnQwZjRpS0lWL1pIQ0F0QS9qRTdwODRkMFFobXJudmc1TzgrZHZSS1hRb3htdzFWS3RkUVBPckJDMVltd2xtNTNWUU1ac0tRbFZJY2FCSkJEcTFpK2RycnlnPT0ifQ.hZxYie4xivThXf9tN1KLaYunCHqYJIq5XtQ6w24ku2JlVIV75hK54L0ZTtOsMyfOZe-epPyWsOQJBoDM7Z1-l55-Il-AEzjDtM-GBa_uiTiGkB3uvLhHoevWfFil5rwl7-ZEAxldIh5KkL8DzoXQ5K5XLACGgLQpEWPIdGiaWtlD_J3ZX9mfnFKgtPrDbKA-RGIWR9gsk9Kyxm8M_r5zeD-WCAVUNp-veEsGfOrzk2s6u-wOy72nzS97utiaulPEDNvsU7E-zsrBqn3YdRSXgnd4fR3NpwiXTTcSQ8K-D9e1JfNUVbNXpTf6OqiR24sFVH4gaJgsdmfuGT-4byfiygv9RZVhPbint3llTk2Rn15wNoAZJqe3hWgO--gJ7GPKfb_RFhUjquZliI3SI42jcySQRbSVXioJfObmo4LVrJwioyV8IBgsrJKDJ66RFeHPCABek_ktAh_GwAB17FlnXU3dDJ3WSv_jUq3R0-eyx5nAVhlxFqWqdTN5ladfGbOrMebF5IiIGFtxzUNxe1rQGe_1_2f8jumEDDsgkBlaIHQa8O52M1KwVMDDeW-OaL4jnG9OYDcX-1R1iG9jvXpiJh9fsx9Ng5eiYP8OYJsNojczD9vzizyjSxBh6qwze03fXDy5G9rqytp0CpwpcxvNYpi6msgjbF7JoDLuM6SBUuU</con:value></con:property><con:property><con:name>ehrId</con:name><con:value>95706443-b316-4442-894c-748da1962c80</con:value></con:property><con:property><con:name>sixMonthsAgo</con:name><con:value>2022-09-24</con:value></con:property><con:property><con:name>lastNameFirstLetter</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="2f9db4b2-710f-4f22-bceb-62bca5e0dc8e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти пациента по омс" searchProperties="true" disabled="true"><con:settings/><con:testStep type="jdbc" name="Найти пациента в базе СУПП по омс" id="5abcfb51-f652-4e98-8d2c-f19831ecc7f8"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT  OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, PATIENT_ID,
LAST_NAME, FIRST_NAME, SECOND_NAME, 
to_char(BIRTH_DATE, 'YYYY-MM-DD') as birth_date  FROM PATIENT  
WHERE (OMS_ASSURANCE_SERIES=${#TestCase#series} 
and OMS_ASSURANCE_NUMBER=${#TestCase#omsNumber})
or OMS_NEW_ASSURANCE_NUMBER=${#TestCase#oms}</con:query><con:assertion type="Simple Contains" id="02691c48-cd7a-430a-8519-337b2ccbcbe5" name="Contains"><con:configuration><token>row</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Записать в свойства" id="310145e1-65be-4820-b7ae-3075b7b63060"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>birthDate</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/BIRTH_DATE</con:sourcePath><con:targetType>birthDate</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/PATIENT_ID</con:sourcePath><con:targetType>id</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>lastNAme</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/LAST_NAME</con:sourcePath><con:targetType>lastName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>firstName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/FIRST_NAME</con:sourcePath><con:targetType>name</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>middleName</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>Найти пациента в базе СУПП по омс</con:sourceStep><con:sourcePath>//Row[1]/SECOND_NAME</con:sourcePath><con:targetType>middleName</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value>710271440</con:value></con:property><con:property><con:name>series</con:name><con:value>770000</con:value></con:property><con:property><con:name>id</con:name><con:value/></con:property><con:property><con:name>oms</con:name><con:value>770000710271440</con:value></con:property><con:property><con:name>lastName</con:name><con:value/></con:property><con:property><con:name>name</con:name><con:value/></con:property><con:property><con:name>middleName</con:name><con:value/></con:property><con:property><con:name>birthDate</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="5944358f-0e26-4a51-be47-a0b76c219d65" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Обновить base64" id="3d9b2f9c-a7ee-49f5-bf0c-c04f4712fb88"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить токен СУДИР" id="2fceb994-edcc-413d-bfd2-7cc4a502352b"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить параметры для сервиса tokens" id="e165ec3a-c9a2-4f75-b1ce-30152a0f5358"><con:settings/><con:config><script>login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
guid = testRunner.testCase.testSuite.getPropertyValue("guid")

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="e9e08b6a-ad54-47a4-8b95-5f50022fa8ff"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)
log.info "EI-Token "+sudir_token.access_token</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="13d300a8-6bdf-4e68-bfbd-f8ead9fbc6d0"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="cfe61884-ebc8-427a-94f8-42ef1bd395d9"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)

log.info "X-Access-JWT  "+access_token.accessToken</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="117372d4-bb32-4470-b1e0-335e068d4414" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Найти актуальную др пациента" searchProperties="true"><con:settings/><con:properties/></con:testCase><con:properties><con:property><con:name>sudirToken</con:name><con:value>tR-YCyHNmTSlYnTX2fScxBJgahUnQsuXcZKoyU3mCOI</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTAyNDI2NDQsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiI5MWQ4ZWMzNC03MjM1LTRlNmQtYjlkZS1lYzZiYWViMzA0MWQiLCJzaWQiOiI5OTBiMDY2Yi1lYWYyLTRjYmEtODYzYS0yOThjMGZiMzIyMjYiLCJwaG9uZSI6Ijc5ODA3MDc2ODA5Iiwic3NvX2lkIjoiaSt2d2JFQWxvVUE4a1BRTWdyTWdFdFdxS3cvZnVMR3VFQnptcEMydkRLUWFNVGhBZU93Qk8ybmpjMW1aSmI5QTFWYjhacDh2eWc1TllNc2JnZVh4elJrOTVnY3o3VmxKb0dJWmtCS3FpVGFVQ1VwSHZ5YVZyQU8velp2T2tkdkhnbkdLUmQ1cU5WVkY0bUpsSStPK2U2K2JFZWVxa2R6Z3dhWVhrUnNzVms4TmYvbnRpeHBoMnZrNkN0UUdqNFhDTGlHRUNIUll1TTlPM0hzM21jSG55M3k3NE1hb3VQcUZXL3lwblQrT3JuQmNzNVBlSk9ueHMvM3VQcEYyQ1hjbzZ5R2NxZWh5SURpY1hyMEZGTVRlam4zNkd5d2ZzM0I4NlBvMFphTXBGU0s5Unh2Ni90VE9LUFNIdWZMOUtLdmY2ZGNyWFZFdEZyTktkaUw3MVpEQjR3PT0iLCJlbWFpbCI6IiIsImZpcnN0X25hbWUiOiJcdTA0MWRcdTA0MzhcdTA0M2RcdTA0MzAiLCJzZWNvbmRfbmFtZSI6Ilx1MDQyNi4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxY1x1MDQzMFx1MDQzYVx1MDQ0MVx1MDQzOFx1MDQzY1x1MDQzZVx1MDQzMlx1MDQzZFx1MDQzMCIsImJpcnRoX2RhdGUiOiIxOTQ5LTA5LTEzIiwiYW1yIjpbXX0.q3xmvdaCi5rH8pXcu3UCJw3tujOSMRpBW8DgE_wfIfAPa2YNydMRVqZgFkp6CK7GleV3pkGMS1wd9MsiBYhAjV-BnVrpXTmNlq1UBde7Bcw85Hx8fwIjSSQ0AIUOSVsV_XbGDA02TeAX-vqqNZibW-bhKDr02C2BZnuKfZLKOP-DMV0uHy2smM6p5QxqFROdLR_TOcJNxq2IlpVbXEBJkldwnP1FvVQiA123hZ8xQ7UXKI5AmiDerBl9PhXVpgQ59Z-OTMLfZHggxT5-3cJcPDMAhNezU4x4hvLvlj28WydumgJpR3wbpHRNTD899cL11mTsdsa3wllVxLHYQ-5O2bCvxmU9OymSDQat-Eljx9sh42mkdiEnnzEjuDNFm_IYFonRk2lHVse55d7WEPZpLwJAWA7pPIErTYftdiJ3AleUDJBLNCy-H9t_qxoNlBLI-CMLMCd1TX7GOHVadeTKUsbsDfthh0aSGqWSEahXiCvL8H7L5zG0skzU98H8kI2ZYk9M_KeWCirHpwxyl-V6KyISCv5X6g6Um7r0MIGVZ-F69o5A0NyzOdBkgR77Biwbplhz9n-tUS2kgb4yUY2r0KI_RpYOBUMVuqN9iu3JZIcet_UkC1xkMHEwZV4RRXq0inqGflVYDxSJmOXofortVx0XiBpJFZlVi6_0f8tCuaE</con:value></con:property><con:property><con:name>softwareStatement</con:name><con:value>eyJ0eXAiOiJKV1QiLCJibGl0ejpraW5kIjoiU09GVF9TVE0iLCJhbGciOiJSUzI1NiJ9.eyJncmFudF90eXBlcyI6WyJhdXRob3JpemF0aW9uX2NvZGUiLCJjbGllbnRfY3JlZGVudGlhbHMiLCJyZWZyZXNoX3Rva2VuIl0sInNjb3BlIjoib3BlbmlkIGNvbnRhY3RzIHByb2ZpbGUiLCJqdGkiOiJmYjg2NDcwMS1mZGNkLTRjZjctODg1Mi01ZTVmNDY3N2ZjZTYiLCJzb2Z0d2FyZV9pZCI6ImVtaWFzLmluZm8iLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMSIsInJlc3BvbnNlX3R5cGVzIjpbImNvZGUiXSwiaWF0IjoxNjM1MTczODIyLCJpc3MiOiJodHRwczovL2xvZ2luLXRlY2gubW9zLnJ1IiwicmVkaXJlY3RfdXJpcyI6WyJodHRwczovL2VtaWFzLmluZm8vc3VkaXItbW9iaWxlIl0sImF1ZCI6WyJlbWlhcy5pbmZvIl19.glfjJb7PXa7l3O3CMIOrbw_N0Cd5y-kyn5lklyVGLXDAFv8MqC85MfgqEE86buaTAsOwEAqqoTwLpOXodN9ds_q7zcDyLQoDcILHhgg9G3-DoLu9XxpPbaRNFBjzpgZrjKZCGJCSqdjnQJzNv2-oySD_xTKHfXFjy62SITRnUjJCyxhmbrtckjJX6RckCqv3Y3WFgr8nmMcjh-OFgquklokVlo3cfRl4R1JwEe5kiya7ZfqsNhwhx_iaG4SHYICtzYboToAfiLYbJsJ-H89I7FspusOhidkrt23BteNUnjzT3Jx3_OuWauK4aLkaBXQzFVksaoDiuRHmHn6uOzFihQ</con:value></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login-tech.mos.ru</con:value></con:property><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+YWVhNTBiMjAtY2NmNC00Zjk2LTgwYmEtNDRmOTYxMGVhNWY2OldJYm8yUERDQlhoSnpWUQ==</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>iYC65D76U33QyERflNtnuu6OLJOkdBVwZVjkYdakHR9ZCugW7JivoTVglPlaNvKon8ZrYasEMdMpxauxdemZ_A</con:value></con:property><con:property><con:name>guid</con:name><con:value>22a9f080-19d8-4503-8af7-7c623d171154</con:value></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lkservice.test.emias.ru</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiI3ZDNlZWQ4Yy03N2E0LTQ0Y2ItYjUzZC05NDU0NzRkNDk2YmMiLCJzaWQiOiI5OTBiMDY2Yi1lYWYyLTRjYmEtODYzYS0yOThjMGZiMzIyMjYiLCJleHAiOjE3MTA4NDM4NDQsInN1YiI6IjkxZDhlYzM0LTcyMzUtNGU2ZC1iOWRlLWVjNmJhZWIzMDQxZCIsInNzb19pZCI6IkNHaDNEWVcyUnlYeVUxS1hEMmFzOVFibTBBYjh3NzNabFFvZFlUaG9BRTFsdCtGSjAxczdpZHpWMVQra09PbkkreGU4cng3b3dQQlBCNk91UFdTMFZmV29xSEw2Wnl0U2FPbmJ6TWhLbW5weTNrRUtETFNwV2FJanFHVFRiZnRDZ3NQOThmUnVabVlpKzcyWFRtQnpENThzQXJ0akd0U0g0WXdRZG1CREFJaEFTU2E3bXY2TFhwRHAyWmRScjBTTnFIL1NSVlBON09VaHF4cWtjaWord2R0cXRDRlJxV3VMQlo2ZmNjOU9lcWsrbE1PbFZhT2o0NmNXbFowSUxycGIxbXZwOTdUN1NkbkRMNkdlYnh4RTdvbmR5WjJKZ2FxRExZMVVzdS81NFkzVDdJekcyeEg0SExtUHFxSU1hN0R0TEFUeTh0MkE5cm9HSThlK3ltTDQyQT09In0.hcoZDMrJUZ9iGz66xZwlqfDk0VOUqdpwN9ShocgiNRyiUkpBZlF9sjkH8UJ80OS0nmkwngCJvHGuCA5cDJrYMRTMMgr7OXuf20BGMwNwlaGX22V0KnKU2QQbcsqBJrlIxg12k8N2IB9qhdkeZzIHde7yVogVdUNuG_ZzD1XzNRfGCqZF_eM1DSo85Wqf3HK-mmb4QBbJSBkRVHM7CFMWESvncSq8zvPU6pPMlVEzymlmgr89HZmv_ShEI8oZpENu5fv5EYaY_PEavFQqbwnBBt--vhjj8GfPwasOpwVTxDBwgeavoGBjS5Bfo3ya0LACmaOzGANwajTVrg-IeRY5ewxn-T5uLG1MZ2k0Dc8_q3Avk51ic59fyo8xy1Nnl7NbZGqVHBMnajNzP0TPtsZ06L2urFMMTmcysa3ZjdgQ4jfAMa4x1zSJ9YHwS4dzjvmoAxiAjcB1VcI-hwuG9Jt8QGHPQKBmcDmsO1n4XtVLyAg1w4ID2X2VsBEGG8ztBkp5c8B8JPMCvNjddo8UTpLGo68DCSfZCOtNb3XKKp9Ks1UujZAPXHjgdJ6UnNA0QRZdz0S4SCJd_poXqCs43E1kOeSju38AjrLs2a6IxoUVoLwy4naxnKanli0q2ij0wD1qBW7bfFO0lMWFepfbodD0k98fmHaFvQneZQpDAt9NFdA</con:value></con:property><con:property><con:name>login</con:name><con:value>mtkb92@rambler.ru</con:value></con:property><con:property><con:name>password</con:name><con:value>web1yx2hQ7</con:value></con:property><con:property><con:name>clientId</con:name><con:value>dyn~emias.info~aea50b20-ccf4-4f96-80ba-44f9610ea5f6</con:value></con:property><con:property><con:name>clientSecret</con:name><con:value>WIbo2PDCBXhJzVQ</con:value></con:property></con:properties></con:testSuite><con:testSuite id="3cd22a89-6f75-4fea-9acf-52ca70277bb4" name="Получение и обновление токенов СУДИР и ЛК(контур ПредПак)"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="492771cb-6bd0-47d5-b2be-cf5388e16c32" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получение токена СУДИР и токена ЛК" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Получение client_Id client_secret (шаг 1)" id="d5d45247-be12-4c0d-bc6f-0d35d4148c27"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/register" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение client_Id client_secret (шаг 1)" id="1acba04c-b558-4b14-94b3-193346516e38" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer jIeAUJjALkvjRcU_wAcASnNNc9ovLxhApSnJfqt2JLcRw_jCyugGxXfMdPVBayeiPj0pmufDqQxmE9ofd8Rnww" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request>{
"software_id": "CSI",
 "device_type": "android_phone",
 "software_statement": "${#TestSuite#softwareStatement}"
}</con:request><con:originalUri>https://login-tech.mos.ru/sps/oauth/register</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2013d0e-b347-454d-bc12-f33e5b820ccc" name="Valid HTTP Status Codes"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись client_id client_secret" id="081250bf-ee90-4575-a46e-e8a7f6cbac95"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_id</con:sourcePath><con:targetType>client_id</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_secret</con:sourcePath><con:targetType>client_secret</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Кодирование в base64 + составление запроса" id="241e90a9-a74d-4e4e-8af4-21f2da9f7459"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.getPropertyValue("client_id")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.getPropertyValue("client_secret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
//testRunner.testCase.testSuite.project.setPropertyValue("base64",auth)

////////////Составление запроса. Ссылка для авторизации///////////

link = sudirUrl+"/sps/oauth/ae?client_id=$client_id&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile"
testRunner.testCase.setPropertyValue("link",link)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)
login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)</script></con:config></con:testStep><con:testStep type="manualTestStep" name="Действия со ссылкой" id="23b56662-2bd3-47d2-8f49-95875f88c789"><con:description>1. Скопировать ссылку из проперти кейса (link)
2. Открыть консоль разработчика в браузере (F12)
3. Вставить скопированную ссылку
4. Ввести логин/пароль и капчу (логин: 79633516263 пароль:Hibmavy3Pitnico9 )
5. Нажать войти
</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="delay" name="Delay" id="1fea9fcb-e485-4189-bdba-f14f0b938ad1" disabled="true"><con:settings/><con:config><delay>50000</delay></con:config></con:testStep><con:testStep type="manualTestStep" name="Подтверждение и копирование кода" id="1bf6a107-3d7a-48c7-b5b9-1812bfa68cfc" disabled="true"><con:description>1. Нажать кнопку "Подтвердить"
После получения данного кода есть минута, чтобы отправить следующий запрос
2.Скопировать код из консоли разработчика
3. Вставить код в проперти кейса (code)</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="restrequest" name="Получение токена СУДИР" id="d9e39295-b6f3-4fd8-a831-8d229d215bbc"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение токена СУДИР" id="26f90063-1811-4565-b889-d93e4d165864" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="fd19a4af-366b-4fed-8e55-939a693dbce6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="code" value="${#TestCase#code}"/>
  <con:entry key="grant_type" value="authorization_code"/>
  <con:entry key="redirect_uri" value="https://emias.info/sudir-mobile"/>
</con:parameters><con:parameterOrder><con:entry>grant_type</con:entry><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Записать токен СУДИР и refresh" id="2aaec137-6a37-4a37-9e3f-d785f01a95df"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получение токена СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)

log.info sudir_token.access_token

testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Получение данных о пользователе" id="af17e5f8-fe38-437c-b2b5-01df3b8090b8"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/me" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение данных о пользователе" id="e34c85f0-463c-454a-bb0f-a0f8070e9b0a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2a895841-cf20-40c7-a34a-86a7e5719b50" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="Bearer ${#TestSuite#sudirToken}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись guid" id="2effd352-aaf9-48ce-a830-fce0040dd89d"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>guid2</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#Global#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Зарегистрировать инстант" id="b8985359-6355-463d-8dd2-2d96f94fb117"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Зарегистрировать инстант" id="60261039-b4ea-4d59-9649-f46e0fc1f793" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "instanceToken": "${#TestCase#client_id}",
  "sudirToken": "${#TestSuite#sudirToken}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance</con:originalUri><con:assertion type="Simple Contains" id="ca95a9e3-62a6-424f-a200-baaf7d074f58" name="Contains"><con:configuration><token>attemptToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК2" id="35cfdb06-1b70-450e-b1a3-3622c7c1a307" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК2" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение attemp-access" id="bba13ca6-1e89-4423-b241-e30e032de16c"><con:settings/><con:config><script>import groovy.json.JsonSlurper

def httpResponseHeaders = context.testCase.testSteps["Зарегистрировать инстант"].testRequest.response.responseHeaders
testRunner.testCase.setPropertyValue("x-otp", httpResponseHeaders.'x-otp'[0])

ResponseJson = context.expand('${Зарегистрировать инстант#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attemptToken)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="9aa8ffc0-3a10-4953-a9dd-8582eab5c829"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/confirm-instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="33cd7c74-7696-4e79-b652-2c604d7a36bb" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
    "otpCode": "${#TestCase#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:originalUri>https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance</con:originalUri><con:assertion type="Simple Contains" id="3d630dca-8dc0-493c-ba56-a3d039abaa84" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение X-Access-JWT" id="be9f97b8-9dda-4ab8-9e25-7bdfbfdb128c"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Подтвердить токен#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
base64 = testRunner.testCase.testSuite.getPropertyValue("base64")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("base64", base64)
guid = testRunner.testCase.testSuite.getPropertyValue("guid")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="transfer" name="Записать токены ЛК" id="b7339bf9-fb71-428f-84f1-b4f41cc9f6ae" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.accessToken</con:sourcePath><con:targetType xsi:nil="true"/><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>refresh_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Подтвердить токен</con:sourceStep><con:sourcePath>$.refreshToken</con:sourcePath><con:targetType>refresh-X-Access-JWT</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК" id="b7a62d4b-556f-49f0-aaba-3336c647bcb3" disabled="true"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Acces-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="Authorization" value=""/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="304f4b35-aa17-48ea-9c0e-ed85bec2692b" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#TestSuite#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login-tech.mos.ru/sps/oauth/ae?client_id=dyn~emias.info~6cf4f1a4-c38a-4ca9-9e6e-bbbcfc4ecb25&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property><con:property><con:name>code</con:name><con:value>NdTeSBu93ZUD7zbHn-qPUFvYOigYA9QouSNk1xKLDE3qoJwoJ3caXOPXUDGhmQ6B5s6V3nJofMsc3a1E_cgbJPWgfJgeqMX2-nPvYrohrL0</con:value></con:property><con:property><con:name>client_id</con:name><con:value>dyn~emias.info~6cf4f1a4-c38a-4ca9-9e6e-bbbcfc4ecb25</con:value></con:property><con:property><con:name>client_secret</con:name><con:value>8FwRBYKEwOl1uxA</con:value></con:property><con:property><con:name>access_token</con:name><con:value>Q-F5iygkgbwX82WAwlrw9VZtIRJo23IeTI8M_38uh19jZWJhYThlZC0yNThhLTQ2ZWYtYTZiZC1lZjEzZDdiZWM1MjI</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiIyOGQyZTVkZS00ZjQ2LTQ4ZDctYTU4Ny1kODZiNDY0MjNiZWUiLCJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2ODkxNTc1MzYsInN1YiI6ImJiNWViODU4LWVmNzYtNDI5NS05ODU5LWM5ZDZhMjUxYjM1MCIsImhjbiI6Mjc2NywiYXVkIjoiUEFUSUVOVCIsInNzb19pZCI6IjgzMjk0YmRhLTVmMzktNDRjMy1hNWU2LWJiMGQzNDhhNzk0YiIsInBheWxvYWQiOnsiaW5zdGFuY2VfdG9rZW4iOiJkeW5-ZW1pYXMuaW5mb342Y2Y0ZjFhNC1jMzhhLTRjYTktOWU2ZS1iYmJjZmM0ZWNiMjUifX0.PLHcA-4Mgy_K8q0AAD_SxG2zWntm3gARAgMZFBnqNhwtK6VcHBYknd0cSe8RaXbovQlXTPLZTLXensOV10U7FwhATdoLpRwZw8wqOCv_0zAYhnrNEGKjul2Kh340EWioyIrveEVVEUmN1Rc4HJtGi0x7TTHZ9FbTiT7gG79-vTbeMpUfjhczfM1UJ3Y2NaRDg_1zBX1NUt64WO2sTYOdk2iWqZUHoCG4BB7-k0Nc2Ul7mAPzt5Nekqt-ssyu4G0szQs2g26lTiKWtgdIbMaUTHedJ_Y9fywMuM3zcgaAQSuzmfatMMrBKZztVctqSVVnzDhOsYOhHBDsGcsRzMGG6atlpy-ZGy1XbO4uAOxIxm2MamZcFbcAzOfriMnX5TziBB1dkFj7fnniD_TdL8FmrFNxJWkkJTJ35kv46KY_1Dd30kmkHq7UeLuyUPHWKcmJlfcHDO-iE5UYWBhkuuSAbGjW8wz22zIfwy1yfaYCEnjMq8TcemvyWl9U7__pRCnGQj3-WZMpOWA_fZb-qJpEz1AE2Qrt24KfPvklK1WPTzFVh_x7iSyMnA5ms1oBMp5uWtp6qDvM-ULX9LQY5CDR9GrwIT5tX8J3gMAg4f3I1NqMyzo8uBbdd6lh2Q-43a5AkPmIf14d1uIwZrK9XUjcG8-OynqDnZs3CIvvnUgr_ig</con:value></con:property></con:properties></con:testCase><con:testCase id="bc7977ca-3bce-4948-9d68-9e8ffb57629a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Обновить токен СУДИР" id="2c014049-62e0-49a7-b4fc-7046cc260329"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="05d9ea1e-6b00-4d83-80cc-0e80f32ae172"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="3b2516af-9ea5-4e40-909d-39a38d5008fd"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="a2ef31b6-85a6-45ac-8888-a46536ad7be2"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)</script></con:config></con:testStep><con:properties/></con:testCase><con:properties><con:property><con:name>softwareStatement</con:name><con:value>eyJ0eXAiOiJKV1QiLCJibGl0ejpraW5kIjoiU09GVF9TVE0iLCJhbGciOiJSUzI1NiJ9.eyJncmFudF90eXBlcyI6WyJhdXRob3JpemF0aW9uX2NvZGUiLCJjbGllbnRfY3JlZGVudGlhbHMiLCJyZWZyZXNoX3Rva2VuIl0sInNjb3BlIjoib3BlbmlkIGNvbnRhY3RzIHByb2ZpbGUiLCJqdGkiOiJmYjg2NDcwMS1mZGNkLTRjZjctODg1Mi01ZTVmNDY3N2ZjZTYiLCJzb2Z0d2FyZV9pZCI6ImVtaWFzLmluZm8iLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMSIsInJlc3BvbnNlX3R5cGVzIjpbImNvZGUiXSwiaWF0IjoxNjM1MTczODIyLCJpc3MiOiJodHRwczovL2xvZ2luLXRlY2gubW9zLnJ1IiwicmVkaXJlY3RfdXJpcyI6WyJodHRwczovL2VtaWFzLmluZm8vc3VkaXItbW9iaWxlIl0sImF1ZCI6WyJlbWlhcy5pbmZvIl19.glfjJb7PXa7l3O3CMIOrbw_N0Cd5y-kyn5lklyVGLXDAFv8MqC85MfgqEE86buaTAsOwEAqqoTwLpOXodN9ds_q7zcDyLQoDcILHhgg9G3-DoLu9XxpPbaRNFBjzpgZrjKZCGJCSqdjnQJzNv2-oySD_xTKHfXFjy62SITRnUjJCyxhmbrtckjJX6RckCqv3Y3WFgr8nmMcjh-OFgquklokVlo3cfRl4R1JwEe5kiya7ZfqsNhwhx_iaG4SHYICtzYboToAfiLYbJsJ-H89I7FspusOhidkrt23BteNUnjzT3Jx3_OuWauK4aLkaBXQzFVksaoDiuRHmHn6uOzFihQ</con:value></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login-tech.mos.ru</con:value></con:property><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+NmNmNGYxYTQtYzM4YS00Y2E5LTllNmUtYmJiY2ZjNGVjYjI1OjhGd1JCWUtFd09sMXV4QQ==</con:value></con:property><con:property><con:name>sudirToken</con:name><con:value>A-Xc37iRpGrbhqU5bJ8fJwIIDz4ZKtRhc8zZWZxjm3YwZTJlMzg1YS00MmQ1LTQ5YTItYTc1Ni1hYTljZGY2ZTQ0YmM</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>YpynVr1CwulTo8z6r7349gGRkHsr7WdS_DJQB8yCVbcC2ycEXRbv8XmkkWObyDrsaCPcVTiQE7qoUNlfM4jBwg</con:value></con:property><con:property><con:name>guid</con:name><con:value>83294bda-5f39-44c3-a5e6-bb0d348a794b</con:value></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lk-prp.mosmedzdrav.ru</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2ODkxNTc1MzcsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJiYjVlYjg1OC1lZjc2LTQyOTUtOTg1OS1jOWQ2YTI1MWIzNTAiLCJzaWQiOiJmMDliN2RiZC1lZDViLTQ3NGMtOGQzYS02YjQzZDYyZDAyNDgiLCJwaG9uZSI6Ijc5MTU5Njc5MjMwIiwic3NvX2lkIjoieHRXZi95bzJVTVNWSHhITXFjZFRqbSs0bWJVK2NDNXNmUGsyUkZ5NWtmRlpyQmt0K2REbkFRNFptMCtYNmQ2VkxLbDlTU1NTQ1dxYnlmUW5KMTAxaTBRNURxdkl0V1JhQ0d2ZGRtYWI3bnQ4MHhkT29EazRWMHlZMjRNS1l6TC9pQTJpcUJlWmwyUlN0WlhsWkRDQlBjQnBkRmVXNDlOS3JabytkY3ZtQ2hIcTRkZWtVazJzYnl5bzdlSkFlK3NoZGlWOWlENW5IZWlSVzgxeTBOakNHSysvcmNKS0x5VzlZK3hFbXBwRDQ3WTdZS0gvaGJLdDE3clU4UkpTM25HME5leDFmMjZ6V3VMV2hKMWwrS2FGYW1zbkhQN3V3eDkxWWVuMWwyK3FWQUVUUVQ3akNLcDc2aHFnNnUwT2pNY0hGQWp0QU1taWZPdXRNUVpwMVYxeGdnPT0iLCJlbWFpbCI6Inlhci5wcm9tby56YXBvdi5hQGdtYWlsLmNvbSIsImZpcnN0X25hbWUiOiJcdTA0MjFcdTA0MzVcdTA0NDBcdTA0MzNcdTA0MzVcdTA0MzkiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMlx1MDQzZCIsIm1pZGRsZV9uYW1lIjoiXHUwNDEyXHUwNDRmXHUwNDQ3XHUwNDM1XHUwNDQxXHUwNDNiXHUwNDMwXHUwNDMyXHUwNDNlXHUwNDMyXHUwNDM4XHUwNDQ3IiwiYmlydGhfZGF0ZSI6IjE5NzgtMDMtMTUifQ.Hfo7a1Q-d6igrTyVi7qfxqQW1lpUVVFsx5kSsKvwJm0J4oRgtl4Wetj13d-7j3v41Cvf7UwwCsuGn_u7MGth1PTJDPlVGzDaVLPajM3bdUssKicWvVfKtfh3ktoSu4lBWBiL4XMBAJtEdusYvICJDefsKOeZQV5XXlsUX2ppDLsV2WEz7RUH9LiNv5VfI1QRcjD_7716mcNuaUj1_Mr_LUmwFiHEnZW0w2xQ2M8Mfho6vjCEFLStV5DOCn0mSQfWzOfVQwSwnWhXJxxfzQ8kgtPOCsj6Jb4QV4DJcoUr3bjEPoVWI6DVfAyLziNr60_qTVq4bqMZVnJ7CJQRSszhvu1G8XpPH9Gih2bzD9aVJy_Hcg9Z9jpWpkkh2IDtrZynQZiASomB63rc2jzV1wIOdyx2Dl10PQ9oxRNTSeGdRPNJ3DRS2s3OjqZ_LqQVJkEbV_hJfP_FUKxlV0iHHGklgRo2SBGwQZzYCNui5GF_OuADRV-NlqilzUekzarIr8jGX_ew2z02-Iov8Eu3ZkB3Ffst2yphF51P9gSwE8Y48UlUfTZwTGJXNVHsr6ff-ARQLEeetaaCjbH94n4aWaoy3a2U4BP6VMwdKt_cJ_x9WrpI3DP9Vzocby9bK__Ie8c_Xn_67N_G5jYRcDFW0otGoxVt6nLA25n7J0XA7IlEmWo</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiJjNzExMTc1YS0xMTE5LTQ4OWMtYjRmNC00M2E4MTAxOTViMDMiLCJzaWQiOiJmMDliN2RiZC1lZDViLTQ3NGMtOGQzYS02YjQzZDYyZDAyNDgiLCJleHAiOjE2ODk3NTg3MzcsInN1YiI6ImJiNWViODU4LWVmNzYtNDI5NS05ODU5LWM5ZDZhMjUxYjM1MCIsInNzb19pZCI6InYzN0RXTXBpS1czNXFCclB0ZElRRGVTemw3M2lBS3ZpOG16TWxBS0hkSDliNG04TWw1VmlYRFBYMVNjUkp0VXRBekxVVTlnU2lDVW9idWdraXNHMXVoSEtoTkZGV09kbHNrRzE0QjlCUEx1ekUzZisxVjdVSSs5SytIM2ZOc2FnWUp0QVBUcTFUcGpKVHRPZlVWZnJXL3plUmtoRitpY3E5bFcvY0diTWpqV042UWM1UWdaOE83c0JFV1IvOWRZUSsydjViMnJNSG1yeGxDT1ZjRDRYRXcrZHZKV213K2Myb3NtbXBCYmhyKzdDcXN2MWNDMVY3U2orOEFLbGVuN0lheDVFT0ZBTDBrODYwR2o1Z01sN2JDaG95RXJBWmN6VHg0amNrTkJYZEdINkVBTm92c2EzRTZPOFMwZGhwUHoxckc3Y3ZiQkZIb2VzOEhGOVBHMlJlQT09In0.T3I2qNoLBV4VOwP2ZaK3H63lRK1A0kKZtiBXB7vXYiDUx0sg1wFqyhDkUCWP-fGSpp6-qBSYDa3840El8ugwaaUFT2eUdbGCp0f-hjds9QY2XmYLTn6swnZYO3HD-hs03kVhyx82tZs4KoyIYI2nKrIbeDonX1cZDjF4UlNlUFID7jCUClqXKt6pTzQ5mM8vH8PeImg3-JzWjCiMYC1ZIwlOC_aWe3wFnnfMjtlqfjYJF0jWFK0tJR2whz59Nv0Ec4P5JX6xShOFF96lSeBrfjaDL86eCNT43TZU9D50zgwIG9DodTD1gijiWtjpb0j0flyjqRfgMNsVR6MxTpiV3ZNAJVzOGdJIQmSKHqNhSsnI7TRF-9_IeiW2FJ2bdzcfKGb-4NVR_aLIDITTTcyhxdH42AOdS-hrbTU9WvbFUfVgQJrVCA98OS7s7_9F-odnYDwzG6YeCPd_z9UbOo5AYgGy6NAn7L444axVN-q5GrVV3osX9bZBeHwzYsh2yfOmWn6_QURfHwIPSHTMD0aED1HccTvDvaUb5xIuq1VtNQcniScCoaXpefN-W209hdSoc0oH-oO_EGnrL4OOhRhUqowgpbs3H3VecmZZtJc1osZL0yrtfqm2VvaJDHOwzPEaF4euchvojBHQVW1hdIQNxu6UTF0JgIZl-soEvT72uWY</con:value></con:property></con:properties></con:testSuite><con:testSuite id="5aed39eb-a84b-4326-859d-87af8b672049" name="Получение и обновление токенов СУДИР и ЛК(контур ППак)"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="3ba20825-8b53-4d1e-a079-292f85b3073f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получение токена СУДИР и токена ЛК" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Получение client_Id client_secret (шаг 1)" id="4ebdf6f9-8751-4d4f-a194-3b6eb6221738"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/register" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение client_Id client_secret (шаг 1)" id="1acba04c-b558-4b14-94b3-193346516e38" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer dSMou9xgaumyJpb8hmWJmRoTIcgL6ZXoo6LbgLZkerSCfg-2Zof-Xa4ulRrikbZmVKlgoyApnWw0nYw9Y31ivQ" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request>{
"software_id": "CSI",
 "device_type": "android_phone",
 "software_statement": "${#TestSuite#softwareStatement}"
}</con:request><con:originalUri>https://login-tech.mos.ru/sps/oauth/register</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2013d0e-b347-454d-bc12-f33e5b820ccc" name="Valid HTTP Status Codes"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись client_id client_secret" id="8bca8521-cdaf-40b3-a577-09ef48716505"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_id</con:sourcePath><con:targetType>clientId</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>client_secret</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение client_Id client_secret (шаг 1)</con:sourceStep><con:sourcePath>$.client_secret</con:sourcePath><con:targetType>clientSecret</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Кодирование в base64 + составление запроса" id="7c4a3ab4-01c0-4b21-ae57-af93fb55966a"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
//testRunner.testCase.testSuite.project.setPropertyValue("base64",auth)

////////////Составление запроса. Ссылка для авторизации///////////

link = sudirUrl+"/sps/oauth/ae?client_id=$client_id&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile"
testRunner.testCase.setPropertyValue("link",link)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)
login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)</script></con:config></con:testStep><con:testStep type="manualTestStep" name="Действия со ссылкой" id="dd249237-fe68-4780-a52b-89100ce4947d"><con:description>1. Скопировать ссылку из проперти кейса (link)
2. Открыть консоль разработчика в браузере (F12)
3. Вставить скопированную ссылку
4. Ввести логин/пароль и капчу(логин: test_000-099-782@pflbmail.hopto.org пароль: 4aC2kwV2 )
5. Нажать войти
</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="delay" name="Delay" id="7bcc90c9-7c77-4afc-b872-cd3d2dd17007" disabled="true"><con:settings/><con:config><delay>50000</delay></con:config></con:testStep><con:testStep type="manualTestStep" name="Подтверждение и копирование кода" id="003ebf4a-2ac4-431d-bd3d-f3e69afdedf4" disabled="true"><con:description>1. Нажать кнопку "Подтвердить"
После получения данного кода есть минута, чтобы отправить следующий запрос
2.Скопировать код из консоли разработчика
3. Вставить код в проперти кейса (code)</con:description><con:settings/><con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:testStep><con:testStep type="restrequest" name="Получение токена СУДИР" id="d67eadb6-6020-484c-bbb7-d2a78a8984ed"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/te" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение токена СУДИР" id="26f90063-1811-4565-b889-d93e4d165864" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="fd19a4af-366b-4fed-8e55-939a693dbce6" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="code" value="${#TestCase#code}"/>
  <con:entry key="grant_type" value="authorization_code"/>
  <con:entry key="redirect_uri" value="https://emias.info/sudir-mobile"/>
</con:parameters><con:parameterOrder><con:entry>grant_type</con:entry><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Записать токен СУДИР и refresh" id="cf489205-141b-48bb-8511-de13261c50af"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Получение токена СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)

log.info sudir_token.access_token

testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="restrequest" name="Получение данных о пользователе" id="ea75d326-aaf7-40d3-8a2d-2ba0f99ae46d"><con:settings/><con:config service="https://login-tech.mos.ru" resourcePath="/sps/oauth/me" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Получение данных о пользователе" id="e34c85f0-463c-454a-bb0f-a0f8070e9b0a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/me</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2a895841-cf20-40c7-a34a-86a7e5719b50" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="Authorization" value="Bearer ${#TestSuite#sudirToken}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Запись guid" id="0a186a74-342c-4290-94ce-1977c98ee288"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>guid</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#TestSuite#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>guid2</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Получение данных о пользователе</con:sourceStep><con:sourcePath>$.guid</con:sourcePath><con:targetType>guid</con:targetType><con:targetStep>#Global#</con:targetStep><con:targetPath xsi:nil="true"/><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Зарегистрировать инстант" id="ee752cdf-fe84-44c9-bced-0061d8f343ea"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Зарегистрировать инстант" id="60261039-b4ea-4d59-9649-f46e0fc1f793" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
  "instanceToken": "${#TestSuite#clientId}",
  "sudirToken": "${#TestSuite#sudirToken}"
}</con:request><con:originalUri>https://lkservice.test.emias.mos.ru/api/2/mobile/auth/instance</con:originalUri><con:assertion type="Simple Contains" id="ca95a9e3-62a6-424f-a200-baaf7d074f58" name="Contains"><con:configuration><token>attemptToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Users с доступом к ЭМК2" id="146112fb-3612-4c5b-9e50-c6853468ab99" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/1/user/grant-permission" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Users с доступом к ЭМК2" id="7afb73ec-356a-499b-a3dd-566e7c239c30" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-Access-JWT" value="${#Project#X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru./api/internal/3/emc-permissions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ef35c434-94e6-4c3e-b7f2-acf1722fa3ad" name="Valid HTTP Status Codes"><con:configuration><codes>200
</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ssoId" value="${#TestCase#guid}"/>
  <con:entry key="X-Access-JWT" value=""/>
  <con:entry key="ehrId" value=""/>
</con:parameters><con:parameterOrder><con:entry>ehrId</con:entry><con:entry>X-Access-JWT</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение attemp-access" id="18e5607a-fadb-4139-b764-146fb60d64f2"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Зарегистрировать инстант#Response}')
attempt_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.setPropertyValue("attempt_token", attempt_token.attemptToken)</script></con:config></con:testStep><con:testStep type="restrequest" name="Подтвердить токен" id="0d8b2008-ae35-4aae-b75f-2460e175c545"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/confirm-instance" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Подтвердить токен" id="33cd7c74-7696-4e79-b652-2c604d7a36bb" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request>{
    "otpCode": "${#TestSuite#x-otp}",
    "attemptToken": "${#TestCase#attempt_token}"
 }</con:request><con:originalUri>https://lkservice.test.emias.mos.ru./api/2/mobile/auth/confirm-instance</con:originalUri><con:assertion type="Simple Contains" id="3d630dca-8dc0-493c-ba56-a3d039abaa84" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Получение X-Access-JWT" id="7eba6494-a1c3-491b-be04-06b705a2e5bf"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Подтвердить токен#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
base64 = testRunner.testCase.testSuite.getPropertyValue("base64")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("base64", base64)
guid = testRunner.testCase.testSuite.getPropertyValue("guid")
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="412e9d0a-e655-4544-a681-9ba170dfdb5e" disabled="true"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#TestSuite#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>link</con:name><con:value>https://login.mos.ru/sps/oauth/ae?client_id=dyn~emias.info~8e034b4f-6f8a-4c49-9e85-198faa1eb3bd&amp;response_type=code&amp;redirect_uri=https://emias.info/sudir-mobile&amp;access_type=offline&amp;scope=openid+profile</con:value></con:property><con:property><con:name>code</con:name><con:value>wrJEAHUMaOL6oYoFu_WomOPeZHLESgaG119DYAmoRKou_LP50-HKUUP2kd1AmWIXHKy4qVqYea_Dy0NEQ0GGQ3Kfa_eBgaKQxQteySPtfnU</con:value></con:property><con:property><con:name>client_id</con:name><con:value>dyn~emias.info~01cea7e5-3eaa-4f74-85ac-2be1fb098aaf</con:value></con:property><con:property><con:name>client_secret</con:name><con:value>DJEtlVecFl3tg5K</con:value></con:property><con:property><con:name>access_token</con:name><con:value>Q-F5iygkgbwX82WAwlrw9VZtIRJo23IeTI8M_38uh19jZWJhYThlZC0yNThhLTQ2ZWYtYTZiZC1lZjEzZDdiZWM1MjI</con:value></con:property><con:property><con:name>x-otp</con:name><con:value/></con:property><con:property><con:name>attempt_token</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiI4ZmZmZDM1My1mMGZmLTQxNGUtYWExNS04ODg2MWM4YThlMGIiLCJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTAyNDM4OTQsInN1YiI6ImVhMjQ0OWU4LTliZTUtNDljNC1hOTlhLTVlMzEzYjVkM2I1YiIsImhjbiI6NzExNywiYXVkIjoiUEFUSUVOVCIsInNzb19pZCI6IjIxNDljMmQyLWUwYjMtNGZlOS1hODEwLTQ0MzU3MDgyNDJjZSIsImFtciI6W10sInBheWxvYWQiOnsiaW5zdGFuY2VfdG9rZW4iOiJkeW5-ZW1pYXMuaW5mb344ZTAzNGI0Zi02ZjhhLTRjNDktOWU4NS0xOThmYWExZWIzYmQifX0.ED3RZ4YsivPvgJ668E48ho7X19FS_TG7WxcfMUk1jKwV6p_CsonvRPALSexdLJPY8OYjLoo7eoA2XArF5OtEKFXArwlOf0sOQd_hFd6zcYnNMaUlahBmgYS4OhRqs471NpoX0yg6XdLp1N8k38A7myEI_n2wZUBrZNgkbJPv-wUYdiJ6frmryZgzGiqcCUwsX2maikQOLF-yL0JtwoCwSWQiw-Xmff3gP1oEQMXz5t6xKgpH3bvSzhrpV2bRKEYBn2UA1j504QZ5Xvdi6g81UotBwnnZD50Tr54lM0VP7NHbdhbKHwxEaV5itfl0_XwdIKqy8d26h9RenWY495ETdQ</con:value></con:property></con:properties></con:testCase><con:testCase id="71c704e5-e662-4c4a-9a33-c5a19fda44c6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токен СУДИР" searchProperties="true"><con:settings/><con:testStep type="groovy" name="обновить base64" id="4597d088-99f8-42f7-99c8-b55287aa9895"><con:settings/><con:config><script>import java.util.Base64

def Encoder = Base64.getEncoder()

client_id = testRunner.testCase.testSuite.getPropertyValue("clientId")
sudirUrl = testRunner.testCase.testSuite.getPropertyValue("loginEndpoint")
client_secret = testRunner.testCase.testSuite.getPropertyValue("clientSecret")

auth = Encoder.encodeToString((client_id + ":" + client_secret).getBytes())
testRunner.testCase.testSuite.setPropertyValue("base64",auth)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientId", client_id)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("clientSecret", client_secret)</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить токен СУДИР" id="8acc2bb9-8cc9-4001-8365-de067f15581d"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#TestSuite#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#TestSuite#base64}"/>
  <con:entry key="refresh_token" value="${#TestSuite#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="обновить параметры для сервиса tokens" id="771b38fe-d3ce-4d2c-ad0e-d20263ba6636"><con:settings/><con:config><script>login= testRunner.testCase.testSuite.getPropertyValue("login")
password = testRunner.testCase.testSuite.getPropertyValue("password")
guid = testRunner.testCase.testSuite.getPropertyValue("guid")

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("login", login)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("password", password)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="e0836678-a32a-4004-9182-e58d106375a3"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)
log.info "EI-Token "+sudir_token.access_token</script></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="685c2889-3a65-4e1d-80a4-69f103be643f"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#TestSuite#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#TestSuite#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="35cc7ade-6f04-4c10-afe9-1f1f42c2eaa5"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)

log.info "X-Access-JWT  "+access_token.accessToken</script></con:config></con:testStep><con:properties/></con:testCase><con:properties><con:property><con:name>softwareStatement</con:name><con:value>eyJ0eXAiOiJKV1QiLCJibGl0ejpraW5kIjoiU09GVF9TVE0iLCJhbGciOiJSUzI1NiJ9.eyJncmFudF90eXBlcyI6WyJhdXRob3JpemF0aW9uX2NvZGUiLCJjbGllbnRfY3JlZGVudGlhbHMiLCJyZWZyZXNoX3Rva2VuIl0sInNjb3BlIjoiY29udGFjdHMgb3BlbmlkIHByb2ZpbGUiLCJqdGkiOiI5YjhmNWQ0Zi05NTNmLTQ4ZGItYjAwMS0wOTBhN2M0YjBhMGMiLCJzb2Z0d2FyZV9pZCI6ImVtaWFzLmluZm8iLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMSIsInJlc3BvbnNlX3R5cGVzIjpbImNvZGUiXSwiaWF0IjoxNjQwMDY5OTM1LCJpc3MiOiJodHRwczovL2xvZ2luLm1vcy5ydSIsInJlZGlyZWN0X3VyaXMiOlsiaHR0cHM6Ly9lbWlhcy5pbmZvL3N1ZGlyLW1vYmlsZSJdLCJhdWQiOlsiZW1pYXMuaW5mbyJdfQ.XtYX9jWS8s0Uxy2U6ksvYlpErQ5T7Xh1xqQRxc0QtIXTcs7rVVaNnipRZTjk7ZV6UlojrmyHtfp42R8ipfGzzaHT-WaNzBGiAz7clcePjG9CHx49r8i2Ssn_3avA3d2xqiuUYqRGqpw1ZWhOotIlKnonnjllt6CfpE7tXUmoaLIWmVDi9aRQoUnsS5mxME6fszGRYrVsIMVW1Ykqe1eK4SR51QCxeb-zZFIUan5MIL3nxQrnjSLpRb7SWKc0mDZmN7qA8DQHlRBbY6kivxwu-0XTYVgj8voFBE3z7cMmfUqlSBstJTE_FfTq_OfRgQvFcFYSZyD-uDfNkX_FgSYRqA</con:value></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login.mos.ru</con:value></con:property><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+OGUwMzRiNGYtNmY4YS00YzQ5LTllODUtMTk4ZmFhMWViM2JkOnppUkhzM2oxeTlXY2h5Zg==</con:value></con:property><con:property><con:name>sudirToken</con:name><con:value>-t8fk1yp3S-k6X9WR2kx1w1jaHCnyt4UCmX4xlhDoU44MGJkZGEyMC00NTE3LTRiY2UtOWQzMy0yYjU5MjUwYzQxY2M</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>DzgUi3-Rux7K9UZdDeiiB8zwZGVX_ad24KsKiWdD4OQC6jLQKIRq97nW-c0K8KLSCIc48eyaYPEmKCJ4EI3o_Q</con:value></con:property><con:property><con:name>guid</con:name><con:value>2149c2d2-e0b3-4fe9-a810-4435708242ce</con:value></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lk.emias.mos.ru</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTAyNDM5MDEsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJlYTI0NDllOC05YmU1LTQ5YzQtYTk5YS01ZTMxM2I1ZDNiNWIiLCJzaWQiOiIxZmU0YmZkZS0zOWY0LTQ3NzgtYTdhMy0zYmUxNjg1N2NkM2EiLCJwaG9uZSI6Ijc5MTU5Njc5MjMxIiwic3NvX2lkIjoiSWt3a3JZMERtTjlOcFRQd1lZMStpNklDUnFWaVhaYUZuamVqdHQxNlMzYi8zbUtrNjFIYS85ODduL0tzSEdrektCU3JNUDNJRGszbjZqNll6bXhkNFZYNG1zaEV4S0ZlR0U0TkRxcGFuNlpuU2tyY01YUmloV1h3MW40dko3bGcxT1l5N1pXb0dPU2hYQzMwMFp0MmQ4cXZrczRWNGZ5T1A1djdaM1NYLzhjRE56UGZpZUhRSS90a3IvekE1Tml2Qk4vUVdQUEFDNjB2NDB6Y3BUakhyQjE4SjEyem1IVWxQNXY0Uk9ZT0ZpUlZCNjl0ZUg1eGk1a3UzdEsvUFFMc0J1VDJpZDBhUEY1VElGZXZaMktnajZXWktzbndIenlmNzhSMElhcTlGWlcvNVVpMTVBY1V1MUpEelBHeEFMRXZrc2pSQjB3NUU0c0kyUHI1cnZSbnhnPT0iLCJlbWFpbCI6ImhhQGFwcGtvZGUucnUiLCJmaXJzdF9uYW1lIjoiXHUwNDQyXHUwNDM1XHUwNDQxXHUwNDQyMSIsInNlY29uZF9uYW1lIjoiXHUwNDQyLiIsIm1pZGRsZV9uYW1lIjoiXHUwNDQyXHUwNDM1XHUwNDQxXHUwNDQyXHUwNDQzXHUwNDNlXHUwNDMyXHUwNDM4XHUwNDQ3MSIsImJpcnRoX2RhdGUiOiIxOTkzLTA4LTA1IiwiYW1yIjpbXX0.l4veL6s1hs7GDuEApWqbFDz6aWdv4Hvlgz6h3NVpz8wAxe39hjVdCYKc1pgw6xRUS4YgLuc2kMjkM3z9yDwYsRc1UBT6oLnOH2q50cO4i_gH-mRy3Hfp23h5DGTsLm3f33a4IpWu3HaKWUhDaWnuIwy92VstjTXt0JY0XEayBeVYZ2gijhEx9YUssKtmO_3XNd3a1PbwWgNlrCjz20LA3Fm8jiOGHunZgepc29YuWf2mEKN3SPZuGDIVUSq3GOgs1d_f-Hz_T5QI9CEl0S1kGuFM2zGh-I1WgdR0cJjRv3vkygsnXXKIhKHLfpqwGd2UM6m_YLf3op4dXkjKEo1Vug</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiJhOTExMDA4MC0xNDNmLTQ1OGItOTkzZi1hNDU3ZGE2MDQzOWEiLCJzaWQiOiIxZmU0YmZkZS0zOWY0LTQ3NzgtYTdhMy0zYmUxNjg1N2NkM2EiLCJleHAiOjE3MTA4NDUxMDEsInN1YiI6ImVhMjQ0OWU4LTliZTUtNDljNC1hOTlhLTVlMzEzYjVkM2I1YiIsInNzb19pZCI6IlZCMHF4RHhWUDZ2SjhDb3JIQi94MlI1Yk9PUXdnRWVhSndFOWpBdFBPZ3JMV1lzekpPUzR2Z2dVVTNwOEJTY1B4NmdqWnVuQUtGVkFiY05NVGN0RVhXbUZRdWhvdFJ0Q0xOcXZtV0ZTckFRendFKzRva3E4Y2pRWE5LR1pXSjhsYXJmdUxuaWk0eDV6MzhZMDh4YlBUK0VSczFmU1UzWmdmMmZkdWtkNHpkNmVlbkdBV3JSNjF0ZktIVXNnd2F6MkFHeFozeU5EMmJmcHZpQ0lWSzlURTY0Nmdvd0JRY3ZpNDJtY0FqdDhudityUjZtUlNta2dTY3VDMXIvaXpCWnBGTE1wTm5rSTA4QmwyQ1E0YUYrQXJodm5ieTZqQzgwcGFVemw3azN0aGZmcG5jUHZyeEVwOXo2L2lZSklGMkVnVUFaVFlZNk9rVStKRGRReXJ1clo4dz09In0.NhvbUiBVAYaJ9RidL8wxJG95VQdSAk0mdxBkDigtzTkR8_Ax2hTBowww6oOjj0uOED49-16lsUwQl7bOZ30hpObMKUEmQfjzfQYUwrfPagzxr2XEkc7pi1Fgw-4JYUepOB9uzZeyUVYFFAEye29oTeH3JNxI-dGW1AvT9V0S1elYd9C5BCbGluis0dDqwVJ6e84rMSdP8We-jRGIRJGvnapuQscabkW3_osCZcTP8wRECoDgalE9g31elntkWq-awj-PmvuWOY5TKkhPT8d3gWGs7bXEKIWirt86yVAnE_tQpvaleQWjJJ_iEaQhxNrJ7h_kIE1Qurjg0F1UjCLMTQ</con:value></con:property><con:property><con:name>x-otp</con:name><con:value>19674</con:value></con:property><con:property><con:name>login</con:name><con:value>test_000-099-782@pflbmail.hopto.org</con:value></con:property><con:property><con:name>password</con:name><con:value>4aC2kwV2</con:value></con:property><con:property><con:name>clientId</con:name><con:value>dyn~emias.info~8e034b4f-6f8a-4c49-9e85-198faa1eb3bd</con:value></con:property><con:property><con:name>clientSecret</con:name><con:value>ziRHs3j1y9Wchyf</con:value></con:property></con:properties></con:testSuite><con:testSuite id="f4dc26ba-33bc-4a42-a526-35268b7976cf" name="Сохранить токены из глобалных свойств в свойства проекта"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="cce4d2cb-7a6b-41a8-b868-c0511c765f04" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Сохранить токены в свойства проекта" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Сохранить" id="20cbb8b0-6a37-4321-a598-d5d2421e4a8a"><con:settings/><con:config><script>def sudirToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "sudirToken" )
def accessToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "X-Access-JWT" )
def refreshToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "refreshToken" )
def refreshAccess =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "refresh-X-Access-JWT" )
def base64 =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "base64" )
def guid =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "guid" )
def clientId =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "clientId" )
def clientSecret =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "clientSecret" )
def login =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "login" )
def password =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "password" )

testRunner.testCase.testSuite.project.setPropertyValue("sudirToken", sudirToken)
testRunner.testCase.testSuite.project.setPropertyValue("X-Access-JWT", accessToken)
testRunner.testCase.testSuite.project.setPropertyValue("refreshToken", refreshToken)
testRunner.testCase.testSuite.project.setPropertyValue("refresh-X-Access-JWT", refreshAccess)
testRunner.testCase.testSuite.project.setPropertyValue("base64", base64)
testRunner.testCase.testSuite.project.setPropertyValue("guid", guid)
testRunner.testCase.testSuite.project.setPropertyValue("clientId", clientId)
testRunner.testCase.testSuite.project.setPropertyValue("clientSecret", clientSecret)
testRunner.testCase.testSuite.project.setPropertyValue("login", login)
testRunner.testCase.testSuite.project.setPropertyValue("password", password)</script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="7d6618d7-aeb2-4c50-845a-c8e06fad17ce" name="Сохранить токены из глобалных свойств в свойства проекта2" disabled="true"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="42ca9e73-8a96-407d-8bc7-ac6156a89047" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Сохранить токены в свойства проекта" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Сохранить" id="d11623d8-0cb1-4cd9-913b-e03d7c8666cb"><con:settings/><con:config><script>def sudirToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "sudirToken" )
def accessToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "X-Access-JWT" )
def refreshToken =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "refreshToken" )
def refreshAccess =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "refresh-X-Access-JWT" )
def base64 =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "base64" )
def guid =com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "guid" )

testRunner.testCase.testSuite.project.setPropertyValue("sudirToken", sudirToken)
testRunner.testCase.testSuite.project.setPropertyValue("X-Access-JWT", accessToken)
testRunner.testCase.testSuite.project.setPropertyValue("refreshToken", refreshToken)
testRunner.testCase.testSuite.project.setPropertyValue("refresh-X-Access-JWT", refreshAccess)
testRunner.testCase.testSuite.project.setPropertyValue("base64", base64)
testRunner.testCase.testSuite.project.setPropertyValue("guid", guid)</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="1b48d680-6a9b-48d5-b79c-b04fe66df59a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Обновить токены в свойствах проекта" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Обновить токен СУДИР" id="a81be1e5-26f2-4b00-97a6-5b43cae150ac"><con:settings/><con:config service="https://login-tech.mos.ru" methodName="Обновить токен" resourcePath="/sps/oauth/te" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить токен СУДИР" id="793942aa-3f63-4200-ad97-16a44c94594a" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#loginEndpoint}</con:endpoint><con:request/><con:originalUri>https://login-tech.mos.ru/sps/oauth/te</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="52acf20e-2ec9-4679-a8e0-1ffccfee1891" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="Authorization" value="Basic ${#Project#base64}"/>
  <con:entry key="refresh_token" value="${#Project#refreshToken}"/>
  <con:entry key="grant_type" value="refresh_token"/>
</con:parameters><con:parameterOrder><con:entry>code</con:entry><con:entry>redirect_uri</con:entry><con:entry>grant_type</con:entry><con:entry>refresh_token</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Обновить X-Access-JWT" id="86618af3-6fcf-4f86-bf65-ed694340d9cb"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/2/mobile/auth/refresh" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Обновить X-Access-JWT" id="95b944ab-7387-4be0-98f1-1d2a5f1f7979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lk-prp.mosmedzdrav.ru/api/2/mobile/auth/refresh</con:originalUri><con:assertion type="Simple Contains" id="2e02844c-747c-48d9-8a3a-b8e090b71e45" name="Contains"><con:configuration><token>accessToken</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="refreshToken" value="${#Project#refresh-X-Access-JWT}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>refreshToken</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти СУДИР и refresh" id="6373277a-449c-4108-a57d-a13e3a98e9f5"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить токен СУДИР#Response}')
sudir_token = new JsonSlurper().parseText(ResponseJson)


testRunner.testCase.testSuite.project.setPropertyValue("sudirToken", sudir_token.access_token)
testRunner.testCase.testSuite.project.setPropertyValue("refreshToken", sudir_token.refresh_token)

com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("sudirToken", sudir_token.access_token)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refreshToken", sudir_token.refresh_token)</script></con:config></con:testStep><con:testStep type="groovy" name="Обновить в проперти токены ЛК" id="40be001f-f9b2-4a50-89c1-a6b911bc2407"><con:settings/><con:config><script>import groovy.json.JsonSlurper

ResponseJson = context.expand('${Обновить X-Access-JWT#Response}')
access_token = new JsonSlurper().parseText(ResponseJson)

testRunner.testCase.testSuite.project.setPropertyValue("X-Access-JWT", access_token.accessToken)
testRunner.testCase.testSuite.project.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("X-Access-JWT", access_token.accessToken)
com.eviware.soapui.SoapUI.globalProperties.setPropertyValue("refresh-X-Access-JWT", access_token.refreshToken)</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="ac19b110-0cb6-4fa6-8058-153103f81a53" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Получить пациентов к ЭМК которых есть доступ" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Посмотреть привязанных пользователей" id="f7063ace-bf7c-497e-8c4d-e98b0e066136"><con:settings/><con:config service="https://lkservice.test.emias.mos.ru" resourcePath="/api/internal/3/emc-permissions" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Посмотреть привязанных пользователей" id="41600ef4-dbb4-46ce-81f3-fbc8d75231db" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#lkEndpoint}</con:endpoint><con:request/><con:originalUri>https://lkservice.test.emias.mos.ru/api/internal/3/emc-permissions</con:originalUri><con:assertion type="Simple Contains" id="5636a380-bc1a-4484-8e5c-63221a606362" name="Contains"><con:configuration><token>policyNum</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="ssoId" value="${#Project#guid}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>ssoId</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>base64</con:name><con:value>ZHlufmVtaWFzLmluZm9+MDFjZWE3ZTUtM2VhYS00Zjc0LTg1YWMtMmJlMWZiMDk4YWFmOkRKRXRsVmVjRmwzdGc1Sw==</con:value></con:property><con:property><con:name>directorySudirProject</con:name><con:value>/ЕМИАС-ИНФО-работа-с-токенами-и-привязкой-пациентов-soapui-project.xml</con:value></con:property><con:property><con:name>lkDbConnection</con:name><con:value/></con:property><con:property><con:name>lkDBDriver</con:name><con:value/></con:property><con:property><con:name>lkDbPassword</con:name><con:value/></con:property><con:property><con:name>lkEndpoint</con:name><con:value>https://lkservice.test.emias.ru</con:value></con:property><con:property><con:name>lkFullDbConnection</con:name><con:value/></con:property><con:property><con:name>loginEndpoint</con:name><con:value>https://login-tech.mos.ru</con:value></con:property><con:property><con:name>sudirRefresh</con:name><con:value/></con:property><con:property><con:name>sudirRefreshToken</con:name><con:value>A1YPer0rHQXQarFPl06b9KvZtii2Oh7K9RMliG1nbQ1h3BMPnlaz7i7wQw1JC7CF6V8xvM0rsU6qoeqP-n-nBw</con:value></con:property><con:property><con:name>sudirToken</con:name><con:value>6fsK7JxwqDEgvYaFL_KlYRqVZyG8leCmTobbx5y-0l8wZjY2MTY1OS05NDQ1LTQxZGMtYTBlYi04MmUwNmY3YmNlODI</con:value></con:property><con:property><con:name>sudirToken1</con:name><con:value>1</con:value></con:property><con:property><con:name>suppDbConnection</con:name><con:value>@//10.2.172.242:1521/emiasdb</con:value></con:property><con:property><con:name>suppDBDriver</con:name><con:value>oracle.jdbc.driver.OracleDriver</con:value></con:property><con:property><con:name>suppDbLogin</con:name><con:value>EMIAS_CLUSTER</con:value></con:property><con:property><con:name>suppDbPassword</con:name><con:value>EMIAS_CLUSTER</con:value></con:property><con:property><con:name>suppFullDbConnection</con:name><con:value> jdbc:oracle:thin:EMIAS_CLUSTER/EMIAS_CLUSTER@//10.2.172.242:1521/emiasdb</con:value></con:property><con:property><con:name>X-Acces-JWT</con:name><con:value>1</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE2ODgzOTQ1NDIsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJlYTI0NDllOC05YmU1LTQ5YzQtYTk5YS01ZTMxM2I1ZDNiNWIiLCJzaWQiOiJjYjczYzk0OS0xZDY0LTQ2YjYtOGQ0Yi0wNGM3NDkzODdjNDYiLCJwaG9uZSI6Ijc5MTU5Njc5MjMxIiwic3NvX2lkIjoiWGRuMFNhdGUwOEllZjJ5bHdJRXdNMWl2OUgwd1J6TzNFK3R3MS9vVEJNREFlREN4Y2dVQm5VVGRhQ3N2cTRkZ0lrSm1jeC9XSENTbmwrbGI4Nk54VmFtSFBZQmZXNGZQNS94RndWcE5DTGxiUlV4TUdneCswcURaZEJXOHRiVnNtVHVPdEREek5obE41UEZNUjVpZC9QSSs2VkdiMmZ2TlJFbmJzYkJjSmIzK0FlZWxxMXZkQ1ZKTldkMERMcGdmZ2tVcHlrdkVFUWZiTjI0SGYxc1kvRGZWd21pc2RFVVFzSmFPT0VpZGVEcEZZVGRldEU2MTNtMlJPUUJCb0d1cEhIT3VpYVRmRndqdENIT0VhdzdtU0tsV0lWV0dpZ01FZXZGVytnR2lUY0dHeGhkRTNobEptZ3NzeDZMaVNNeTYwcjgyZCtNekFJZlp1b2UxU2t6RnRnPT0iLCJlbWFpbCI6ImhhQGFwcGtvZGUucnUiLCJmaXJzdF9uYW1lIjoiXHUwNDQyXHUwNDM1XHUwNDQxXHUwNDQyMSIsInNlY29uZF9uYW1lIjoiXHUwNDQyXHUwNDM1XHUwNDQxXHUwNDQyIiwibWlkZGxlX25hbWUiOiJcdTA0NDJcdTA0MzVcdTA0NDFcdTA0NDJcdTA0NDNcdTA0M2VcdTA0MzJcdTA0MzhcdTA0NDcxIiwiYmlydGhfZGF0ZSI6IjE5OTMtMDgtMDUifQ.RFHjcfddgn-joOca-aoPVKvoEWeYqtMGiUH0dmz9viyqKyv8e-lBo5CWoj94vZNg91HsK-RHu8V6ClO9muM-IE0oKKtC8SnKMgdeJL7tdrjYdE-V_TFEVXL-mX0nffOzPt8hj4fQtS0t8htit3HTHzdY_jb3ynxQB84lRobKy7rDiHxD3PsX0hVFPBPiSNHJ0L8gd-y_0wxgrGCbE-199NRM0Ad31pX3qAVXxODU0f08JiQvsKKNjediaFrskohtayYbGC4v1tG_lJyQXLuiZVA1ueYmmWUQXegYHC7s3v6Sad5m_HYGUINEqGnLZ6ePNY2PjU0EWhPnZudNwlK1_g</con:value></con:property><con:property><con:name>sudirToken</con:name><con:value>Ep5gV80wix6rieU7dAuMIpTIvQPyPTi3UQhFYwISvFA</con:value></con:property><con:property><con:name>X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJleHAiOjE3MTAxNjU5NTYsImF1ZCI6IlBBVElFTlQiLCJzdWIiOiJjMzdlYWU5ZC1hOTJhLTRmOTMtODlhYy05MjI4NjU3MjM2YWEiLCJzaWQiOiIxYTMzMmE3Mi02YjFiLTQ0MzItOTI2YS04OTc3NmJkZTVjZGEiLCJwaG9uZSI6Ijc5MjY1MjA5MjA3Iiwic3NvX2lkIjoiWURzYm1Uay9nSHBqUGR1K09KTlUvSTZta0orTXhmY2d5K3FzNnloUGQ1cWdWR2ttdE5KK3VndmNydDFLRGhxWmYwb2MrdFFQb0xMZFY4OFFJTEJBRUV5QU9iMktWQXpUTXhTMlVMK21uSlZFc1ZZdlRmeWxxMUczbEpIQmYwZ25kVkF4NUZzZWZJeUtxdUhIZ3lRblkxQ3drZ29yNjFkY3NCTGZUVXFwa0RwR1dJVWp5QUk4a2VLaStLbUhHS3d2NHlHTnJOVXZhZXFUQVdlQnUyYWhiN1Y2K0VZSWw4TUhKait0MHZpSFlVcUlraGtOU0VWUnJCY3Y2djdpaVZidlVnVFFEb3d5aU9iWUwySG9FWXZyaUdkN3kxL3RCNGN1ZEczQXFvaWxwNGlCSTJFYnUwY1pnN0VTWTYwQkpTd3RBYXNZNGtWcURzcy84NjhtR0lFSktnPT0iLCJlbWFpbCI6IiIsImZpcnN0X25hbWUiOiJcdTA0MmZcdTA0M2RcdTA0MzAiLCJzZWNvbmRfbmFtZSI6Ilx1MDQxMi4iLCJtaWRkbGVfbmFtZSI6Ilx1MDQxY1x1MDQzOFx1MDQ0NVx1MDQzMFx1MDQzOVx1MDQzYlx1MDQzZVx1MDQzMlx1MDQzZFx1MDQzMCIsImJpcnRoX2RhdGUiOiIxOTgyLTA0LTA5IiwiYW1yIjpbXX0.Gp2U-E48TU_K9w2SOrUU7FGju1flhKwxr4X7OFdJfYzWqNDHlV1HsfiqiXH_L5kMHmBfH8Z6uo12qdFVKM98A6Cz0PsBmDTFEPSyhtssenqeQ9Jf8uyxZhgVw74BqpmqR2KAZ3aa6kWGg8z_iE7qyKDiAs_2ipt8t5otwdCdlysrrkEALKki0_03S1T90pOF8dnKTRZ61SDVkn2NHsNvKD77ekpioIx6VF_yZHqZd81L6Rn2jQ21guyVEAxFt1gKHK0oQLCzsZZ-VnTCCjzIs0sEV6gKcVg3hM9ePx5nnIYeSOt9I-NBI3-RVf-Z5YgfMEF4e7Glzbl27emHTkXIGmjD8g5fyN5F0rk6HUvI3xvhNpeGNDfmNnJo2QWfUFA2RtUSJTDE4aK9mFLCI5Ndz1CLisA-p42ZA34mqrIQxF29xFBLBPIGYJjF4-XC6m8r8x6lnVTWWtH7Dm4HPydm6Zz5NyrXicmGPMKpQpXfrdFO9XsA7aMfCXDabBQshglElDHdaBxpan54AUwZIkLfi5kYq2JWS7FR9B5f5uNLXBDzLtPS9PovP1Q8Tl-bUS5xZcmMvIU6bupPDdnMtax5-jYwp7ib-nMLQ7Nwix2ndqu_kwg3kNzacjiylGzMVbNd5R6MrubmkbQ0gRtiFy5pkLO555fZbEaGlursf3VuqHU</con:value></con:property><con:property><con:name>suppDbConnection</con:name><con:value>@//10.2.172.242:1521/emiasdb</con:value></con:property><con:property><con:name>suppDbLogin</con:name><con:value>EMIAS_CLUSTER</con:value></con:property><con:property><con:name>suppDbPassword</con:name><con:value>EMIAS_CLUSTER</con:value></con:property><con:property><con:name>suppFullDbConnection</con:name><con:value> jdbc:oracle:thin:EMIAS_CLUSTER/EMIAS_CLUSTER@//10.2.172.242:1521/emiasdb</con:value></con:property><con:property><con:name>suppDBDriver</con:name><con:value>oracle.jdbc.driver.OracleDriver</con:value></con:property><con:property><con:name>refreshToken</con:name><con:value>xy6WPw6zTLLOEl6prKUPdY1cOFTla0wQ5qO4Bl2Fx6wU9IKvleFyfrAZhGnl55mlQfFiyspXMz-X8k9U3KN-zg</con:value></con:property><con:property><con:name>refresh-X-Access-JWT</con:name><con:value>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ1c2VyX2F1dGgiLCJyaWQiOiJhNWJmZWNlZS1kMjYwLTQxMDYtYmY0My1jOWZmNGFmNWMyOGUiLCJzaWQiOiIxYTMzMmE3Mi02YjFiLTQ0MzItOTI2YS04OTc3NmJkZTVjZGEiLCJleHAiOjE3MTA3NjcxNTYsInN1YiI6ImMzN2VhZTlkLWE5MmEtNGY5My04OWFjLTkyMjg2NTcyMzZhYSIsInNzb19pZCI6Ilp4dkVIdzE5NWlGZnU1bTVqeW1jZmZpbWlJa3dOMjlBRTM0Ky9qZkNsQWkzTjVaSnFRQ2pSNnZMbkNOcjhSbGRxU296cnljSnc3L2lxdG9zeGxVaXEwQVgwamEyNHprS3pLc1ZxRVdTVXZNc3VaRUpJVlphWnd4MkFHWSt2Y3hKekFiYi90WTdyY3JNSjhuVFREUTVuaVREelJpQ3VKOU5xSllRb0ZKNWJqejRBczZ0bDBQNjV3LzdTWUN1bXdyT0FZSmFvVFl4NUFzLzE5dnZabVVWdEptM3JTaGxrdjFsMlNmRFFkdnZqQjBqRko3aHIvUmFzKzNHZXpqc0k2ajdzdm8vMHcxNWRCMFpBZjVvdjZxVFdKUEJCdGNGMG5wVFNOVmNhWlZra3JHOUR1S3ArM0F3b1JxL1lHajB3WWEwWEVpYk5KaXZ2QTVBMUxObUlsV1B0UT09In0.JLhUsDU0ViA3gznoxhJ0YMteKKGQcAMXbaYiZrh0zcl-YZZF5Ff5QABvyG1hnUWhDYfZtevMV6EBX-v0qskpjzXSJsPvq0p-2L13xwt-956mQG3Czc74sBnnAZDX4e1iG08wqpLOincXdobCfBchHL_cVFl8ybfgCv3wcW6HFARS0aVkxMyvoPleLbOqo9mKe4GHN31WjMePD74ZLtYiaJeaDTHdXHAbOZ7qVOox2CsKs5vdcuhizXCbdJXYTQgU9L1sYe7em1k6nd3dPiaWS4XHjmqSuNo8YLmAd_3fN8Hf8sD6cJtzrI0egWIJc7RTxXv1nchZWRyVHWKgTM-fr7yOygh3eH-9PeDAwYpDsO2s6vsj2U-YbMA8OKfvifxO3QPeGmYegNauZKQe_9eZ_toz793q5IDrxSH0gj82ptMzTWs1QtJ2rGDPZrV0INvJhqSNlvCVxMccTtZHH1q-W7aDTXsTQ1PKdQnkrGze2ZKXiXCK6R-XpLv8Vs2nmQJ9aVD15wW90L4PoA-8Gza-1irebvQyX1fzZ6pxAit2liq4NsgN72vEzJx-8qOm3aJS5OvUIOANc4kI-soJfbyil_N6-C9VHKz46isYG9MV5mIbuNChIm93cwyFY7LofoXaU-PLm8wqqWW0gTRCxISoZmJtHIcgzjCTtqL78CfRXZg</con:value></con:property><con:property><con:name>guid</con:name><con:value>2149c2d2-e0b3-4fe9-a810-4435708242ce</con:value></con:property><con:property><con:name>clientId</con:name><con:value>dyn~emias.info~c3114c68-981c-46d7-a43e-ed55bc03d71d</con:value></con:property><con:property><con:name>clientSecret</con:name><con:value>rqOpXzth17a0qTR</con:value></con:property><con:property><con:name>login</con:name><con:value>test_000-099-782@pflbmail.hopto.org</con:value></con:property><con:property><con:name>password</con:name><con:value>4aC2kwV2</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>