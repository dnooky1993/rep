<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="7b0abd85-933d-467c-b742-367ac1ef9b38" activeEnvironment="Default" name="ЕМИАС.ИНФО Сервис &quot;Экспресс-тесты на COVID-19&quot;" resourceRoot="" soapui-version="5.7.0" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="89178d8f-47b0-4af5-9378-d83aadc06f0c" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://10.2.180.42" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://10.2.180.42</con:endpoint></con:endpoints><con:resource name="Login" path="/api/auth/login" id="20e3ec13-ab0d-4dfd-97d8-6ee3a5768e46"><con:settings/><con:parameters/><con:method name="Login 1" id="2cf6fc13-e95b-4ee0-9851-360f180a1af4" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>405</con:status><con:params/><con:element xmlns:log="http://10.2.180.42/api/auth/login">log:Fault</con:element></con:representation><con:request name="Request 1" id="963dfc39-ba10-467e-a731-350ca9b7cfd7" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://10.2.180.42</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="{id}" path="/api/mobileApp/getFormData/{id}" id="d4a856e2-f8b3-4e7d-a21e-72ed06e4556d"><con:settings/><con:parameters><con:parameter><con:name>id</con:name><con:value>id</con:value><con:style>TEMPLATE</con:style><con:default>id</con:default></con:parameter></con:parameters><con:method name="Method 1" id="c07f7769-958d-4443-8687-0be918421aac" method="GET"><con:settings/><con:parameters/><con:request name="Request 1" id="7a97f34b-4c78-4c12-aad8-5fd17977295a" mediaType="application/json"><con:settings/><con:endpoint>http://10.2.180.42</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="e46d1c2b-905f-4c18-bc95-358f5ae8c156" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://emiasinfo1.emias.solit-clouds.ru" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache/><con:endpoints><con:endpoint>http://emiasinfo1.emias.solit-clouds.ru</con:endpoint></con:endpoints><con:resource name="Save" path="/api/v2/covidTest/save" id="dad5e138-c952-4f0b-b089-6a615cd96a13"><con:settings/><con:parameters/><con:method name="Save 1" id="1cee5c82-a9f2-4f49-ae2f-a05f4070f485" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="92800111-3244-4a8d-8c2e-f749249326d2" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://emiasinfo1.emias.solit-clouds.ru</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:testSuite id="993f7be8-aeb3-4c52-a1a5-70c147c7d45f" name="postCovidTestSave"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="0171175c-de55-4729-bcb7-76c727a0775d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Переданы все необязательные параметры (по паспорту)" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="5029fbe5-2a50-4d69-9d3d-b05c59ed322c"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, OMS_REGION_ASSURANCE_SERIES, OMS_REGION_ASSURANCE_NUMBER, OMS_NEW_ASSURANCE_NUMBER, OMS_TEMP_ASSURANCE_NUMBER, 
		SNILS, LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="0ff59429-79e6-48c3-8ddf-80b75179d8e8"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
OMS_ASSURANCE_SERIES = row.OMS_ASSURANCE_SERIES !="" ? row.OMS_ASSURANCE_SERIES:null
OMS_ASSURANCE_NUMBER = row.OMS_ASSURANCE_NUMBER !="" ? row.OMS_ASSURANCE_NUMBER: null
OMS_REGION_ASSURANCE_SERIES = row.OMS_REGION_ASSURANCE_SERIES !="" ? row.OMS_REGION_ASSURANCE_SERIES:null
OMS_REGION_ASSURANCE_NUMBER = row.OMS_REGION_ASSURANCE_NUMBER !="" ? row.OMS_REGION_ASSURANCE_NUMBER:null
OMS_NEW_ASSURANCE_NUMBER = row.OMS_NEW_ASSURANCE_NUMBER !="" ? row.OMS_NEW_ASSURANCE_NUMBER:null
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]

log.info OMS_NEW_ASSURANCE_NUMBER
log.info OMS_ASSURANCE_SERIES
log.info OMS_ASSURANCE_NUMBER
log.info OMS_REGION_ASSURANCE_SERIES
log.info OMS_REGION_ASSURANCE_NUMBER
log.info BIRTH_DATE

testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

if (OMS_NEW_ASSURANCE_NUMBER){
	oms = OMS_NEW_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_ASSURANCE_SERIES &amp;&amp; OMS_ASSURANCE_NUMBER){
	oms = OMS_ASSURANCE_SERIES.toString() + OMS_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_REGION_ASSURANCE_SERIES &amp;&amp; OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_SERIES.toString() + OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}
if (OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "snils",row.SNILS.toString())
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "middleName",row.SECOND_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "fiasId",UUID.randomUUID().toString())
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", (Math.abs(new Random().nextInt() % 9000) + 1000).toString())
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())
testRunner.testCase.setPropertyValue( "flat", (Math.abs(new Random().nextInt() % 100) + 1).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="2d97eae6-852a-4525-963a-3099deef7020"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "policyNumber": "${#TestCase#omsNumber}",
        "snils": "${#TestCase#snils}",
        "document": {
            "documentTypeId": 1,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "middleName": "${#TestCase#middleName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "flat": "${#TestCase#flat}",
            "text": "${#TestCase#addressText}",
            "fiasId": "${#TestCase#fiasId}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="2a54ffb6-6211-4f47-aee5-775668b98738"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="f8b3cc3d-85f4-4000-a061-fbf4cfb4bd98"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="ac5ce94f-9fa3-4b91-809a-cf4f929ede02"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="37f9fd59-7987-4ae6-80c5-b19a087d880f"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = ${#TestCase#middleName}"><con:configuration><path>$.patient.patron_name</path><content>${#TestCase#middleName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = ${#TestCase#flat}"><con:configuration><path>$.patient.fact_address.flat</path><content>${#TestCase#flat}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = ${#TestCase#omsNumber}"><con:configuration><path>$.patient.polis_oms</path><content>${#TestCase#omsNumber}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = ${#TestCase#snils}"><con:configuration><path>$.patient.snils</path><content>${#TestCase#snils}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = ${#TestCase#series}"><con:configuration><path>$.patient.document.series</path><content>${#TestCase#series}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = ${#TestCase#issuedBy}"><con:configuration><path>$.patient.document.issued_by</path><content>${#TestCase#issuedBy}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="641567ce-7f80-4450-b239-806645d0d82e" name="Значение document_type_id = 1"><con:configuration><path>$.patient.document.document_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>snils</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>middleName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>fiasId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>flat</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="5630cfa6-51dc-47c1-b608-3d446cdc8c9e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по СНИЛС без необязательных параметров" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="f581b331-42e1-434a-9018-f4d514d73f82"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT 
		SNILS, LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="9f0d65da-cc98-44b8-89c1-2310afc9792a"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "snils",row.SNILS.toString())
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="f3ddafec-2679-4426-974f-1558ac2d776a"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "snils": "${#TestCase#snils}",
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="66b4f25f-2406-474b-b559-8aaac81f8909"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="9f876613-d966-49d3-9cb6-3ad84a6f67a3"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="99e23293-d431-4256-891c-7c50d1de1169"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="0727e77a-540c-4820-af32-0d01b72aab7b"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="9d24a300-7d0a-424f-9fbb-ae00db4bee1c" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="e6b5f32d-fb59-4ac8-a794-d0fa3e783820" name="Значение is_self_direction = true"><con:configuration><path>$.is_self_direction</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3216d641-a4d6-427c-9c2f-3e22f301eebd" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = ${#TestCase#snils}"><con:configuration><path>$.patient.snils</path><content>${#TestCase#snils}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = null"><con:configuration><path>$.patient.document.series</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = null"><con:configuration><path>$.patient.document.num</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = null"><con:configuration><path>$.patient.document.issue_date</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = null"><con:configuration><path>$.patient.document.issued_by</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>snils</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>middleName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="554c2dcf-6bd3-4c37-b0b6-9e760a9bdca6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по ОМС без необязательных параметров" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="4de6b89a-6b0a-4aa0-be08-f406534409fb"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, OMS_REGION_ASSURANCE_SERIES, OMS_REGION_ASSURANCE_NUMBER, OMS_NEW_ASSURANCE_NUMBER, OMS_TEMP_ASSURANCE_NUMBER, 
		SNILS, LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="54254264-5cfb-4140-ac6d-bc2d595b7bff"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
OMS_ASSURANCE_SERIES = row.OMS_ASSURANCE_SERIES !="" ? row.OMS_ASSURANCE_SERIES:null
OMS_ASSURANCE_NUMBER = row.OMS_ASSURANCE_NUMBER !="" ? row.OMS_ASSURANCE_NUMBER: null
OMS_REGION_ASSURANCE_SERIES = row.OMS_REGION_ASSURANCE_SERIES !="" ? row.OMS_REGION_ASSURANCE_SERIES:null
OMS_REGION_ASSURANCE_NUMBER = row.OMS_REGION_ASSURANCE_NUMBER !="" ? row.OMS_REGION_ASSURANCE_NUMBER:null
OMS_NEW_ASSURANCE_NUMBER = row.OMS_NEW_ASSURANCE_NUMBER !="" ? row.OMS_NEW_ASSURANCE_NUMBER:null
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]

log.info OMS_NEW_ASSURANCE_NUMBER
log.info OMS_ASSURANCE_SERIES
log.info OMS_ASSURANCE_NUMBER
log.info OMS_REGION_ASSURANCE_SERIES
log.info OMS_REGION_ASSURANCE_NUMBER
log.info BIRTH_DATE

testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

if (OMS_NEW_ASSURANCE_NUMBER){
	oms = OMS_NEW_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_ASSURANCE_SERIES &amp;&amp; OMS_ASSURANCE_NUMBER){
	oms = OMS_ASSURANCE_SERIES.toString() + OMS_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_REGION_ASSURANCE_SERIES &amp;&amp; OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_SERIES.toString() + OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}
if (OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="b48a2d01-dac9-44c9-acae-c0dd937b6379"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "policyNumber": "${#TestCase#omsNumber}",
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="df1486a1-bf3f-428a-9b53-3d32d9934443"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="cf141c21-614f-44a9-9988-15d8d689cece"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="a2ea37ce-2010-41e6-9218-d2e752d92190"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="b6dba9fa-d14a-4386-8af4-6e2e018942cf"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = ${#TestCase#flat}"><con:configuration><path>$.patient.fact_address.flat</path><content>${#TestCase#flat}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = ${#TestCase#omsNumber}"><con:configuration><path>$.patient.polis_oms</path><content>${#TestCase#omsNumber}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = null"><con:configuration><path>$.patient.document.series</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = null"><con:configuration><path>$.patient.document.num</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = null"><con:configuration><path>$.patient.document.issue_date</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = null"><con:configuration><path>$.patient.document.issued_by</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="21a053d8-ef43-4fb9-beed-b6c3a7de1a31" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по ВНЖ с обязательными параметрами document" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="0eca34f9-0a24-44cd-9112-c5b8ece1ba5d"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="697fe162-2b17-4ca6-b463-35dcf7b49096"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", (Math.abs(new Random().nextInt() % 9000) + 1000).toString())
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="ce5c6e19-a716-4516-9a5f-68930b6f8108"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 7,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}123",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="8545d9ee-8ea3-4802-be9a-e73d6fc979d6"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="0e90aab4-1f7f-4f92-8d9b-cf75eb394a9e"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="41da7d46-be80-48cf-aa16-b8945d539784"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="e99b1688-0cf8-4af2-adc7-ded012cc4168"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = ${#TestCase#series}"><con:configuration><path>$.patient.document.series</path><content>${#TestCase#series}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}123"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}123</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = ${#TestCase#issuedBy}"><con:configuration><path>$.patient.document.issued_by</path><content>${#TestCase#issuedBy}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8a6bda27-4ac4-457c-85c2-d476b74c088d" name="Значение document_type_id = 7"><con:configuration><path>$.patient.document.document_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="9ac111f2-d2e1-41ae-a434-c899655d33d0" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по ВНЖ без необязательных параметров" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="f097f088-c10f-4be3-92b6-3465c684220d"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="a828eb67-8e84-4f3a-8f91-047c94a48f51"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="8234c950-4718-413a-9b5a-993f9a57cd3e"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 7,
            "num": "${#TestCase#num}123",
            "issueDate": "${#TestCase#issueDate}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="1e90209e-0299-4534-88d5-1362d2602d25"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="3773b736-4af1-42ac-8694-3d19afd30d86"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="c367dd45-95d5-4be7-9bad-7084d3dd885a"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="09b83942-633f-40ad-b5e2-ca003d7a6cf7"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = &quot;&quot;"><con:configuration><path>$.patient.document.series</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}123"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}123</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = null"><con:configuration><path>$.patient.document.issued_by</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="eb4c1a69-c2fa-4d8a-b9e5-7f4a8f3a6f2a" name="Значение document_type_id = 7"><con:configuration><path>$.patient.document.document_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="f7c44252-5d0e-4219-a38a-e9ffb59f3090" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по свидетельству о рождении. Нижняя граница серии документа" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="4ca1fc99-18dc-414e-bee8-7b4ca87b47f8"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="cf079de0-8b03-4aad-9cb3-43543ee8cf0f"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", RandomStringUtils.random(1, (('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="8698b795-d5c1-4602-ab70-0f83515e827c"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 9,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="495d0b59-adce-41e7-876a-025612268c11"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="31b47ae3-de8e-470a-b994-859d7e297e8f"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="c4c6d7ca-121b-4a38-8557-c28420791bd5"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="e5ec00e5-8119-4b7b-9b0f-014a046e4a1b"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = ${#TestCase#series}"><con:configuration><path>$.patient.document.series</path><content>${#TestCase#series}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = ${#TestCase#issuedBy}"><con:configuration><path>$.patient.document.issued_by</path><content>${#TestCase#issuedBy}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="92369743-d967-485b-9862-6d048b18bdaa" name="Значение document_type_id = 9"><con:configuration><path>$.patient.document.document_type_id</path><content>9</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3a6b1182-5aec-4bd5-a105-cfb9e81f5889"><con:configuration/></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="46c50176-6c1f-4099-b147-cf2754e61953" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по свидетельству о рождении. Верхняя граница серии документа" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="453008f1-a8a4-4fa9-ae66-1eed8ad6a53b"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="89d27796-5531-4379-9e06-321936a62a37"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", "IXV-"+RandomStringUtils.random(21, (('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="7a74d274-9047-47aa-ad96-ee1f6551c7c5"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 9,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="27acfb01-e747-4cf6-bf67-bc040adaffe8"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="9d3a779f-2306-4164-a7e3-d6aeed7bed7b"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="172f202a-fe63-4870-b8ee-006ffd84841e"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="cfb612df-f1b0-440d-9f72-f0d699a9ba8a"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = ${#TestCase#series}"><con:configuration><path>$.patient.document.series</path><content>${#TestCase#series}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = ${#TestCase#issuedBy}"><con:configuration><path>$.patient.document.issued_by</path><content>${#TestCase#issuedBy}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="92369743-d967-485b-9862-6d048b18bdaa" name="Значение document_type_id = 9"><con:configuration><path>$.patient.document.document_type_id</path><content>9</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="cf921e84-1384-4d3f-abf2-36c3a6125b2a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по паспорту иностр. гр. с необязательными полями document" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="0bc4f73c-8202-4166-bfea-14a312c91db1"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="a0080130-0c4f-4afa-9f2f-f2ad93600170"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", RandomStringUtils.random(1, (('A'..'Z')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "num", RandomStringUtils.random(1, (('A'..'Z')+('А'..'Б')+('0'..'9')).join().toCharArray()))</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="d67e4bb7-ee78-4f12-b87c-8ffac3caec70"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 10,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="2906ea7a-061a-4015-96f8-5c23806c1eb2"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="38812eaf-067e-4d7c-8d0b-179e7d695ad5"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="225e81e5-e03e-40fb-88d7-b853c0262290"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="9e0999da-aae3-46a4-bccd-f6732d9d4b66"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = ${#TestCase#series}"><con:configuration><path>$.patient.document.series</path><content>${#TestCase#series}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = ${#TestCase#issuedBy}"><con:configuration><path>$.patient.document.issued_by</path><content>${#TestCase#issuedBy}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="92369743-d967-485b-9862-6d048b18bdaa" name="Значение document_type_id = 10"><con:configuration><path>$.patient.document.document_type_id</path><content>10</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="a7d01fe5-e172-4c41-a083-929a080a05ac" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ОС. Заявка по паспорту иностр. гр. без необязательных параметров document" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="f6803bf4-e990-4aa3-9cac-9f60a7e3af2e"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT
		LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="1947f0db-e3fe-403e-ba8e-72735d4151cf"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]
testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString()+RandomStringUtils.random(50-row.FIRST_NAME.toString().size(), (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString()+RandomStringUtils.random(50-row.LAST_NAME.toString().size(), (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
address=row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString()
testRunner.testCase.setPropertyValue( "addressText",address+RandomStringUtils.random(1024-address.size(), (('A'..'Z')+('А'..'Б')+('0'..'9')).join().toCharArray()) )
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "num", RandomStringUtils.random(100, (('A'..'Z')+('А'..'Б')+('0'..'9')).join().toCharArray()))</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="0860f492-a4c5-4157-9786-65f25c74d5bd"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "document": {
            "documentTypeId": 10,
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "text": "${#TestCase#addressText}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="2955e709-c082-4a5e-bac0-a31b7774d8ab" name="Значение endDate = Текущая дата + 3 дня"><con:configuration><path>$.payload.endDate</path><content>${=import java.time.LocalDate; LocalDate.now().plusDays(3)}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4cf112dd-e0d4-4de1-877c-7023e0779a5e" name="Значение title = &quot;Заявка на экспресс-тест COVID-19 оформлена&quot;"><con:configuration><path>$.payload.successDisclaimer.title</path><content>Заявка на экспресс-тест COVID-19 оформлена</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="4bac9e44-9d45-4cf9-9d54-7e3626e110ae" name="Значение ontent.text = &quot;В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].text</path><content>В течение 2 дней вы можете прийти в ТЦ ГУМ по адресу {{address_covid_test}} и пройти тестирование.</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="7d4b5d14-b374-4f13-9e4b-f327291f46bc" name="Значение type = &quot;inn-app-link&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.type</path><content>in-app-link</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5d376aef-1191-483d-ade6-d3ddbd4d42df" name="Значение value = &quot;Красная площадь, дом 3&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.value</path><content>Красная площадь, дом 3</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="c8685f44-0288-48cc-bc9e-06f55415d892" name="Значение url = &quot;https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41&quot;"><con:configuration><path>$.payload.successDisclaimer.content[0].variableDict.address_covid_test.url</path><content>https://yandex.ru/maps/213/moscow/?ll=37.623391%2C55.754302&amp;mode=poi&amp;poi%5Bpoint%5D=37.621182%2C55.754572&amp;poi%5Buri%5D=ymapsbm1%3A%2F%2Forg%3Foid%3D1331623198&amp;pt=37.621408%2C55.754740&amp;z=14.41</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="afe1a51f-3a10-40d8-8572-06842e075116" name="Значение text = &quot;Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)&quot;"><con:configuration><path>$.payload.successDisclaimer.content[1].text</path><content>Не забудьте взять с собой документ, удостоверяющий личность и документ указанный при оформлении заявки (СНИЛС или полис ОМС)</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать id записи" id="8371633b-7148-4f2e-a74f-5d1b0538a0ef"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>id</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>postCovidTestSave</con:sourceStep><con:sourcePath>$.payload.id</con:sourcePath><con:targetType>covidTestId</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="auth/login" id="eaadc6f8-025b-49ad-afa9-44bd4acdfb89"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="auth/login" id="08840a43-a723-4c34-b231-0c405596bf01" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request>{
    "login": "emias_info",
    "password": "emias_info"
}</con:request><con:originalUri>http://10.2.180.42/api/auth/login</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="bec489c4-e775-4916-b8f3-81bbe239c3e4" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Записать токен" id="dccb1cc9-8d6a-4663-a0d0-f4a62f61798d"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>auth/login</con:sourceStep><con:sourcePath>$.token</con:sourcePath><con:targetType>token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="getFormData" id="1c303543-0169-4dab-8d60-b81080547b60"><con:settings/><con:config service="http://10.2.180.42" resourcePath="/api/mobileApp/getFormData/{id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getFormData" id="246bc00c-81c0-4064-af88-95bc8800be95" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer ${#TestCase#token}" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>${#Project#covidLabsEndpoint}</con:endpoint><con:request/><con:originalUri>http://10.2.180.42/api/mobileApp/getFormData/139885</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="ed1f4c65-de0b-4d33-a95e-3b49f2040460" name="Значение status code = 200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="125267c4-74f2-44a9-930b-a3f1ff3a97ad" name="Значение direction_type_id = 7"><con:configuration><path>$.direction_type_id</path><content>7</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="db0c386c-a3d9-4c9d-99ab-fdaa219ca7ee" name="Значение is_self_direction = true"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="762e6d59-85b4-4bb2-b590-f7df8c4166ba" name="Значение samples_type_id = 1"><con:configuration><path>$.materials[0].samples_type_id</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="68c7aa1d-2acc-4693-9ea4-f5f6bee660b2" name="Значение gender = ${#TestCase#gender}"><con:configuration><path>$.patient.gender</path><content>${#TestCase#gender}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="97ade09d-9c59-4ed4-9024-999907992e36" name="Значение second_name = ${#TestCase#secondName}"><con:configuration><path>$.patient.second_name</path><content>${#TestCase#secondName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="42917d8f-e756-4755-a731-114c68a96021" name="Значение first_name = ${#TestCase#firstName}"><con:configuration><path>$.patient.first_name</path><content>${#TestCase#firstName}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f10e761a-0e5d-4962-976a-d054f30daad6" name="Значение patron_name = null"><con:configuration><path>$.patient.patron_name</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="00407583-60ab-4aac-8a51-e8223af4b397" name="Значение birth_dt = ${#TestCase#birthDate}"><con:configuration><path>$.patient.birth_dt</path><content>${#TestCase#birthDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="b9e568a8-3120-4844-a416-5ba1ceca817d" name="Значение phone = ${#TestCase#phone}"><con:configuration><path>$.patient.phone</path><content>+7 ${#TestCase#phone}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="74d7ee98-c00d-421e-9ee7-ecdbe98655a8" name="Значение fact_address.flat = &quot;&quot;"><con:configuration><path>$.patient.fact_address.flat</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="aba24b77-55ba-468d-acf2-53c7416b1716" name="Значение fact_address.text = ${#TestCase#addressText}"><con:configuration><path>$.patient.fact_address.text</path><content>${#TestCase#addressText}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="8cc3d67a-db2a-4262-be09-03cda5937b8b" name="Значение polis_oms = null"><con:configuration><path>$.patient.polis_oms</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="ca8ed43a-5aa9-41af-b5c9-607cb0a853cf" name="Значение snils = null"><con:configuration><path>$.patient.snils</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="599e89ea-79b3-4ca7-ab98-4d298d0a86f3" name="Значение series = &quot;&quot;"><con:configuration><path>$.patient.document.series</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="cd60b7ca-39f3-45c5-81cd-217dd96fca01" name="Значение num = ${#TestCase#num}"><con:configuration><path>$.patient.document.num</path><content>${#TestCase#num}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a94112a3-e4c3-44d5-a947-d485ee9f14fc" name="Значение issue_date = ${#TestCase#issueDate}"><con:configuration><path>$.patient.document.issue_date</path><content>${#TestCase#issueDate}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3e34aa43-0f43-4ab7-b63c-160b4be86597" name="Значение issued_by = null"><con:configuration><path>$.patient.document.issued_by</path><content>null</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="92369743-d967-485b-9862-6d048b18bdaa" name="Значение document_type_id = 10"><con:configuration><path>$.patient.document.document_type_id</path><content>10</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="id" value="${#TestCase#covidTestId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:testCase id="e3b20b94-a092-4507-9246-294fe22ee705" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="АС2. Невалидный ОМС (COVID_LABS_SAVE_ERROR)" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="Получить данные пациента" id="b91f59f2-b616-401b-adde-fcb36cc70726"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#suppDBDriver}</con:driver><con:connectionString>${#Project#suppFullDbConnection}</con:connectionString><con:query>SELECT * FROM
	(SELECT OMS_ASSURANCE_SERIES, OMS_ASSURANCE_NUMBER, OMS_REGION_ASSURANCE_SERIES, OMS_REGION_ASSURANCE_NUMBER, OMS_NEW_ASSURANCE_NUMBER, OMS_TEMP_ASSURANCE_NUMBER, 
		SNILS, LAST_NAME, FIRST_NAME, SECOND_NAME, BIRTH_DATE, CELLPHONE, CITY, STREET, HOUSE, IS_MALE
	FROM PATIENT
	WHERE STREET IS NOT NULL AND CELLPHONE IS NOT NULL AND 
		(OMS_ASSURANCE_NUMBER IS NOT NULL OR OMS_NEW_ASSURANCE_NUMBER IS NOT NULL OR OMS_REGION_ASSURANCE_NUMBER IS NOT NULL) 
		AND rownum &lt;= 500 ORDER BY dbms_random.value)
WHERE rownum = 1</con:query><con:assertion type="JDBC Status" id="b8f1df22-74e0-4fa7-b4a3-0a953cbaf3b7" name="JDBC Status"/><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="Записать данные пациента" id="52eb8aa3-fbda-4274-8e04-15af2c8c3838"><con:settings/><con:config><script>import groovy.xml.XmlSlurper
import java.time.LocalDate
import org.apache.commons.lang.RandomStringUtils

//Генерация issueDate
n =  Math.abs(new Random().nextInt() % 7)
issueDate= LocalDate.now().minusYears(n)
testRunner.testCase.setPropertyValue( "issueDate",issueDate.toString())

//Получение oms
def PatientOmsResponse = context.expand('${Получить данные пациента#ResponseAsXml}')
PatientOms = new XmlSlurper().parseText(PatientOmsResponse)
row = PatientOms.ResultSet.Row
OMS_ASSURANCE_SERIES = row.OMS_ASSURANCE_SERIES !="" ? row.OMS_ASSURANCE_SERIES:null
OMS_ASSURANCE_NUMBER = row.OMS_ASSURANCE_NUMBER !="" ? row.OMS_ASSURANCE_NUMBER: null
OMS_REGION_ASSURANCE_SERIES = row.OMS_REGION_ASSURANCE_SERIES !="" ? row.OMS_REGION_ASSURANCE_SERIES:null
OMS_REGION_ASSURANCE_NUMBER = row.OMS_REGION_ASSURANCE_NUMBER !="" ? row.OMS_REGION_ASSURANCE_NUMBER:null
OMS_NEW_ASSURANCE_NUMBER = row.OMS_NEW_ASSURANCE_NUMBER !="" ? row.OMS_NEW_ASSURANCE_NUMBER:null
BIRTH_DATE =  row.BIRTH_DATE.toString().split(" ")[0]

log.info OMS_NEW_ASSURANCE_NUMBER
log.info OMS_ASSURANCE_SERIES
log.info OMS_ASSURANCE_NUMBER
log.info OMS_REGION_ASSURANCE_SERIES
log.info OMS_REGION_ASSURANCE_NUMBER
log.info BIRTH_DATE

testRunner.testCase.setPropertyValue( "birthDate",BIRTH_DATE)

if (OMS_NEW_ASSURANCE_NUMBER){
	oms = OMS_NEW_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_ASSURANCE_SERIES &amp;&amp; OMS_ASSURANCE_NUMBER){
	oms = OMS_ASSURANCE_SERIES.toString() + OMS_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

if (OMS_REGION_ASSURANCE_SERIES &amp;&amp; OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_SERIES.toString() + OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}
if (OMS_REGION_ASSURANCE_NUMBER){
	oms = OMS_REGION_ASSURANCE_NUMBER.toString()
	testRunner.testCase.setPropertyValue( "omsNumber",oms)
}

//Запись остальных параметров
testRunner.testCase.setPropertyValue( "snils",row.SNILS.toString())
testRunner.testCase.setPropertyValue( "firstName",row.FIRST_NAME.toString())
testRunner.testCase.setPropertyValue( "secondName",row.LAST_NAME.toString())
testRunner.testCase.setPropertyValue( "middleName",row.SECOND_NAME.toString())
testRunner.testCase.setPropertyValue( "phone",row.CELLPHONE.toString())
testRunner.testCase.setPropertyValue( "addressText",row.CITY.toString() + ", " + row.STREET.toString() + ", д." + row.HOUSE.toString() )
testRunner.testCase.setPropertyValue( "fiasId",UUID.randomUUID().toString())
testRunner.testCase.setPropertyValue( "gender",row.IS_MALE == 1 ? "М" : "Ж")
testRunner.testCase.setPropertyValue( "issuedBy",RandomStringUtils.random(30, (('а'..'я') + ('А'..'Я')).join().toCharArray()))
testRunner.testCase.setPropertyValue( "series", (Math.abs(new Random().nextInt() % 9000) + 1000).toString())
testRunner.testCase.setPropertyValue( "num", (Math.abs(new Random().nextInt() % 900000) + 100000).toString())
testRunner.testCase.setPropertyValue( "flat", (Math.abs(new Random().nextInt() % 100) + 1).toString())</script></con:config></con:testStep><con:testStep type="restrequest" name="postCovidTestSave" id="662e8e2f-dbc1-45da-843a-92e16d36ceeb"><con:settings/><con:config service="http://emiasinfo1.emias.solit-clouds.ru" resourcePath="/api/v2/covidTest/save" methodName="Save 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="postCovidTestSave" id="f5700d05-9f66-4c24-b7f2-e1e8189bdcf5" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#emiasInfoEndpoint}</con:endpoint><con:request>{
"patient": {
        "policyNumber": "${#TestCase#omsNumber}123",
        "snils": "${#TestCase#snils}",
        "document": {
            "documentTypeId": 1,
            "series": "${#TestCase#series}",
            "num": "${#TestCase#num}",
            "issueDate": "${#TestCase#issueDate}",
            "issuedBy": "${#TestCase#issuedBy}"
        },
        "secondName": "${#TestCase#secondName}",
        "firstName": "${#TestCase#firstName}",
        "middleName": "${#TestCase#middleName}",
        "brithDate": "${#TestCase#birthDate}",
        "gender": "${#TestCase#gender}",
        "phone": "${#TestCase#phone}",
        "address": {
            "flat": "${#TestCase#flat}",
            "text": "${#TestCase#addressText}",
            "fiasId": "${#TestCase#fiasId}"
        }
    }
}</con:request><con:originalUri>http://emiasinfo1.emias.solit-clouds.ru/api/v2/covidTest/save</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="41d0af4f-42ca-42be-93ef-b7066eb9cc07" name="Значение code = 400"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="a6d21e75-df28-4946-986d-8acd3ecac426" name="Значение code = &quot;COVID_LABS_SAVE_ERROR&quot;"><con:configuration><path>$.error.code</path><content>COVID_LABS_SAVE_ERROR</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="394e1625-4caf-4607-8c47-d64fc69cc59e" name="Значение description = &quot;Не удалось сформировать заявку в ЕМИАС.COVID.LABS&quot;"><con:configuration><path>$.error.description</path><content>Не удалось сформировать заявку в ЕМИАС.COVID.LABS</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="34e04043-f22d-44f4-a200-bebe7bcf7d6a" name="Значение type = &quot;BUSINESS&quot;"><con:configuration><path>$.error.type</path><content>BUSINESS</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>omsNumber</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>snils</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>firstName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>secondName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>middleName</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>birthDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>gender</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issueDate</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>issuedBy</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>phone</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>addressText</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>fiasId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>series</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>num</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>flat</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>covidTestId</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property><con:property><con:name>token</con:name><con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></con:property></con:properties></con:testCase><con:properties/></con:testSuite><con:properties/><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>